<?php 
  
  $usr_name     	= $this->session->userdata('usr_name');
  $usr_type     	= $this->session->userdata('usr_type');
  $usr_firstname  	= $this->session->userdata('usr_firstname');
  $usr_lastname   	= $this->session->userdata('usr_lastname');
  $usr_is_login   	= $this->session->userdata('usr_is_login');


  if(!$usr_is_login && ($usr_type != 'Admin' || $usr_type !='System Admin' || $usr_type != 'Principal' )  ){
  	header('Location: '.base_url());
  }

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <div class="row">
        	<div class="col-md-6">
        		<h1><?php 
		        echo $title;
		        $sy = $this->module->get_active_sy();
		        ?></h1>
        	</div>

        	<div class="col-md-6 text-right ">
        		<h3><?= date('l  F d, Y')?></h3>
        	</div>
        </div>

        <hr/>

        <?php 
        	$se_status 		= '';
        	$se_stud_type	= '';
        	$sa_is_scholar 	= '';
        	$cnt 			= 0; 

        	$total_enrolled 	= 0;
        	$total_old_student 	= 0;
        	$total_new_student 	= 0;
        	$total_scholar		= 0;
        	$enrolled_today 	= 0;

        	if($dashboard->num_rows() > 0){
        		foreach($dashboard->result() as $r){
        			$se_status 		= $r->se_status;
		        	$se_stud_type	= $r->se_stud_type;
		        	$sa_is_scholar 	= $r->sa_is_scholar;
		        	$cnt 			= $r->cnt; 

		        	if($se_status == 'Enrolled'){
		        		$total_enrolled += $cnt;

		        		if($se_stud_type == 'O'){
		        			$total_old_student += $cnt;
		        		}else{
		        			$total_new_student += $cnt;
		        		}

		        		if($sa_is_scholar == 'Y'){
		        			$total_scholar += $cnt;
		        		}
		        	}


        		}
        	}

        	if($today->num_rows() > 0){
        		$enrolled_today = $today->row('cnt');
        	}
        		
        ?>

        <div class="row">
        	<div class="col-md-3">
				<div class="tile-stats tile-primary" >
					<div class="icon"><i class="entypo-users"></i></div>

					<div class="num"><?=$total_enrolled?></div>
					
					<h3>Officially Enrolled</h3>
				</div>
			</div>

			<div class="col-md-2">
				<div class="tile-stats tile-green">
					
					<div class="icon"><i class="entypo-heart"></i></div>
					<div class="num" ><?=$total_old_student?></div>
					<h3>Old Students</h3>
				</div>
			</div>

			<div class="col-md-2">
				<div class="tile-stats tile-cyan">
					<div class="icon"><i class="entypo-star"></i></div>

					<div class="num" ><?=$total_new_student?></div>
					
					<h3>New Students</h3>
				</div>
			</div>

			<div class="col-md-2">
				<div class="tile-stats tile-purple">
					<div class="icon"><i class="entypo-flag"></i></div>

					<div class="num" ><?=$total_scholar?></div>
					
					<h3>Scholars</h3>
				</div>
			</div>

			<div class="col-md-3">
				<div class="tile-stats tile-aqua">
					<div class="icon"><i class="entypo-calendar"></i></div>
				
					<div class="num" ><?=$enrolled_today?></div>
					
					<h3>Today</h3>
				</div>
			</div>
        </div>

        <br/>


   		<div class="row">
			<div class="col-md-3">
					
				<?php 
					$male 	= 0;
					$female = 0;	

					if($gender->num_rows() > 0){
						foreach($gender->result() as $g) {
							$gender = ucfirst($g->stud_gender);

							if($gender == 'Male'){
								$male += $g->cnt;
							}else{
								$female += $g->cnt;
							}
						}
					}
				?>	

				<div class="row">
					<div class="col-md-6" style="padding-right: 5px">
						<div class="tile-stats tile-white-blue">
							<div class="icon"><i class="fa fa-male"></i></div>
							<div class="num"><?=$male?></div>
							
							<h3>Male</h3>
						</div>
					</div>

					<div class="col-md-6" style="padding-left: 5px">
						<div class="tile-stats tile-white-pink">
							<div class="icon"><i class="fa fa-female"></i></div>
							<div class="num"><?=$female?></div>
							
							<h3>Female</h3>
						</div>
					</div>
				</div>

				<div class="panel panel-primary panel-table">
					<div class="panel-heading">
						<div class="panel-title">
							<h3 class="bold">STATISTICS</h3>
						</div>
					</div>

					<div class="panel-body p-0">
						
						
						
						<table class="table table-responsive table-condensed table-bordered">
							<thead>
								<th colspan="2" class="bold"> RELIGION</th>
							</thead>
							<tbody>
								<tr>
									<td> &nbsp;&nbsp;&nbsp; Catholic</td>
									<td class="text-center " style="width:30%">
										<?php 
											if($catholic->num_rows() > 0){
												foreach($catholic->result() as $c){
													echo $c->cnt;
												}
											}
										?>
									</td>
								</tr>

								<tr>
									<td>  &nbsp;&nbsp;&nbsp;  Non-Catholic</td>
									<td class="text-center " >
										<?php 
											if($non_catholic->num_rows() > 0){
												foreach($non_catholic->result() as $n){
													echo $n->cnt;
												}
											}
										?>
									</td>
								</tr>
							</tbody>
						</table>

						<table class="table table-responsive table-condensed table-bordered">
							<thead>
								<th colspan="2" class="bold"> HANDEDNESS</th>
							</thead>
							<tbody>
								
								<?php 
									
									if($handedness->num_rows() > 0):
										foreach($handedness->result() as $g) :
									
								?>

								<tr>
									<td >  &nbsp;&nbsp;&nbsp; <?= ucfirst($g->stud_handedness)?></td>
									<td class="text-center" style="width:30%"><?=$g->cnt?></td>
								</tr>

								<?php endforeach; 
									endif; 
								?>

								
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="col-md-4">
				<div class="panel panel-primary panel-table">
					<div class="panel-heading">
						<div class="panel-title">
							<h3 class="bold">ENROLLMENT SUMMARY</h3>
						</div>
					</div>
					<div class="panel-body ">
						<!-- <div class="text-right">
							<a href="<?=base_url()?>report/print_enrollment_summary" class="btn btn-xs btn-info"><i class="fa fa-print"></i> Print Summary</a>
						</div> -->

						<table class="table table-bordered table-condensed table-hover">
							<thead>
								<!-- <th class="text-center width-5">No</th> -->
								<th>Level Name</th>
								<th class="text-center width-10">Old</th>
								<th class="text-center width-10">New</th>
								<th class="text-center width-10">Male</th>
								<th class="text-center width-10">Female</th>
								<th class="text-center width-10">Total</th>
							</thead>
							<tbody>
								<?php 
									if($level->num_rows() > 0 ):

									$cnt 			= 1;
									foreach($level->result() as $lvl): 
										$llvl = $lvl->lvl_id;

										$se_status 		= 0;
										$se_stud_type 	= 0;
										$sa_is_scholar 	= 0;
										$se_cnt 		= 0;

										$old_student 	= 0;
										$new_student 	= 0;

										$total_male_female 	= 0;
										$stud_male			= 0;
										$stud_female		= 0;

										foreach($dashboard->result() as $es){
											$se_status 		= $es->se_status;
											$se_stud_type 	= $es->se_stud_type;
											$sa_is_scholar 	= $es->sa_is_scholar;
											$lvl_id 		= $es->lvl_id;
											$se_cnt 		= $es->cnt;

											

											if($se_stud_type == 'O'){
												if($lvl_id == $llvl){
													$old_student += $se_cnt;
												}
												
											}else{
												if($lvl_id == $llvl){
													$new_student += $se_cnt;
												}
											}


										}

										foreach($gender_count->result() as $gc){
											$lvl_id 		= $gc->lvl_id;
											$stud_gender 	= $gc->stud_gender; 

											if($lvl_id == $llvl){
												if($stud_gender == 'Male'){
													$stud_male += $gc->cntt;
												}else{
													$stud_female += $gc->cntt;
												}
											}
										}

										$total_male_female = $old_student + $new_student;
											
								?>
										<tr>
											<!-- <td class="text-center"><?= $cnt++ ?></td> -->
											<td><?= $lvl->lvl_name?></td>


											<td class="text-center">
												<?=$old_student?>
											</td>
											<td class="text-center">
												<?=$new_student?>
											</td>

											<td class="text-center">
												<?=$stud_male?>
											</td>

											<td class="text-center">
												<?=$stud_female?>
											</td>

											<td class="text-center ">
												<?=$total_male_female?>
											</td>
										</tr>

								<?php 
									endforeach; 
									endif; 
								?>
							</tbody>
						</table>

						<table class="table table-bordered table-condensed table-hover">
							<thead>
								<th>Description</th>
								<th class="text-center width-10">Male</th>
								<th class="text-center width-10">Female</th>
								<th class="text-center width-10">Total</th>
							</thead>
							<tbody>
								
								<?php 

									$ps_total_male 		= 0;
									$gs_total_male 		= 0;
									$ps_total_female 	= 0;
									$gs_total_female 	= 0;
									$ps_total 			= 0;
									$gs_total 			= 0;

									$male_total 		= 0;
									$female_total 		= 0;
									$total 				= 0;

									if($gender_department->num_rows() > 0){
										foreach($gender_department->result() as $gd){
											$stud_gender 	= $gd->stud_gender;
											$dept_name 		= $gd->dept_name;
											$cnt 			= $gd->cnt;

											if($dept_name == 'Pre-School'){
												if($stud_gender == 'Male'){
													$ps_total_male 	+= $cnt;
												}else{
													$ps_total_female 	+= $cnt;
												}
											}else{
												if($stud_gender == 'Male'){
													$gs_total_male 	+= $cnt;
												}else{
													$gs_total_female 	+= $cnt;
												}
											}
										}

										$ps_total 		= $ps_total_male + $ps_total_female;
										$gs_total 		= $gs_total_male + $gs_total_female;

										$male_total 	= $ps_total_male + $gs_total_male;
										$female_total 	= $ps_total_female + $gs_total_female;

										$total 			= $male_total + $female_total;
									}

								?>

								<tr>
									<td class="bold">PRE-SCHOOL</td>
									<td class="text-center">
										<?= $ps_total_male ?>
									</td>
									<td class=" text-center">
										<?= $ps_total_female ?>
									</td>
									<td class=" text-center ">
										<?= $ps_total ?>
									</td>
									
								</tr>
								<tr>
									<td class="bold">GRADE SCHOOL</td>
									<td class=" text-center">
										<?= $gs_total_male ?>
									</td>
									<td class=" text-center">
										<?= $gs_total_female ?>
									</td>
									<td class=" text-center ">
										<?= $gs_total ?>
									</td>

								</tr>

								<tr>
									<td class="bold">TOTAL</td>
									<td class=" text-center "><?= $male_total ?></td>
									<td class=" text-center "><?= $female_total ?></td>
									<td class=" text-center "><?= $total ?></td>

								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="col-md-5">
				<div class="panel panel-primary panel-table">
					<div class="panel-heading">
						<div class="panel-title">
							<h3 class="bold">COLLECTION</h3>
						</div>
					</div>
					<div class="panel-body p-0">
						<div class="row">
							<div class="col-md-12">

								<table class="table table-condensed table-bordered datatable table-hover">
									<thead>
										<th class="width-5"></th>
										<th>Date</th>
										<th class="text-center">Amount</th>
									</thead>
									<tbody>
										<?php
											$cnt = 1; 
											$total = 0;
											foreach($collection->result() as $c):?>
											<tr>
												<td class="text-center"><?=$cnt++?></td>
												<td><a href="<?=base_url()?>admin/daily_collection/<?=$c->tf_payment_date?>"><?= date('M-d-Y', strtotime($c->tf_payment_date))?></a></td>
												<td class="text-right">
													<?php 
													$total += $c->tf_amount_paid;
													echo number_format($c->tf_amount_paid,2)?>														
												</td>
											</tr>
										<?php endforeach;?>
									</tbody>
									<tfoot>
										<tr>
											<td></td>
											<td class="bold">Total Collection</td>
											<td class="text-right bold"><?=number_format($total,2)?></td>
										</tr>
									</tfoot>
								</table>

								<!-- <ul class="nav nav-tabs bordered">
								
									<?php  if($usr_type == 'Admin' || $usr_type == 'System Admin'): ?>
								
									<li class="active">
										<a href="#collection" data-toggle="tab">Enrollment Collection</a>
									</li>
								
									<li>
										<a href="#due_account" data-toggle="tab">Daily Collection</a>
									</li>
								
									<?php endif; ?>
								
									
								</ul>
								
								<div class="tab-content">
									
												
									<?php  if($usr_type == 'Admin' || $usr_type == 'System Admin'): ?>
								
									<div class="tab-pane" id="collection">
										
										<table class="table table-bordered table-condensed datatable">
											<thead>
												<th class="width-5"></th>
												<th>Date</th>
												<th class="text-center">Amount</th>
											</thead>
								
											<tbody>
												
											</tbody>
										</table>
									</div>
								
									<div class="tab-pane active" id="due_account">
										
										<table class="table table-bordered table-condensed datatable">
											<thead>
												<th class="width-5"></th>
												<th>Date</th>
												<th class="text-center">Amount</th>
											</thead>
								
											<tbody>
											</tbody>
										</table>
									</div>
								
									<?php endif; ?>
								
								</div> -->
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
     
       
  });
</script>
</body>
</html>