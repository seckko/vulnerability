<?php 
  
  $usr_name     	= $this->session->userdata('usr_name');
  $usr_type     	= $this->session->userdata('usr_type');
  $usr_firstname  	= $this->session->userdata('usr_firstname');
  $usr_lastname   	= $this->session->userdata('usr_lastname');
  $usr_is_login   	= $this->session->userdata('usr_is_login');


  if(!$usr_is_login && ($usr_type != 'Admin' || $usr_type !='System Admin' || $usr_type != 'Principal' )  ){
  	header('Location: '.base_url());
  }

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <div class="row">
        	<div class="col-md-6">
        		<h1><?php 
		        echo $title;
		        $sy = $this->module->get_active_sy();
		        ?></h1>
        	</div>

        	<div class="col-md-6 text-right ">
        		<h3><?= date('l  F d, Y')?></h3>
        	</div>
        </div>

        <hr/>

        <div class="row">
        	<div class="col-md-3">
				<div class="tile-stats tile-blue" >
					<div class="icon"><i class="entypo-users"></i></div>

					<?php $all = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." ")->row('cnt');?>

					<div class="num" data-start="0" data-end="<?=$all?>" data-postfix="" data-duration="1400" data-delay="0"><?=$all?></div>
					
					<h3>Officially Enrolled</h3>
				</div>
			</div>

			<div class="col-md-2">
				<div class="tile-stats tile-green">
					<?php 
						$old = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." AND stud_type = 'Old Student' ")->row('cnt');
					?>
					<div class="icon"><i class="entypo-heart"></i></div>
					<div class="num" data-start="0" data-end="<?=$old?>" data-postfix="" data-duration="1400" data-delay="0"><?=$old?></div>
					<h3>Old Students</h3>
				</div>
			</div>

			<div class="col-md-2">
				<div class="tile-stats tile-cyan">
					<div class="icon"><i class="entypo-star"></i></div>

					<?php 
						$new = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." AND stud_type = 'New Student' ")->row('cnt');
					?>

					<div class="num" data-start="0" data-end="<?=$new?>" data-postfix="" data-duration="1400" data-delay="0"><?=$new?></div>
					
					<h3>New Students</h3>
				</div>
			</div>

			<div class="col-md-2">
				<div class="tile-stats tile-purple">
					<div class="icon"><i class="entypo-flag"></i></div>

					<?php 
						$scholar = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." AND stud_type = 'Scholar' ")->row('cnt');
					?>

					<div class="num" data-start="0" data-end="<?=$scholar?>" data-postfix="" data-duration="1400" data-delay="0"><?=$scholar?></div>
					
					<h3>Scholars</h3>
				</div>
			</div>

			<div class="col-md-3">
				<div class="tile-stats tile-aqua">
					<div class="icon"><i class="entypo-calendar"></i></div>

					<?php 
						$today = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." AND DATE(stud_reg_date) = DATE(NOW()) ")->row('cnt');
					?>

					<div class="num" data-start="0" data-end="<?=$today?>" data-postfix="" data-duration="1400" data-delay="0"><?=$today?></div>
					
					<h3>Today</h3>
				</div>
			</div>
        </div>

        <br/>


   		<div class="row">
			<div class="col-md-3">
				<div class="panel panel-success">
					<div class="panel-body">
						<div class="row">
							<div class="col-md-12">
								<h3 class="bold text-success">STATISTICS</h3>
							</div>
						</div>
						<hr/>
						<table class="table table-responsive table-bordered">
							<thead>
								<th><h5 class="bold m-0">TOTAL REGISTERED</h5></th>
								<th class="text-right text-center" style="width:30%"><h4 class="bold m-0"><?= $this->module->get_query("SELECT COUNT(*) as cnt  FROM v_section_assignment WHERE sy_id = ".$sy." ")->row('cnt'); ?></h4></th>
								
							</thead>
							<tbody>

								<?php 
									$q_gender  = $this->module->get_query("SELECT stud_type, COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." GROUP BY stud_type ");
									foreach($q_gender->result() as $r) :
								?>
								<tr>
									<td class="bold"><?= strtoupper($r->stud_type)?></td>
									<td class="bold text-right text-center"><?= $r->cnt?></td>
								</tr>
								<?php endforeach; ?>
							</tbody>
						</table>

						<hr/>

						
						<table class="table table-responsive table-bordered">
							<thead>
								<th colspan="2" class="bold">GENDER</th>
							</thead>
							<tbody>

								<?php 
									$q_gender  = $this->module->get_query("SELECT stud_gender, COUNT(*) as cnt FROM v_section_assignment WHERE sy_id = ".$sy." GROUP BY stud_gender ");
									foreach($q_gender->result() as $r) :
								?>

								<tr>
									<td ><?= strtoupper($r->stud_gender)?></td>
									<td class="text-right" style="width:30%"><?= strtoupper($r->cnt)?></td>
								</tr>

								<?php endforeach; ?>
								
							</tbody>
						</table>

						<hr/>

						
						<table class="table table-responsive table-bordered">
							<thead>
								<th colspan="2" class="bold"> RELIGION</th>
							</thead>
							<tbody>
								<tr>
									<td>CATHOLIC</td>
									<td class="text-right bold" style="width:30%">
										<?= $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE stud_religion LIKE '%catholic' AND sy_id = ".$sy."  ")->row('cnt'); ?>
									</td>
								</tr>

								<tr>
									<td>NON-CATHOLIC</td>
									<td class="text-right bold" >
										<?= $this->module->get_query("SELECT COUNT(*) as cnt FROM v_section_assignment WHERE stud_religion NOT LIKE '%catholic' AND sy_id = ".$sy."  ")->row('cnt'); ?>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="col-md-4">
				<div class="panel panel-info">
					<div class="panel-body">
						<div class="row">
							<div class="col-md-7">
								<h3 class="bold text-info">ENROLLMENT SUMMARY</h3>
							</div>

							<div class="col-md-5 text-right">
								<a href="<?=base_url()?>report/print_enrollment_summary" class="btn btn-xs btn-info"><i class="fa fa-print"></i> Print Summary</a>
							</div>
						</div>
						<hr/>
						<table class="table table-bordered table-condensed">
							<thead>
								<th class="text-center">No</th>
								<th>Level Name</th>
								<th class="text-center">Count</th>
							</thead>
							<tbody>
								<?php 
									$cnt = 1;
									foreach($level->result() as $r): ?>
								<tr>
									<td class="text-center"><?= $cnt++ ?></td>
									<td><?= $r->lvl_name ?></td>
									<td class="text-center"><?= $r->cnt ?></td>
								</tr>

							<?php endforeach; ?>
							</tbody>
						</table>

						<table class="table table-bordered table-condensed">
							<thead>
								<th>Description</th>
								<th>Male</th>
								<th>Female</th>
								<th class="text-center">Total</th>
							</thead>
							<tbody>
								<tr>
									<td class="bold">PRE-SCHOOL</td>

									<?php  
									$q_query = $this->module->get_query(" SELECT stud_gender, COUNT(*) as cnt FROM v_section_assignment WHERE dept_name = 'Pre-School' AND sy_id = ".$sy."  GROUP BY stud_gender ");

									$total = 0;
									foreach($q_query->result() as $r):
										$total += $r->cnt; 
									?>

									<td><?= $r->cnt; ?></td>

									<?php endforeach;  ?>


									<td class=" text-center">
										<?= $total; ?>
									</td>
									
								</tr>
								<tr>
									<td class="">GRADE SCHOOL</td>

									<?php  
									$q_query = $this->module->get_query(" SELECT stud_gender, COUNT(*) as cnt FROM v_section_assignment WHERE dept_name <> 'Pre-School' AND sy_id = ".$sy."  GROUP BY stud_gender ");

									$total = 0;
									foreach($q_query->result() as $r):
										$total += $r->cnt; 
									?>

									<td><?= $r->cnt; ?></td>

									<?php endforeach;  ?>


									<td class=" text-center">
										<?= $total; ?>
									</td>

								</tr>

								<tr>
									<td class="bold">TOTAL</td>

									<?php 
										$q_gender 	= $this->module->get_query("SELECT stud_gender, COUNT(*) AS cnt FROM v_section_assignment WHERE sy_id = ".$sy." GROUP BY stud_gender");
										$total 		= 0;

										foreach($q_gender->result() as $r):
											$total +=  $r->cnt;
									?>

									<td><?= $r->cnt?></td>

									<?php endforeach; ?>
									

									<td class="text-center ">
										<?= $total; ?>
									</td>

								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="col-md-5">
				<div class="panel panel-primary">
					<div class="panel-body">
						<div class="row">
							<div class="col-md-12">
								<ul class="nav nav-tabs bordered"><!-- available classes "bordered", "right-aligned" -->
									<!-- <li class="active">
										<a href="#handedness" data-toggle="tab"> Summary</a>
									</li> -->

									<li>
										<a href="#dailyenrollment" data-toggle="tab">Daily Enrollment</a>
									</li>

									<?php  if($usr_type == 'Admin' || $usr_type == 'System Admin'): ?>

									<li>
										<a href="#collection" data-toggle="tab">Enrollment Collection</a>
									</li>

									<li class="active">
										<a href="#due_account" data-toggle="tab">Daily Collection</a>
									</li>

									<?php endif; ?>

									<li>
										<a href="#newstudent" data-toggle="tab">New Student</a>
									</li>
									
								</ul>

								<div class="tab-content">
									<!-- <div class="tab-pane active" id="handedness">
										<div class="row">
											<div class="col-md-8">
												<h3 class="bold"> SUMMARY DETAILS</h3>
											</div>
											<div class="col-md-4 text-right">
												<a href="<?=base_url()?>admin/print_handedness" class="btn btn-xs btn-primary"> <i class="fa fa-print"></i> Print Handedness</a>
											</div>
										</div>
									
										<table class="table table-bordered table-condensed datatable">
											<thead>
												<th class="text-center">No.</th>
												<th class="text-center">Section</th>
												<th class="text-center"> Male </th>
												<th class="text-center"> Female </th>
												<th class="text-center">Right-handed</th>
												<th class="text-center">Left-handed</th>
												<th class="text-center">Total</th>
											</thead>
									
											<tbody>
												<?php 
													$cnt 	= 1;
									
													foreach ($section->result() as $k): 
														$sec_id  = $k->sec_id;
									
														$right 	= $this->module->get_query("SELECT COUNT(*) AS right_handed FROM v_section_assignment WHERE sec_id = ".$sec_id." AND stud_handedness = 'Right-handed' ")->row('right_handed');
									
														$left 	= $this->module->get_query("SELECT COUNT(*) AS left_handed FROM v_section_assignment WHERE sec_id = ".$sec_id." AND stud_handedness = 'Left-handed' ")->row('left_handed');
									
														$boys 	=	$this->module->get_query("SELECT COUNT(*) as boys FROM v_section_assignment WHERE sec_id =  ".$sec_id." AND stud_gender = 'Male' ")->row('boys');
														$girls 	=	$this->module->get_query("SELECT COUNT(*) as girls FROM v_section_assignment WHERE sec_id =  ".$sec_id." AND stud_gender = 'Female' ")->row('girls');
									
														
												?>
													<tr>
														<td class="text-center"> <?=$cnt++?></td>
														<td><?= $k->sec_name ?></td>
														<td class="text-center"><?= $boys ?> </td>
														<td class="text-center"><?= $girls ?> </td>
														<td class="text-center"><?= $right; ?></td>
														<td class="text-center"><?= $left; ?></td>
														<td class="text-center">
															<?= $this->module->get_query("SELECT COUNT(*) AS total FROM v_section_assignment WHERE sec_id = ".$sec_id." ")->row('total'); ?>
														</td>
													</tr>
													
												<?php endforeach ?>
												
											</tbody>
										</table>
									</div> -->

									<div class="tab-pane " id="dailyenrollment" >

										<h3 class="bold">DAILY ENROLLMENT</h3>

										<div class="table-responsive">
											<table class="table table-bordered table-condensed datatable">
												<thead>
													<th class="width-5"></th>
													<th>Date</th>
													<th class="text-center">Count</th>
												</thead>

												<tbody>
													<?php 
														$cnt = 1;
														foreach($enrollee->result() as $r):?>
													<tr>
														<td class="text-center"><?= $cnt++?></td>
														<td><a href="<?=base_url()?>admin/daily_enrollment/<?=date('Y-m-d', strtotime($r->stud_reg_date))?>"> <?= date('F d,Y', strtotime($r->stud_reg_date)) ?> </a> </td>
														<td class="text-center bold"><?= $r->cnt ?></td>
													</tr>
												<?php endforeach; ?>
												</tbody>
											</table>
										</div>
									</div>

									<?php  if($usr_type == 'Admin' || $usr_type == 'System Admin'): ?>

									<div class="tab-pane" id="collection">
										<h3 class="bold">ENROLLMENT COLLECTION</h3>
										
										<table class="table table-bordered table-condensed datatable">
											<thead>
												<th class="width-5"></th>
												<th>Date</th>
												<th class="text-center">Amount</th>
											</thead>

											<tbody>
												<?php 
													$cnt = 1;
													foreach($collection->result() as $r):?>
												<tr>
													<td class="text-center"><?= $cnt++?></td>
													<td><?= date('F d,Y', strtotime($r->as_date)) ?> </td>
													<td class="text-right bold"><?= number_format($r->collection, 2) ?></td>
												</tr>
											<?php endforeach; ?>
											</tbody>
										</table>
									</div>

									<div class="tab-pane active" id="due_account">
										<h3 class="bold">DAILY COLLECTION</h3>
										
										<table class="table table-bordered table-condensed datatable">
											<thead>
												<th class="width-5"></th>
												<th>Date</th>
												<th class="text-center">Amount</th>
											</thead>

											<tbody>
												<?php 
													$cnt = 1;
													foreach($due_account->result() as $r):
														$date = $r->inst_det_date;
														$assessment_collection = $this->module->get_query("SELECT SUM(as_total) as sum FROM assessment WHERE DATE_FORMAT(as_date, '%Y-%m-%d')  = '".$date."' ");
													?>
												<tr>
													<td class="text-center">
														<?= $cnt++?>
													</td>
													<td>
														<a href="<?=base_url()?>admin/daily_collection/<?=date('Y-m-d', strtotime($r->inst_det_date))?>"> <?= date('F d,Y', strtotime($r->inst_det_date)) ?> </a>
													</td>
													<td class="text-right "><?= number_format( ($r->sum_total + $assessment_collection->row('sum')), 2) ?></td>
												</tr>
											<?php endforeach; ?>
											</tbody>
										</table>
									</div>

									<?php endif; ?>

									<div class="tab-pane" id="newstudent">
										<h3 class="bold">NEW STUDENT SUMMARY</h3>
										
										<div class="row">
											<div class="col-md-8">
												<table class="table table-bordered table-condensed">
													<thead>
														<th class="width-5"></th>
														<th>Level</th>
														<th class="text-center">Count</th>
													</thead>

													<tbody>
														<?php 
															$cnt = 1;
															foreach($new_student->result() as $r):?>
														<tr>
															<td class="text-center"><?= $cnt++?></td>
															<td><?=$r->lvl_name?></td>
															<td class="text-center"><?=$r->cnt?></td>
														</tr>
															<?php endforeach; ?>
													</tbody>
												</table>
											</div>

											<div class="col-md-4">
												<table class="table table-bordered table-condensed">
													<thead>
														<th class="width-5"></th>
														<th>Department</th>
														<th class="text-center">Count</th>
													</thead>

													<tbody>
														<?php 
															$cnt = 1;
															$total = 0;
															foreach($new_student_dept->result() as $r):?>
														<tr>
															<td class="text-center"><?= $cnt++?></td>
															<td><?=$r->dept_name?></td>
															<td class="text-center"><?=$r->cnt?></td>
														</tr>
															<?php 
															$total += $r->cnt; 
															endforeach; ?>
														<tr>
															<td colspan="2" class="bold">TOTAL</td>
															<td class="text-center bold"><?=$total?></td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>


								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
     /* $(".datatable").dataTable({
            "sPaginationType": "bootstrap"
        });*/
       
  });
</script>
</body>
</html>