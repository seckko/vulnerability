<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
      
      <span>STUDENT NAME</span>
        <h1 class="m-0 bold"><?=$student->row('stud_lastname').', '.$student->row('stud_firstname').' '.$student->row('stud_middlename').' '.$student->row('stud_suffix');?></h1><hr/>

        <div class="row">
        <div class="col-md-9">
          <form  class="form-horizontal form-groups-bordered" id="frmSubmit" action="<?php echo base_url()?>admin/edit_student/<?=$student->row('stud_id')?>" method="POST">
            
            <div class="panel panel-default" style="border-color: #373e4a;">
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Basic Students' Information</div>
              </div>

              <div class="panel-body">
                  

                  <input type="hidden" name="sy_id" value="<?=$sy->row('sy_id')?>">
                  <div class="form-group">
                    <label class="col-sm-2 control-label bold">Type</label>

                    <div class="col-sm-3">
                      <?php $se_stud_type = $assessment->row('se_stud_type'); ?>
                      <input class="icheck" type="radio" value="N" name="se_stud_type" required="" <?= ( $se_stud_type == 'N' ? 'checked="" ': '' ) ?> >
                          <label>NEW STUDENT</label>
                    </div>

                    <div class="col-sm-3">
                      <input class="icheck type" type="radio" value="O" name="se_stud_type" required="" <?= ($se_stud_type == 'O' ? 'checked="" ': '' ) ?>>
                          <label>OLD STUDENT</label>
                    </div>

                    <label class="col-sm-1 control-label">Student No.</label>

                    <div class="col-sm-3">
                      <input type="text" class="form-control stud_no" name="stud_no" placeholder="Student Number" value="<?= $student->row('stud_no') ?>">
                    </div>
                  </div>

                  <hr/>
                
                  <div class="form-group">
                    <label class="col-sm-2 control-label bold">LRN <br/><small>(Learners Reference Number)</small></label>
                    
                    <div class="col-sm-6">
                      <input type="text" class="form-control input-lg" maxlength="12" name="stud_lrn"  placeholder="418506000000" value="<?= $student->row('stud_lrn') ?>">
                    </div>

                  </div>
        
                  <div class="form-group">
                    <label class="col-sm-2 control-label">Student Name</label>
                    
                    <div class="col-sm-3">
                      <input type="text" class="form-control" placeholder="Last Name" required="" name="stud_lastname" value="<?= ucwords(strtolower($student->row('stud_lastname'))) ?>">
                    </div>

                    <div class="col-sm-3">
                      <input type="text" class="form-control" placeholder="First Name" required="" name="stud_firstname" value="<?= ucwords(strtolower($student->row('stud_firstname'))) ?>">
                    </div>

                    <div class="col-sm-3">
                      <input type="text" class="form-control" placeholder="Middle Name" name="stud_middlename" value="<?= ucwords(strtolower($student->row('stud_middlename'))) ?>">
                    </div>

                    <div class="col-sm-1">
                      <input type="text" class="form-control" placeholder="Suffix" name="stud_suffix" value="<?= ucwords(strtolower($student->row('stud_suffix'))) ?>">
                    </div>

                  </div>

                  <hr/>

                  <div class="form-group">
                    <label class="col-sm-2 control-label">Nickname </label>
                    
                    <div class="col-sm-3">
                      <input type="text" class="form-control" name="stud_nickname" required="" value="<?= ucwords(strtolower($student->row('stud_nickname'))) ?>">
                    </div>

                    <label class="col-sm-1 control-label">Gender </label>
                    
                    <div class="col-sm-2">
                      <select class="form-control" name="stud_gender" required="" >
                        <option selected="" disabled="">SELECT</option>
                        <option <?=($student->row('stud_gender') == 'Male' ? 'selected="" ' : '' ) ?> value="Male">Male</option>
                        <option <?=($student->row('stud_gender') == 'Female' ? 'selected=""' : '' ) ?> value="Female">Female</option>
                      </select>
                    </div>

                    <label class="col-sm-1 control-label text-left">Birthdate </label>
                    
                    <div class="col-sm-3">

                      <?php  $birthdate = $student->row('stud_birthdate');
                             $format_birtdate =  date('m-d-Y', strtotime($birthdate));
                      ?>

                      <input type="text" class="form-control stud_birthdate" name="stud_birthdate" required="" value="<?=$format_birtdate?>">
                      <div class="date_msg text-danger bold pt-5"></div>
                    </div>

                  </div>

                  <div class="form-group">
                    <label class="col-sm-2 control-label">Handedness </label>
                    <div class="col-sm-3">
                      <select class="form-control" name="stud_handedness" required="">
                        <option selected="" disabled="" >SELECT</option>
                        <option <?=($student->row('stud_handedness') == 'Right-handed' ? 'selected=""' : '' ) ?> value="Right-handed">Right-Handed</option>
                        <option <?=($student->row('stud_handedness') == 'Left-handed' ? 'selected=""' : '' ) ?> value="Left-handed">Left-Handed</option>
                      </select>

                    </div>

                    <label class="col-sm-1 control-label ">Religion </label>
                    
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="stud_religion" required="" value="<?= ucwords(strtolower($student->row('stud_religion'))) ?>">
                    </div>


                  </div>


                  <div class="form-group">
                    <label class="col-sm-2 control-label">Complete Address </label>
                    
                    <div class="col-sm-10">
                      <textarea class="form-control" name="stud_address" rows="4" required=""><?= ucwords(strtolower($student->row('stud_address'))) ?></textarea>
                    </div>

                  </div>
              </div>
            </div>

            <div class="panel panel-default" style="border-color: #373e4a;">
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Parents/Guardians' Information</div>
              </div>

              <div class="panel-body">
                <div class="row">
                  <div class="col-md-4">
                    <!-- for father -->

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label bold">Fathers' Name </label>
                        <input type="text" class="form-control" name="stud_father_name"  value="<?= ucwords(strtolower($student->row('stud_father_name'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Occupation </label>
                        <input type="text" class="form-control" name="stud_father_occupation"  value="<?= ucwords(strtolower($student->row('stud_father_occupation'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Educational Attainment </label>
                        <input type="text" class="form-control" name="stud_father_education" value="<?= ucwords(strtolower($student->row('stud_father_education'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Office Address </label>
                        <textarea class="form-control" name="stud_father_address" rows="3" ><?= ucwords(strtolower($student->row('stud_father_address'))) ?></textarea>
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Contact Numbers</label>
                        <input type="text" class="form-control digit" name="stud_father_contact" value="<?= $student->row('stud_father_contact') ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Email Address</label>
                        <input type="email" class="form-control" name="stud_father_email" value="<?= $student->row('stud_father_email') ?>">
                      </div>
                    </div>


                  </div>

                  <div class="col-md-4">
                    <!-- for mother -->

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label bold">Mothers' Name </label>
                        <input type="text" class="form-control" name="stud_mother_name" value="<?= ucwords(strtolower($student->row('stud_mother_name'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Occupation </label>
                        <input type="text" class="form-control" name="stud_mother_occupation"  value="<?= ucwords(strtolower($student->row('stud_mother_occupation'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Educational Attainment </label>
                        <input type="text" class="form-control" name="stud_mother_education" value="<?= ucwords(strtolower($student->row('stud_mother_education'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Office Address </label>
                        <textarea class="form-control" name="stud_mother_address" rows="3" ><?= ucwords(strtolower($student->row('stud_mother_address'))) ?></textarea>
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Contact Numbers</label>
                        <input type="text" class="form-control digit" name="stud_mother_contact"  value="<?= $student->row('stud_mother_contact') ?>" >
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Email Address</label>
                        <input type="email" class="form-control" name="stud_mother_email" value="<?= $student->row('stud_mother_email') ?>">
                      </div>
                    </div>


                  </div>

                  <div class="col-md-4">
                    <!-- for guardian -->
                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label bold">Guardians' Name</label>
                        <input type="text" class="form-control" name="stud_guar_name" value="<?= ucwords(strtolower($student->row('stud_guar_name'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Relationship</label>
                        <input type="text" class="form-control" name="stud_guar_relation" value="<?= ucwords(strtolower($student->row('stud_guar_relation'))) ?>">
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Address</label>
                        <textarea class="form-control" name="stud_guar_address" rows="3" ><?= ucwords(strtolower($student->row('stud_guar_address'))) ?></textarea>
                      </div>
                    </div>

                    <div class="form-group mb-0">
                      <div class="col-md-12">
                        <label class="control-label">Contact Number</label>
                        <input type="text" class="form-control" name="stud_guar_contact" value="<?= $student->row('stud_guar_contact') ?>">
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="panel panel-default " style="border-color: #373e4a;" >
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Last School Attended</div>
              </div>

              <div class="panel-body">
                <table class="table table-condensed ">
                  <thead>
                    <th class="bold">SCHOOL NAME</th>
                    <th class="bold">LEVEL</th>
                    <th class="bold">ATTENDANCE DATE</th>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <input type="text" class="form-control" name="stud_prev_schl_name" placeholder="School Name" value="<?= ucwords(strtolower($student->row('stud_prev_schl_name'))) ?>">
                      </td>
                      <td>
                        <input type="text" class="form-control" name="stud_prev_level" placeholder="Level" value="<?= $student->row('stud_prev_level') ?>">
                      </td>
                      <td>
                        <input type="text" class="form-control" name="stud_prev_date" placeholder="Attendance Date" value="<?= $student->row('stud_prev_date') ?>">
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>


            <div class="panel panel-success">
              <div class="panel-heading" >
                <div class="panel-title bold">Message Cast</div>
              </div>

              <div class="panel-body">
                <label>
                  Our school is subscribed to Sun Cellular’s Message Cast Service which enables parents to receive school announcements/ news via SMS promptly. 
                    With this, may we request you to indicate <strong>ONE (1) CONTACT NUMBER </strong> that will receive official announcements from the school.
                </label><br/><br/>
                <div class="form-group">
                  <label class="col-sm-2 control-label">Name of Parent/Guardian:</label>
                  
                  <div class="col-sm-10">
                    <div class="col-md-6 p-0">
                      <input type="text" class="form-control" name="stud_guardian_name" required="" placeholder="Name" value="<?= ucwords(strtolower($student->row('stud_guardian_name'))) ?>">
                    </div>

                    <div class="col-md-6">
                      <input type="text" class="form-control digit digit" name="stud_guardian_contact" required="" placeholder="Contact Number" maxlength="11" value="<?= $student->row('stud_guardian_contact') ?>">
                    </div>
                    
                  </div>

                </div>
              </div>
            </div>

            <div class="panel panel-default" style="border-color: #373e4a;">
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Contact Person in case of Emergency</div>
              </div>

              <div class="panel-body">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <div class="col-md-12">
                        <label class="bold">NAME</label>
                        <input type="text" class="form-control" name="stud_emergency_name" placeholder="Name" required="" value="<?= ucwords(strtolower($student->row('stud_emergency_name'))) ?>">
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="form-group">
                      <div class="col-md-12">
                        <label class="bold">RELATIONSHIP</label>
                        <input type="text" class="form-control" name="stud_relationship" placeholder="Relationship" required="" value="<?= ucwords(strtolower($student->row('stud_relationship'))) ?>">
                      </div>
                    </div>
                  </div>

                  <div class="col-md-5">
                    <div class="form-group">
                      <div class="col-md-12">
                        <label class="bold">CONTACT NUMBERS</label>
                        <input type="text" class="form-control" name="stud_emergency_contact" placeholder="Contact Numbers" required="" value="<?= $student->row('stud_emergency_contact') ?>">
                      </div>
                    </div>
                  </div>

                </div>

              </div>
            </div>

            <div class="panel panel-default " style="border-color: #373e4a;">
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Siblings</div>
              </div>

              <div class="panel-body">
                <table class="table table-condensed ">
                  <thead>
                    <th class="text-center bold" >NAME</th>
                    <th class="text-center bold" width="10%">GENDER</th>
                    <th class="text-center bold" width="10%">AGE</th>
                    <th class="text-center bold" width="15%">LEVEL</th>
                    <th class="text-center bold">SCHOOL</th>
                    <th></th>
                  </thead>
                  <tbody>
                    <?php //for($i=1; $i<=3; $i++): 
                        $i= 1;
                        foreach($sibling->result() as $v) :
                    ?>
                      <tr>
                        <td>
                          <input type="text" class="form-control" name="sib<?=$i?>[sib_name]" placeholder="Name" value="<?= ucwords(strtolower($v->sib_name)) ?>">
                        </td>

                        <td>
                          <select class="form-control" name="sib<?=$i?>[sib_gender]" >
                            <option selected="" disabled="">SELECT</option>
                            <option <?=($v->sib_gender == 'Male' ? 'selected="" ' : '' )?> value="Male">Male</option>
                            <option <?=($v->sib_gender == 'Female' ? 'selected="" ' : '' )?> value="Female">Female</option>
                          </select>
                        </td>

                        <td>
                          <input type="text" class="form-control digit" name="sib<?=$i?>[sib_age]" placeholder="Age" value="<?= $v->sib_age ?>">
                        </td>

                        <td>
                          <input type="text" class="form-control" name="sib<?=$i?>[sib_level]" placeholder="Grade/Level" value="<?= $v->sib_level ?>">
                        </td>
                        <td>
                          <input type="text" class="form-control" name="sib<?=$i?>[sib_school]" placeholder="Previous School" value="<?= ucwords(strtolower($v->sib_school)) ?>">
                        </td>
                        <td>
                          <button type="button" class="btn btn-danger btn-xs delete_sibling" data-id="<?=$v->sib_id?>" ><i class="fa fa-times"></i></button>
                        </td>
                      </tr>
                    <?php 
                        $i++;
                      endforeach; ?>

                      <?php for($i; $i<=3; $i++): ?>
                          <tr>
                        <td>
                          <input type="text" class="form-control" name="sib<?=$i?>[sib_name]" placeholder="Name" >
                        </td>

                        <td>
                          <select class="form-control" name="sib<?=$i?>[sib_gender]" >
                            <option selected="" disabled="">SELECT</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                          </select>
                        </td>

                        <td>
                          <input type="text" class="form-control digit" name="sib<?=$i?>[sib_age]" placeholder="Age">
                        </td>

                        <td>
                          <input type="text" class="form-control" name="sib<?=$i?>[sib_level]" placeholder="Grade/Level" >
                        </td>
                        <td>
                          <input type="text" class="form-control" name="sib<?=$i?>[sib_school]" placeholder="Previous School">
                        </td>
                        <td></td>
                      </tr>

                      <?php endfor; ?>

                  </tbody>
                </table>
              </div>
            </div>


            <div class="panel panel-default" style="border-color: #373e4a;">
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Initial Assessment</div>
              </div>

              <div class="panel-body">
                  <table class="table table-condensed ">
                    <thead>
                      <th class="bold">GRADE LEVEL</th>
                      <th class="bold">MODE OF PAYMENT</th>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <select class="form-control" name="lvl_id"> 
                            <?php  foreach($level->result() as $g):  ?>
                              <option value="<?=$g->lvl_id?>" <?=($assessment->row('lvl_id') == $g->lvl_id ? 'selected="" ' : '' ) ?> ><?=$g->lvl_name?></option>
                            <?php endforeach; ?>
                          </select>
                        </td>

                        <td>
                          <select class="form-control" name="se_mode_payment"> 
                            <option <?=($assessment->row('se_mode_payment') == 'CASH' ? 'selected="" ' : '' )?> value="CASH">ANNUAL (CASH)</option>
                            <option <?=($assessment->row('se_mode_payment') == 'SEMESTRAL' ? 'selected="" ' : '' )?> value="SEMESTRAL">SEMESTRAL</option>
                            <option <?=($assessment->row('se_mode_payment') == 'QUARTERLY' ? 'selected="" ' : '' )?> value="QUARTERLY">QUARTERLY</option>
                            <option <?=($assessment->row('se_mode_payment') == 'MONTHLY' ? 'selected="" ' : '' )?> value="MONTHLY">MONTHLY</option>
                          </select>
                        </td>
                      </tr>
                    </tbody>
                  </table>
              </div>
            </div>

            <div class="row">
              <div class="col-md-3">
                <button class="btn btn-success btn-lg " type="submit"> UPDATE RECORD</button>
                <button class="btn btn-lg btn-default" type="reset">Cancel</button>
              </div>
              <div class="col-md-9">
                <div class="msg"></div>
              </div>
            </div>

          </form>
        </div>

        <div class="col-md-3">
          <div class="panel panel-default" style="border-color: #373e4a;">
              <div class="panel-heading" style="background-color: #373e4a; color:white; ">
                <div class="panel-title bold">Upload Picture</div>
              </div>

              <div class="panel-body">

                  <div class="col-sm-12 col-xs-12" data-tag="3d">
        
                    <article class="image-thumb ">
                      
                      <a href="#" class="image">
                        <?php 
                            $img = $student->row('stud_img');
                            if(empty($img) ):
                        ?>
                        <img src="<?=base_url()?>asset/images/timeline-image-1.png" width="100%" class="stud_img">
                        <?php else: ?>
                        <img src="<?=base_url()?>asset/uploads/<?=$student->row('stud_img')?>" width="100%" class="stud_img">
                        <?php endif; ?>
                      </a>
                      
                    </article>
                  
                  </div>
                  <br/>

                  <form id="form_upload" action="<?php echo base_url()?>admin/upload_picture/<?=$student->row('stud_id')?>" method="POST">
                    <div id="upload_msg"></div>
                    <div class="col-md-12 pb-10">
                      <div class="row mb-10">
                        <div class="col-md-8">
                          <h3 class="panel-title bold">Upload progress</h3>
                        </div>
                        <div class="col-md-4 text-right">
                          <h3 class="panel-title text-white" id="prog_percent">0%</h3>
                        </div>
                      </div>
                      <div class="progress progress-striped mb-0" style="height:7px;">
                        <div id="prog_bar" aria-valuemax="100" aria-valuemin="0" role="progressbar" class="progress-bar progress-bar-success">
                        </div>
                      </div>
                    </div>
                    <br/>
                    <div class="col-md-12">
                      <div class="btn-group">
                        <input type="file" name="stud_img" accept="image/*" id="file_upload" class="hidden">
                        <button type="button" class="btn btn-danger upload"><i class="fa fa-file-photo-o"></i> Browse</button>
                        <button type="submit" class="btn btn-success btn-quirk "><i class="fa fa-upload"></i> Upload</button>
                        <button type="reset" class="btn btn-default reset_img"><i class="fa fa-times"></i></button>
                      </div>
                    </div>
                  </form>
              </div>
          </div>
        </div>
      </div>

        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript">
    $(document).ready(function() {
      $('.stud_birthdate').mask('00/00/0000', {placeholder: "mm/dd/yyyy"});

      $('#frmSubmit').submit(function(e){
        e.preventDefault(); 

        var base  = $(this);
      var msg   = base.find(".msg");
      var btn   = base.find("button");

        $.ajax({
        type:base.attr("method"),//get/post
        data:base.serialize(),
        url:base.attr("action"),//location for the url
        beforeSend:function(){
          msg.empty().html(alert_minimal('Processing . . .'));
          btn.prop("disabled",true);
        },
        success:function(rrdata){

          btn.prop("disabled",false);
          var rdata = $.parseJSON(rrdata);
          if(rdata.stat){
            msg.empty().html(alert_success(rdata.msg)).show();
            
            window.setTimeout(function(){
              window.location = base_url + 'admin/student_record';
              //window.location.reload();
            },500)
          }
          else{
            msg.empty().html(alert_error(rdata.msg));
          }
          
        },
        error:function(rdata){
          btn.prop("disabled",false);
          msg.empty().html(alert_error('An error occured, please try again later'));
        }
      });
      });

      //GET AGE GROUP
    $('.stud_birthdate').on('change', function(){
      var birthdate = $(this).val();
      var date_now  = $('#date_now').val();

      if (Date.parse(birthdate) > Date.parse(date_now)) {
        $(this).val('');
        $('.date_msg').html('Invalid date format (mm/dd/yyyy)');
      }else{
        if(validate_date(birthdate) == true ){
          $('.date_msg').html('');
        }else{
          $(this).val('');
          $('.date_msg').html('Invalid date format (mm/dd/yyyy)');
        }
      }
      
    });

    });


  $(".digit").keypress(function (e) {
       //if the letter is not digit then display error and don't type anything
       if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
          //display error message
          $("#errmsg").html("Digits Only").show().fadeOut("slow");
                 return false;
      }
  });

  $('.type').click(function() {

    $type = $(this).is(':checked');

    //var isChecked = $('#rdSelect').prop('checked');


    if($type){
      $('.stud_no').prop('disabled', false);
    }else{
      $('.stud_no').prop('disabled', true);
    }
      //$('input[type="radio"]').not(':checked').prop("checked", true);
  });



  $('.delete_sibling').click(function(){
      var sib_id  = $(this).attr('data-id');
      var tr      = $(this).closest('tr');

      $.ajax({url: base_url+'admin/delete_sibling/'+sib_id, type:'POST', success: function(result){
          tr.fadeOut();
      }});

  });


  var bar      = $('#prog_bar');
    var percent  = $('#prog_percent');

    $('.upload').click(function(e){
      e.preventDefault();
      $('#file_upload').click();
    });

    $("input:file").change(function (){
       var fileName = $(this).get(0).files.length;
       $('.upload').html('<i class="fa fa-file-photo-o"></i> Browse ('+fileName+')');
     });

    $('.reset_img').click(function(){
      $('.upload').html('<i class="fa fa-file-photo-o"></i> Browse');
    });

    

    $('#form_upload').ajaxForm({
      data:$(this).serialize(),
          beforeSend: function() {
              var percentVal = '0%';
              bar.empty().width(percentVal);
              percent.html(percentVal);
          },
          uploadProgress: function(event, position, total, percentComplete,e){
              var percentVal = percentComplete + '%';
              bar.empty().width(percentVal);
              percent.html(percentVal);
              
          },
          success: function() {
              var percentVal = '100%';
              bar.width(percentVal)
              percent.html(percentVal);
          },
          complete: function(xhr){
              var rdata = $.parseJSON(xhr.responseText);
              $(".upload").prop("disabled",false);
              if(rdata){
                  if(rdata.stat){
                      $('#upload_msg').html(alert_success(rdata.msg));
                      location.reload();
                  }
                  else{
                      bar.empty().width(0);
                      percent.html('0%');

                      if(rdata.msg){
                          $('#upload_msg').html(alert_success(rdata.msg));
                          location.reload();
                      }else{
                        $('#upload_msg').html(alert_error(rdata.msg));
                      }
                      
                  }
              }
              else{
                  $('#upload_msg').html(alert_error("Oooops! An error occured upon uploading."));
              }
          },
          error:function(){
              $('#upload_msg').html(alert_error("Oooops! An error occured upon uploading."));
          }
    });//END AJAX UPLOAD




  function validate_date(birthdate){
    var bdate = birthdate;
    var comp = bdate.split('/');
    var m = parseInt(comp[0], 10);
    var d = parseInt(comp[1], 10);
    var y = parseInt(comp[2], 10);
    var date = new Date(y,m-1,d);
    if (date.getFullYear() == y && date.getMonth() + 1 == m && date.getDate() == d) {
      return true;
    } else {
      return false;
    }
  }
  </script>
</body>
</html>