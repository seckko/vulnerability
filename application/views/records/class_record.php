<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->

        <div class="row">
            <?php $dept = $this->module->get_table('department'); 
                foreach ($dept->result() as $d):
                    $dept_id = $d->dept_id;
                    $dept_name = $d->dept_name;

                    $sy_id  = $this->module->get_active_sy(); 
                    $level  = $this->module->get_query("SELECT d.*, gl.* FROM department AS d, grade_level AS gl WHERE d.`dept_id` = gl.`dept_id` AND d.`dept_id` = '".$dept_id."' ");
                    
                    if($dept_name == 'Primary'):?>
                        <div class="col-md-6 col-sm-12 col-xs-12">
                            <div class = "panel panel-primary panel-table">
                                <div class="panel-heading" >
                                    <div class="panel-title" style="padding-top: 20px;padding-bottom: 20px;">
                                        <h3 class="bold">PRIMARY DEPARTMENT</h3>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <?php  foreach($level->result() as $r):
                                        $lvl_id = $r->lvl_id; ?>

                                            <h4 class="">
                                                <?= strtoupper($r->lvl_name)?> <small>(<?= $this->module->get_query(" SELECT COUNT(*) as ctr FROM v_student_section WHERE sy_id = ".$sy_id." AND lvl_id = ".$lvl_id." ")->row('ctr') ?>)</small>
                                            </h4> 
                                            <table class="table table-responsive table-striped table-hover">
                                                <thead>
                                                    <th class="width-5" style="color:#999999"><small>NO.</small></th>
                                                    <th style="color:#999999"><small>SECTION NAME</small></th>
                                                    <th class="text-center" style="color:#999999"><small>COUNT</small></th>
                                                    <th></th>
                                                </thead>

                                                <tbody>
                                                        <?php 
                                                        $qry =  $this->module->get_query("SELECT  dept_name, lvl_id, lvl_name,  sec_id, sec_name, COUNT(*) as cnt FROM v_student_section WHERE sy_id = ".$sy_id." AND `dept_id` = '".$dept_id."' GROUP BY sec_name ORDER BY lvl_sort, sec_sort ASC");
                                                        $cnt =1; 

                                                        if($qry->num_rows() > 0):

                                                        foreach($qry->result() as $k):
                                                            $qry_lvl_id = $k->lvl_id;

                                                            if($lvl_id == $qry_lvl_id):
                                                        ?>
                                                   
                                                    
                                                           <tr>
                                                               <td><?=$cnt++?></td>
                                                               <td ><h5 class="bold m-0" ><?=$k->sec_name;?></h5></td>
                                                               <td class="text-center"><h5 class="bold m-0"><?=$k->cnt;?></h5></td>
                                                               <td>
                                                                    <a class="btn btn-success btn-xs" href="<?=base_url()?>admin/advisory_class/<?=$k->sec_id.'/'.$active_quarter?>"> <i class="fa fa-folder-open"></i> Open</a>
                                                               </td>
                                                           </tr>
                                                        <?php       
                                                            endif;  
                                                        endforeach;
                                                        ?> 

                                                        <?php else: ?> 
                                                            <tr>
                                                                <td colspan="4">No record</td>
                                                            </tr>
                                                        <?php endif; ?> 
                                                </tbody>
                                            </table>
                                            <hr/>
                                    <?php endforeach;?>
                                </div>
                            </div>
                        </div>
                                
                    <?php elseif($dept_name == 'Intermediate'): ?>
                        <div class="col-md-6 col-sm-12 col-xs-12">
                            <div class = "panel panel-primary panel-table">
                                <div class="panel-heading" >
                                    <div class="panel-title" style="padding-top: 20px;padding-bottom: 20px;">
                                        <h3 class="bold">INTERMEDIATE DEPARTMENT</h3>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <?php  foreach($level->result() as $r):
                                        $lvl_id = $r->lvl_id; ?>

                                            <h4 class="">
                                                <?= strtoupper($r->lvl_name)?> <small>(<?= $this->module->get_query(" SELECT COUNT(*) as ctr FROM v_student_section WHERE sy_id = ".$sy_id." AND lvl_id = ".$lvl_id." ")->row('ctr') ?>)</small>
                                            </h4> 
                                            <table class="table table-responsive table-striped table-hover">
                                                <thead>
                                                    <th class="width-5" style="color:#999999"><small>NO.</small></th>
                                                    <th style="color:#999999"><small>SECTION NAME</small></th>
                                                    <th class="text-center" style="color:#999999"><small>COUNT</small></th>
                                                    <th></th>
                                                </thead>

                                                <tbody>
                                                        <?php 
                                                        $qry =  $this->module->get_query("SELECT  dept_name, lvl_id, lvl_name,  sec_id, sec_name, COUNT(*) as cnt FROM v_student_section WHERE sy_id = ".$sy_id." AND `dept_id` = '".$dept_id."' GROUP BY sec_name ORDER BY lvl_sort, sec_sort ASC");
                                                        

                                                        if($qry->num_rows() > 0):
                                                            
                                                        $cnt =1; 
                                                        foreach($qry->result() as $k):
                                                            $qry_lvl_id = $k->lvl_id;

                                                            if($lvl_id == $qry_lvl_id):
                                                         ?>
                                                   
                                                    
                                                       <tr>
                                                           <td><?=$cnt++?></td>
                                                           <td ><h5 class="bold m-0" ><?=$k->sec_name;?></h5></td>
                                                           <td class="text-center"><h5 class="bold m-0"><?=$k->cnt;?></h5></td>
                                                           <td>
                                                                <a class="btn btn-success btn-xs" href="<?=base_url()?>admin/advisory_class/<?=$k->sec_id.'/'.$active_quarter?>"> <i class="fa fa-folder-open"></i> Open</a>
                                                           </td>
                                                       </tr>
                                            
                                                
                                                        <?php       
                                                            endif;  
                                                        endforeach;
                                                        ?>  

                                                        <?php else: ?> 
                                                            <tr>
                                                                <td colspan="4">No record</td>
                                                            </tr>
                                                        <?php endif; ?>
                                                </tbody>
                                            </table>
                                            <hr/>
                                    <?php endforeach;?>
                                </div>
                            </div>
                        </div>
                                

            <?php    
                    endif;
                        
                endforeach; ?>
        </div>

        
    </div><!---END MAIN CONTENT -->
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
       
  });
</script>
</body>
</html>