<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <h1><?=$title;?> <small>(S.Y. <?= $this->module->get_active_sy_name()?>)</small> </h1>
        <hr/>
        <div class="row">
           <div class="col-md-7">
                
                <?php 
                    if($dept_all->num_rows() > 0):
                        foreach($dept_all->result() as $d): 
                            $dept_id = $d->dept_id; ?> 

                <h3 class="bold"><?=strtoupper($d->dept_name)?></h4>
                <hr/>

                <div class="row">

                    <?php 
                        $level  = $this->module->get_query("SELECT d.*, gl.* FROM department AS d, grade_level AS gl WHERE d.`dept_id` = gl.`dept_id` AND d.`dept_id` = ".$dept_id." ");

                        foreach($level->result() as $l):
                            $lvl_id = $l->lvl_id;
                    ?>

                        
                            <div class="col-md-4">
                                <div class="panel panel-default panel-shadow">
                                    <div class="panel-heading"  >
                                        <div class="panel-title bold"> <?=$l->lvl_name;?></div>
                                    </div>

                                    <div class="panel-body p-0">
                                        <table class="table table-responsive table-condensed table-bordered table-hover mb-0">
                                           <!--  <thead>
                                               <th class="bold" colspan="2" >Section</th>
                                               <th width="50px" class="text-center"></th>
                                           </thead> -->
                                            <tbody>
                                                <?php 

                                                    $total_sec = 0;

                                                    $sections = $this->module->get_query("SELECT * FROM section WHERE sy_id = ".$sy_id." AND lvl_id = ".$lvl_id."  ORDER BY sec_sort" ); 

                                                    if($sections->num_rows() > 0):

                                                        $cnt = 1;
                                                        foreach($sections->result() as $s): 
                                                ?>

                                                <tr>
                                                    <td class="text-center width-3 vmiddle"><small><?=$cnt++?></small></td>
                                                    <td class=" vmiddle"><a href="<?=base_url()?>admin/section_class_list/<?=$s->sec_id?>"> <?=$s->sec_name?> </a></td>
                                                    <td class="text-center" >
                                                       <?php  
                                                            $sec_count = $this->module->get_query("SELECT COUNT(*) as cnt FROM  student_class_list WHERE sy_id = ".$sy_id." AND lvl_id = ".$lvl_id." AND sec_id = ".$s->sec_id." ")->row('cnt');

                                                            echo $sec_count;
                                                            $total_sec += $sec_count; 

                                                        ?>

                                                    </td>

                                                    <td  width="70px" class="text-center">
                                                        <a href="<?=base_url()?>admin/section_class_list/<?=$s->sec_id?>" class="btn btn-success btn-xs "> <i class="fa fa-sign-out"></i> Open</a>
                                                    </td>
                                                </tr>
                                                <?php 
                                                        endforeach; 

                                                    else: ?>

                                                    <tr>
                                                        <td class="text-center width-3 vmiddle" colspan="4"> No Records</td>
                                                    </tr>

                                                <?php  endif;  ?>


                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="2" class="bold">Total</td>
                                                    <td class="text-center bold" width="50px" >
                                                        <?= $total_sec ?>
                                                    </td>
                                                    <td></td>
                                                    
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        

                    <?php endforeach;?>
                </div>
    
                <?php endforeach;
                    endif; ?>

            <?php 
                $total_cl_status = 0;
                foreach ($total->result() as $k) {
                    echo $k->cl_status.' : '.$k->cnt.'<br/>';
                    $total_cl_status += $k->cnt;
                }

                echo 'Total : '.$total_cl_status;
            ?>

           </div>


           <div class="col-md-5">

                <div class="row">
                    <?php 
                       
                        if($dept_all->num_rows() > 0):
                        foreach($dept_all->result() as $d): 
                            $dept_id = $d->dept_id;
                    ?> 

                    <div class="col-md-4">
                        <div class="tile-stats tile-white tile-white-primary p-10">
                            <div class="icon"><i class="fa fa-paste"></i></div>
                            <div class="num" >
                                <?=$d->cnt ?>
                            </div>
                            
                            <h3 class="m-0"><?=$d->dept_name?></h3>
                            <p class="m-0">Department</p>
                        </div>
                    </div>

                     <?php endforeach;
                                endif; ?>
                </div>
            

                <div class="panel panel-primary  panel-shadow">
                    <div class="panel-heading">
                        <div class="panel-title">
                            <h3>Summary</h3>
                            <span>Enrollment summary details</span>
                        </div>

                        <div class="panel-option pull-right p-10">

                            <div class="btn-group">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                    Generate Reports <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-default" role="menu">
                                    <li><a href="<?=base_url()?>report/excel_class_list">Export to Excel</a>
                                    </li>
                                    <li><a href="<?=base_url()?>report/excel_class_list_no_gender">Export to Excel No Gender</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li><a href="<?=base_url()?>report/print_class_list">Print Class List</a>
                                    </li>
                                    <li><a href="<?=base_url()?>report/print_class_list_no_gender">Print Class List No Gender</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li><a href="<?=base_url()?>report/print_enrollment_summary">Print Enrollment Summary</a>
                                    </li>
                                </ul>
                            </div>
                           
                       </div> 
                    </div>
                    <div class="panel-body p-0"> 
                        <table  class="table table-bordered table-primary table-striped table-hover table-condensed">
                            <thead>
                                <tr>
                                  <th class="width-5 text-center">No.</th>
                                  <th class="text-center ">Grade & Section</th>
                                  <th class="text-center width-5">Boys</th>
                                  <th class="text-center width-5">Girls</th>
                                  <th class="text-center width-5" >Right<br/>Handed</th>
                                  <th class="text-center width-5" >Left<br/>Handed</th>
                                  <th class="text-center width-5">Catholic</th>
                                  <th class="text-center width-5">Non-Catholic</th>
                                  <th class="text-center width-5"  style="background-color: #f1f1f1; ">Total</th>
                                </tr>
                            </thead>

                            <tbody>
                                <?php 
                                    $cnt = 1;

                                    $total_boys         = 0;
                                    $total_girls        = 0;
                                    $total_catholic     = 0;
                                    $total_non_catholic = 0;
                                    $total_left         = 0;
                                    $total_right        = 0;
                                    $total_all          = 0;
                                    
                                    if($section->num_rows() > 0 ):
                                    foreach($section->result() as $r): 
                                        $sec_id = $r->sec_id;

                                        $boys   = 0;
                                        $girls  = 0;

                                        $right   = 0;
                                        $left    = 0;

                                        $catholic       = 0;
                                        $non_catholic   = 0;

                                        $total = 0;


                                        foreach($student_enrolled->result() as $s){
                                            $ssec_id            = $s->sec_id; 
                                            $stud_gender        = $s->stud_gender; 
                                            $stud_handedness    = $s->stud_handedness;

                                            if($sec_id == $ssec_id){
                                                if($stud_gender == 'Male'){
                                                    $boys += 1;
                                                }else{
                                                    $girls += 1;
                                                }


                                                if($stud_handedness == 'Right-handed'){
                                                    $right += 1;
                                                }else{
                                                    $left += 1;
                                                }

                                                $total = $right + $left;


                                            }
                                        }

                                ?>

                                    <tr>
                                        <td class="text-center"> <?=$cnt++?> </td>
                                        <td > <?=$r->lvl_name.' <strong>'.$r->sec_name?></strong></td>
                                        <td class="text-center"><?=$boys?></td>
                                        <td class="text-center"><?=$girls?></td>
                                        <td class="text-center" ><?=$right?></td>
                                        <td class="text-center" ><?=$left?></td>
                                        <td class="text-center">
                                            <?php 
                                                echo $catholic = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_student_enrollment_assessment WHERE stud_religion LIKE '%Catholic%' AND sec_id = ".$r->sec_id." ")->row('cnt');
                                            ?>                                               
                                        </td>
                                        <td class="text-center">
                                             <?php 
                                                echo $non_catholic = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_student_enrollment_assessment WHERE stud_religion NOT LIKE '%Catholic%' AND sec_id = ".$r->sec_id." ")->row('cnt');
                                            ?> 
                                        </td>
                                        <td class="text-center" style="background-color: #f1f1f1;"><?=$total?></td>
                                    </tr>

                                    <?php 
                                        $total_boys         += $boys;
                                        $total_girls        += $girls;
                                        $total_right        += $right;
                                        $total_left         += $left;
                                        $total_catholic     += $catholic;
                                        $total_non_catholic += $non_catholic;
                                        $total_all          += $total;

                                    ?>

                                <?php endforeach; 
                                    endif; ?>
                            </tbody>

                            <tfoot>
                                <tr>
                                    <td colspan="2">Total</td>
                                    <td class="text-center"><?=$total_boys?></td>
                                    <td class="text-center"><?=$total_girls?></td>
                                    <td class="text-center"><?=$total_right?></td>
                                    <td class="text-center"><?=$total_left?></td>
                                    <td class="text-center"><?=$total_catholic?></td>
                                    <td class="text-center"><?=$total_non_catholic?></td>
                                    <td class="text-center"><?=$total_all?></td>
                                </tr>
                            </tfoot>
                        </table>

                       <!--  <?=print_r($section->result())?> -->

                    </div>
                </div>
           </div>


        </div>
    </div><!---END MAIN CONTENT -->
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
       
  });
</script>
</body>
</html>