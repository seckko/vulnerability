<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <h1><?=$title;?> <small>(S.Y. <?= $this->module->get_active_sy_name()?>)</small> </h1>
        <hr/>
        <div class="row">
            

            <div class="col-md-10">
                <div class="panel panel-primary panel-table panel-shadow">
                    <div class="panel-body ">
                        <div class="row">

                                <?php 
                                $sy_id  = $this->module->get_active_sy();
                                $dept   = $this->module->get_table('department');
                                 
                                foreach ($dept->result() as $d):
                                    $dept_id    = $d->dept_id;
                                    $dept_name  = $d->dept_name;

                                    $all = $this->module->get_query("SELECT COUNT(*) as cnt FROM v_student_section WHERE sy_id = ".$sy_id." AND dept_id = ".$dept_id." ")->row('cnt');
                                ?>
                                
                                <div class="col-sm-4">
            
                                    <div class="tile-stats tile-white tile-white-primary p-10">
                                        <div class="icon"><i class="fa fa-paste"></i></div>
                                        <div class="num" data-start="0" data-end="<?=$all?>"  data-duration="1500" data-delay="0">
                                            <?=$all ?>
                                        </div>
                                        
                                        <h3><?=$dept_name?></h3>
                                        <p>Department</p>
                                    </div>

                                    <?php 
                                    //$sy     = $this->module->get_active_sy(); 
                                    $level  = $this->module->get_query("SELECT d.*, gl.* FROM department AS d, grade_level AS gl WHERE d.`dept_id` = gl.`dept_id` AND d.`dept_id` = '".$dept_id."' ");

                                    foreach($level->result() as $r):
                                        $lvl_id = $r->lvl_id;
                                    ?>

                                    <table class="table table-responsive table-condensed table-bordered table-hover">
                                        <thead>
                                            <th colspan="3">
                                                <i class="fa fa-table"></i> &nbsp;
                                                <?=$r->lvl_name?>
                                                 (<?= $this->module->get_query(" SELECT COUNT(*) as ctr FROM v_section_students WHERE sy_id = ".$sy_id." AND  lvl_id = ".$lvl_id." ")->row('ctr') ?>)
                                            </th>
                                        </thead>
                                        <tbody>
                                            <?php 
                                                $qry =  $this->module->get_query("SELECT  dept_name, lvl_id, lvl_name,  sec_id, sec_name, COUNT(*) as cnt FROM v_section_students WHERE sy_id = ".$sy_id." AND `dept_id` = '".$dept_id."' GROUP BY sec_name ORDER BY lvl_sort, sec_sort ASC");
                                                ?>
                                                
                                                <?php

                                                    if($qry->num_rows() > 0 ):

                                                    $cnt =1;
                                                        foreach($qry->result() as $k):
                                                            $qry_lvl_id = $k->lvl_id;

                                                            if($lvl_id == $qry_lvl_id):
                                                ?>
                                                            <tr>
                                                                <td class="text-center width-3 vmiddle"><?=$cnt++?></td>
                                                                <td class=" vmiddle"><?=$k->sec_name;?></td>
                                                                <td class="width-5 vmiddle">
                                                                    <div class="btn-group">
                                                                        <button type="button" class="btn btn-success btn-xs dropdown-toggle" data-toggle="dropdown">
                                                                            Action <span class="caret"></span>
                                                                        </button>
                                                                        <ul class="dropdown-menu dropdown-default" role="menu">
                                                                            <li><a href="<?=base_url()?>admin/admission/<?=$k->sec_id?>"> <i class="fa fa-folder-open"></i> Open</a>
                                                                            </li>
                                                                            <!-- <li class="divider"></li> -->
                                                                            <li> <a href="<?=base_url()?>admin/print_class/<?=$k->sec_id?>"><i class="fa fa-print"></i> Print</a>
                                                                            </li>
                                                                            
                                                                        </ul>
                                                                    </div>
                                                                </td>
                                                            </tr>

                                             <?php       
                                                            endif;  
                                                        endforeach; ?>
                                                    <?php else: ?>

                                                        <tr>
                                                            <td colspan="3">No Records</td>
                                                        </tr>

                                            <?php   endif;
                                            ?> 
                                        </tbody>
                                    </table>

                                    <?php endforeach; ?>

                                    
                                </div>


                              <?php endforeach; ?>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div><!---END MAIN CONTENT -->
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
       
  });
</script>
</body>
</html>