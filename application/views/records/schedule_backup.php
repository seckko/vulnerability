<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <h1>Class <?= $title;?></h1>
        <hr/>
        
        <div class="panel panel-primary panel-shadow" data-collapsed="0"><!-- to apply shadow add class "panel-shadow" -->
           
            <!-- panel body -->
            <div class="panel-body">
                <table class="table table-bordered ">
                    <thead>
                        <tr>
                        <th class="text-center">No.</th>
                        <th>Subject</th>
                        <?php 
                            $level  = $this->module->get_query("SELECT * FROM grade_level WHERE dept_id <> 1 ");
                            foreach ($level->result() as $k): ?>
                            <th class="text-center"><?=$k->lvl_name?></th>
                        <?php endforeach; ?>
                        </tr>
                    </thead>

                    <tbody>
                        <?php 
                            $cnt        = 1; 
                            $subject    = $this->module->get_query("SELECT * FROM subject ORDER BY sub_sort ASC");
                           
                            foreach ($subject->result() as $v): ?>
                                <tr>
                                    <td class="text-center"><h5><?= $cnt++?></h5></td>
                                    <td ><h4><?=$v->sub_name?></h4></td>

                                    <?php 
                                        $sy_id = $this->module->get_active_sy();

                                        foreach ($level->result() as $k): 
                                            $gr_lvl  = $this->module->get_query("SELECT * FROM v_subject_teacher_assignment WHERE sub_id = ".$v->sub_id." AND lvl_id=".$k->lvl_id." AND sy_id =".$sy_id." ");
                                    ?>

                                    <td >
                                        
                                        <?php $section = $this->module->get_query("SELECT * FROM  v_sy_section WHERE lvl_id = ".$k->lvl_id."  AND sy_id =".$sy_id." "); 

                                         foreach($section->result() as $f):  

                                            $deptname   = $gr_lvl->row('dept_name');
                                            $deptcolor  = '';

                                            if($deptname == 'Primary'){
                                                $deptcolor  = 'panel-success';
                                            }else if($deptname == 'Intermediate'){
                                                $deptcolor  = 'panel-info';
                                            }else{
                                                $deptcolor  = 'panel-invert';
                                            }

                                            $tch_lastname   = $gr_lvl->row('tch_lastname');
                                            $tch_firstname  = $gr_lvl->row('tch_firstname');

                                            if(empty($tch_lastname ) || empty($tch_firstname) ){
                                                $teacher = '';
                                            }else{
                                                $teacher = $gr_lvl->row('tch_lastname').', '.$gr_lvl->row('tch_firstname');
                                            }

                                            

                                        ?>

                                        <div class="panel <?= $deptcolor ?>   panel-shadow">
                                            <div class="panel-heading">
                                                <div class="panel-title text-white" style="padding:3px 10px"> <?=$f->sec_name?></div>
                                            </div>

                                            <div class="panel-body" style="padding:5px">
                                               <?php if($gr_lvl->num_rows() <= 0): ?>
                                                    <span class="badge badge-danger">NA</span>
                                                <?php else: ?>
                                                    <span class="m-0"> <?=$teacher;?> </span>
                                               <?php endif; ?>
                                            </div>
                                        </div>

                                        <?php endforeach;?>

                                    </td>
                                    <?php endforeach; ?>

                                </tr>

                                    <?php  
                                    $sub_id         = $v->sub_id;
                                    $sub_category   = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));
                                    
                                    foreach($sub_category->result() as $s):
                                    ?>
                                        <tr>
                                            <td></td>
                                            <td> <h5>&nbsp;&nbsp;&nbsp;&nbsp;  <?=$s->subj_det_name?></h5></td> 

                                         <?php 

                                            foreach ($level->result() as $k): 
                                            $gr_lvl  = $this->module->get_query("SELECT * FROM v_subject_teacher_assignment WHERE sub_id = ".$v->sub_id." AND lvl_id=".$k->lvl_id." AND subj_det_id = ".$s->subj_det_id." AND sy_id =".$sy_id." ");
                                        ?> 

                                        <td >
                                            <!-- <?php print_r($gr_lvl->row('sub_name').' - '.$gr_lvl->row('subj_det_name')); ?> -->
                                            <!--  <?php print_r($gr_lvl->result()); ?>  -->

                                            <?php 
                                            $section = $this->module->get_query("SELECT * FROM  v_sy_section WHERE lvl_id = ".$k->lvl_id."  AND sy_id =".$sy_id." ");

                                            foreach($section->result() as $f): 

                                                $fsec_id  = $f->sec_id;
                                                $gsec_id = $gr_lvl->row('sec_id');

                                                $deptname   = $gr_lvl->row('dept_name');
                                                $deptcolor  = '';

                                                if($deptname == 'Primary'){
                                                    $deptcolor  = 'panel-success';
                                                }else if($deptname == 'Intermediate'){
                                                    $deptcolor  = 'panel-info';
                                                }else{
                                                    $deptcolor  = 'panel-invert';
                                                }


                                                $tch_lastname   = $gr_lvl->row('tch_lastname');
                                                $tch_firstname  = $gr_lvl->row('tch_firstname');

                                                if(empty($tch_lastname ) || empty($tch_firstname) ){
                                                    $teacher = '';
                                                }else{
                                                    $teacher = $gr_lvl->row('tch_lastname').', '.$gr_lvl->row('tch_firstname');
                                                }

                                               // if($fsec_id == $gsec_id):

                                                //echo $gsec_id.'-'.$fsec_id;
                                            ?>

                                            <div class="panel <?= $deptcolor ?>   panel-shadow">
                                                <div class="panel-heading">
                                                    <div class="panel-title text-white" style="padding:3px 10px"> <?=$f->sec_name?></div>
                                                </div>

                                                <div class="panel-body" style="padding:5px">
                                                   <?php if($gr_lvl->num_rows() <= 0): ?>
                                                        <span class="badge badge-danger">NA</span>
                                                    <?php else: ?>
                                                        <span class="m-0"> <?=$teacher;?> </span>
                                                   <?php endif; ?>
                                                </div>
                                            </div>

                                           
    
                                            <?php endforeach;?> 
                                            
                                               
                                        </td>

                                        <?php endforeach; ?>

                                        </tr>
                                <?php endforeach; ?>
                        <?php endforeach;?>
                    </tbody>
                    
                </table>
            </div>
        </div>

    </div><!---END MAIN CONTENT -->
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
        
       
  });
</script>
</body>
</html>