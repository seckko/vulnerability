<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <h1>Class List</h1>
        <hr/>

        <div class="row">
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-8">
                        <h3><strong><?=$section_details->row('lvl_name').' - '.$section_details->row('sec_name')?> </strong> <small> | <?=$section_details->row('dept_name')?> Department </small> </h3>
                    </div>
                    <div class="col-md-4 text-right">

                        <div class="btn-group">
                            <a href="<?=base_url()?>admin/excel_class/<?=$section_details->row('sec_id')?>" class="btn btn-success">Excel Class List</a>
                            <a href="<?=base_url()?>admin/print_class/<?=$section_details->row('sec_id')?>" class="btn btn-primary">Print Class List</a>
                        </div>

                    </div>
                </div>
                <table class="table table-bordered  table-hover table-condensed datatable" >
                    <thead>
                        <tr>
                            <th class="width-5 text-center">No.</th>
                            <th class="text-center">Student Name</th>
                            <th class="text-center">Type</th>
                            <th class="text-center">With Reservation</th>
                            <th class="text-center">Status</th>
                            <th class="width-10"></th>
                        </tr>
                    </thead>
                    
                    <tbody>
                        
                        <?php 
                        $cnt = 1;

                        $total_reserved = 0;
                        $total_enrolled = 0;

                        foreach($class_list->result() as $r):
                            $status         = $r->cl_status;
                            $is_reserved    = $r->cl_is_reserved;

                            if($status == 'Enrolled'){
                                $total_enrolled += 1; 
                            }else{
                                $total_reserved += 1; 
                            }
                        ?>

                        <tr>
                            <td class="text-center"><?=$cnt++?></td>
                            <td class="sname"><span class="tooltip-primary" data-toggle="tooltip" data-placement="top"  data-original-title="<?=$r->stud_birthdate?>"> <?=$r->stud_lastname.', '.$r->stud_firstname?></td>
                            <td class="text-center"><?=$r->stud_type == 'N'? 'New' : 'Old' ?></td>
                            <td class="text-center " ><span class="tooltip-primary" data-toggle="tooltip" data-placement="right"  data-original-title="<?=$r->cl_date_reserved?>"><?=($r->cl_is_reserved == 'Y' ? 'Yes' : 'No')?></span></td>
                            <td  class="text-center">
                                <?php 
                                    $status = $r->cl_status;

                                    if($status == 'Enrolled'){
                                        echo '<span class="badge badge-success badge-roundless"> <i class="fa fa-check"></i> Enrolled </span>';
                                    }else if($is_reserved == 'Y'){
                                        echo '<span class="badge badge-danger badge-roundless"> <i class="fa fa-times"></i> Reserved </span>';
                                    }else{
                                        echo '<span class="badge badge-default badge-roundless"> <i class="fa fa-leaf"></i> Not Reserved </span>';
                                    }
                                ?>
                                    
                            </td>
                            <td class="text-center">
                                <button class="btn btn-danger btn-xs btn_delete"  data-id="<?=$r->cl_id?>" > <i class="fa fa-times"></i></button>
                                <button class="btn btn-primary btn-xs btn_cl_id" data-studid="<?=$r->stud_id?>" data-id="<?=$r->cl_id?>" data-secid="<?=$r->sec_id?>" data-lvlid="<?=$r->lvl_id?>"> <i class="fa fa-arrow-right"></i></button>
                            </td>
                        </tr>

                        <?php endforeach;?>

                       
                    </tbody>

                    <tfoot>
                        <tr>
                            <td></td>
                            <td colspan="4" class="bold">Total Reserved</td>
                            <td class="text-center bold"><?=$total_reserved?></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td colspan="4" class="bold">Total Enrolled</td>
                            <td class="text-center bold"><?=$total_enrolled?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="col-md-4">
                <div class="panel panel-default mt-20">
                    <div class="panel-heading">
                        <div class="panel-title">Change Section</div>
                    </div>
                    <div class="panel-body">

                        <form  id="frmSubmit" class="form-horizontal form-groups-bordered" action="<?php echo base_url()?>admin/change_section" method="POST">
                            <div class="msg"></div>

                             <div class="form-group">
                                <label class="col-sm-3 control-label">Learners Name</label>
                                
                                <div class="col-sm-9">
                                    <h3 class="stud_name m-0"> Select Learner</h3>
                                    <input type="hidden" name="stud_id" class="stud_id">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 control-label">Select Level</label>
                                
                                <div class="col-sm-9">
                                    <select class="form-control lvl_id" name="lvl_id" required="">
                                        <option selected="" disabled="">Select</option>
                                        <?php foreach($grade_level->result() as $g):?>
                                        <option value="<?=$g->lvl_id?>"><?=$g->lvl_name?></option>
                                        <?php endforeach;?>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 control-label">Select Section</label>
                                
                                <div class="col-sm-9">
                                    <select class="form-control sec_id" name="sec_id" >
                                        <option selected="" disabled="">Select</option>
                                    </select>
                                    <input class="form-control cl_id" type="hidden" name="cl_id" >
                                    <input class="form-control" type="hidden" name="dept_name" value="<?=$section_details->row('dept_name')?>">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-9 col-md-offset-3">
                                    <button class="btn btn-success" type="submit">Confirm Changes</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>

                <!-- <div class="panel panel-default mt-20">
                    <div class="panel-heading">
                        <div class="panel-title">Enrolled Student</div>
                    </div>
                    <div class="panel-body">
                
                        <form  id="frmSubmit2" class="form-horizontal form-groups-bordered" action="<?php echo base_url()?>admin/enroll_student" method="POST">
                            <div class="msg"></div>
                
                
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Select Level</label>
                                
                                <div class="col-sm-9">
                                    <select class="form-control" name="cl_status" required="">
                                        <option selected="" value="Enrolled" >Enrolled</option>
                                    </select>
                                </div>
                            </div>
                
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Date Enrolled</label>
                                
                                <div class="col-sm-9">
                                    <input type="text" class="form-control date" name="cl_date_enrolled" required="" value="<?=date('Y-m-d')?>" autocomplete="off">
                                    <input class="form-control cl_id" type="hidden" name="cl_id" >
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-9 col-md-offset-3">
                                    <button class="btn btn-success" type="submit">Enroll Learner</button>
                                </div>
                            </div>
                        </form>
                    </div> -->


                    <div class="panel panel-default mt-20">
                    <div class="panel-heading">
                        <div class="panel-title">Direct Enrollment</div>
                    </div>
                    <div class="panel-body">

                        <form  id="frmSubmit3" class="form-horizontal form-groups-bordered" action="<?php echo base_url()?>admin/direct_enroll_student" method="POST">
                            <div class="msg"></div>


                            <div class="form-group">
                                <label class="col-sm-3 control-label">Select Level</label>
                                
                                <div class="col-sm-9">
                                    <select class="form-control" name="cl_status" required="">
                                        <option selected="" value="Enrolled" >Enrolled</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 control-label">Date Enrolled</label>
                                
                                <div class="col-sm-9">
                                    <input type="text" class="form-control date" name="cl_date_enrolled" required="" value="<?=date('Y-m-d')?>" autocomplete="off">
                                    <input class="form-control cl_id" type="hidden" name="cl_id" >
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-9 col-md-offset-3">
                                    <button class="btn btn-success" type="submit">Enroll Learner</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>

                </div>


            </div>
            
        </div>


    </div><!---END MAIN CONTENT -->
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
        $('#frmSubmit, #frmSubmit3').crud();

        $('#frmSubmit2').crud();

        $('.date').mask('0000-00-00', {placeholder: "yyyy-mm-dd"});

        

        //DELETE function
        $(document.body).on("click",".delete",function(e){
            var tr = $(this).closest('tr');
            var id = tr.find('.delete').attr('data-id');

            $.ajax({url: base_url+'admin/delete_section_assignment/'+id, success: function(result){
                tr.fadeOut(1000);
                window.setTimeout(function(){location.reload()},500);
            }});
        });

        $(document.body).on("click",".btn_delete",function(e){
            var tr = $(this).closest('tr');
            var id = tr.find('.btn_delete').attr('data-id');


            if (confirm('Do you want to delete this record?')) {

                $.ajax({url: base_url+'admin/delete_class_list/'+id, success: function(result){
                    tr.fadeOut(1000);
                    window.setTimeout(function(){location.reload()},500);
                }});
            } else {
                
            }


            
        });



        $(document.body).on("click",".btn_cl_id",function(e){
            cl_id   = $(this).data('id');
            lvl_id  = $(this).data('lvlid');
            sec_id  = $(this).data('secid');

            stud_id = $(this).data('studid');

            tr = $(this).closest('tr');
            stud_name = tr.find('.sname').text();
            $('.stud_name').html(stud_name);

            $('.lvl_id').val(lvl_id);

            $('.sec_id').load(base_url+'admin/get_lvl_section/'+lvl_id+'/'+sec_id);
            $('.cl_id').val(cl_id);
            $('.stud_id').val(stud_id);

            //console.log(cl_id);
        });

        $(document.body).on("change",".lvl_id",function(e){
            lvl_id  = $(this).val();

            $('.sec_id').load(base_url+'admin/get_section/'+lvl_id);

        });

       /* $(".print").click(function(){

        });*/
       
  });
</script>
</body>
</html>