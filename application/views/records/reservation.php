<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        <h1><?=$title?></h1>
        <hr/>
        
        <div class="row">
            <div class="col-md-8">
                
                    <ul class="nav nav-tabs bordered"><!-- available classes "bordered", "right-aligned" -->
                        
                        <li class="active">
                            <a href="#old" data-toggle="tab">
                                <span class="visible-xs"><i class="entypo-home"></i></span>
                                <span class="hidden-xs">Old Student</span>
                            </a>
                        </li>

                        <li >
                            <a href="#new" data-toggle="tab">
                                <span class="visible-xs"><i class="entypo-user"></i></span>
                                <span class="hidden-xs">New Student</span>
                            </a>
                        </li>
         
                    </ul>
                    
                    <div class="tab-content">

                        <div class="tab-pane active" id="old">
                            <form method="post"  action="<?=base_url()?>admin/reservation" class="form-horizontal form-groups-bordered frmSubmit">

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Student Name</label>
                                    
                                    <div class="col-sm-8">

                                        <select class="form-control select2" name="stud_id" required="">
                                                <option selected="" disabled="">Select</option>
                                            <?php foreach ($student->result() as $k):?>
                                                <option value="<?=$k->stud_id?>"><?=strtoupper($k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix.' '.$k->stud_middlename)?></option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">School Year</label>
                                    
                                    <div class="col-sm-8">

                                        <select class="form-control " name="sy_id" required="">
                                                <option selected="" disabled="">Select</option>
                                            <?php foreach ($school_year->result() as $s):?>
                                                <option <?=($s->sy_selected == 'Y' ? 'selected' : '')?> value="<?=$s->sy_id?>"><?=$s->sy_name.' '.($s->sy_is_active == 'N' ? '' : '(Active)')?></option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Section</label>
                                    
                                    <div class="col-sm-8">

                                        <select class="form-control " name="sec_id" required="">
                                                <option selected="" disabled="">Select</option>
                                            <?php foreach ($section->result() as $s):?>
                                                <option value="<?=$s->sec_id?>"><?=$s->lvl_name.' - '.$s->sec_name?></option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Date Reserve</label>
                                    
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control date" name="res_date" required="" value="<?=date('Y-m-d')?>">
                                    </div>
                                  </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-3 col-sm-5">
                                        <button type="submit" class="btn btn-success"> <i class="fa fa-check"></i> Create Reservation</button>
                                        <button type="reset" class="btn btn-default"> Clear</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="tab-pane " id="new">
                             <form method="post"  action="<?=base_url()?>admin/reservation" class="form-horizontal form-groups-bordered frmSubmit">
                                <div class="form-group mb-0">
                                    <label class="col-sm-3 control-label">Last Name</label>
                                  <div class="col-md-6 ">
                                    <input type="text" class="form-control" name="stud_lastname" autofocus="" autocomplete="off" >
                                  </div>
                                </div>

                                <div class="form-group mb-0">
                                    <label class="col-sm-3 control-label">First Name</label>
                                  <div class="col-md-6 ">
                                    <input type="text" class="form-control" name="stud_firstname" autocomplete="off" >
                                  </div>
                                </div>

                                <div class="form-group mb-0">
                                    <label class="col-sm-3 control-label">Middle Name</label>
                                  <div class="col-md-6 ">
                                    <input type="text" class="form-control" name="stud_middlename"  autocomplete="off">
                                  </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Date Reserve</label>
                                    
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control date" name="res_date_new" required="" value="<?=date('Y-m-d')?>">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Section</label>
                                    
                                    <div class="col-sm-8">

                                        <select class="form-control " name="sec_id_new" required="">
                                                <option selected="" disabled="">Select</option>
                                            <?php foreach ($section->result() as $s):?>
                                                <option value="<?=$s->sec_id?>"><?=$s->lvl_name.' - '.$s->sec_name?></option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">School Year</label>
                                    
                                    <div class="col-sm-8">

                                        <select class="form-control " name="sy_id_new" required="">
                                                <option selected="" disabled="">Select</option>
                                            <?php foreach ($school_year->result() as $s):?>
                                                <option <?=($s->sy_selected == 'Y' ? 'selected' : '')?> value="<?=$s->sy_id?>"><?=$s->sy_name.' '.($s->sy_is_active == 'N' ? '' : '(Active)')?></option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-3 col-sm-5">
                                        <button type="submit" class="btn btn-success"> <i class="fa fa-check"></i> Create Reservation</button>
                                        <button type="reset" class="btn btn-default"> Clear</button>
                                    </div>
                                </div>

                             </form>
                        </div>
                      
                    </div>
                    
            </div> 

            <div class="col-md-4 msg"></div> 
        </div>

        <br/>

         <div class="row">
            <div class="col-md-12">
                 <div class="table-responsive"> 
                    <table  class="table table-bordered table-primary table-hover datatable">
                      <thead>
                        <tr>
                          <th></th>
                          <th>Fullname</th>
                          <th>Type</th>
                          <th>Level & Section</th>
                          <th>Date Reserve</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                          <?php
                            $cnt = 1;
                             foreach($reservation->result() as $r): ?>
                            <tr>
                              <td><?=$cnt++?></td>
                              <td  ><?= ucfirst($r->stud_fullname)?> </td>
                              <td><?= $r->stud_type?> </td>
                              <td><?= $r->lvl_name.' - '. $r->sec_name?> </td>
                              <td><?=$r->res_date?></td>
                              <td>
                                  <button class="btn btn-danger btn-xs delete" data-id="<?= $r->res_id ?>">Delete</button>
                              </td>
                            </tr>
                          <?php endforeach; ?>
                      </tbody>
                    </table>
                </div>
            </div>
        </div>




    </div><!---END MAIN CONTENT -->
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
        //$('#frmSubmit, #frmSubmitNew').crud_refresh();
        

        $('.frmSubmit').submit(function(e){
          e.preventDefault(); 

          var base    = $(this);
          var msg     = $(".msg");
          var btn     = base.find("button");
          
          $.ajax({
                type:base.attr("method"),//get/post
                data:base.serialize(),
                url:base.attr("action"),//location for the url
                beforeSend:function(){
                  msg.empty().html(alert_minimal('Processing . . .'));
                  btn.prop("disabled",true);
                },
                success:function(rrdata){

                  btn.prop("disabled",false);
                  var rdata = $.parseJSON(rrdata);
                  if(rdata.stat){
                  msg.empty().html(alert_success(rdata.msg));
                  self.location = base_url+'admin/reservation';
                   //$('.frmSubmit')[0].reset();
                   //location.reload();
                  }
                  else{   
                    msg.empty().html(alert_error(rdata.msg));
                  }
                  
                },
                error:function(rdata){
                  btn.prop("disabled",false);
                  msg.empty().html(alert_error('An error occured, please try again later'));
                }
          });

      });


       

        //DELETE function
        $(document.body).on("click",".delete",function(e){
            var tr = $(this).closest('tr');
            var id = tr.find('.delete').attr('data-id');

            $.ajax({url: base_url+'admin/delete_reservation/'+id, success: function(result){
                tr.fadeOut(1000);
                window.setTimeout(function(){location.reload()},500);
            }});
        });

        $('.date').mask('0000-00-00', {placeholder: "yyyy-mm-dd"});

  });
</script>
</body>
</html>