<?php 

    
  $usr_name         = $this->session->userdata('usr_name');
  $prtl_fname       = $this->session->userdata('prtl_fname');
  $prtl_lname       = $this->session->userdata('prtl_lname');
  $usr_is_login     = $this->session->userdata('usr_is_login');
  $sy_id            = $this->module->get_active_sy();

  /*$where           = 'tch_id = "'.$tch_id.'"  AND sy_id = "'.$sy_id.'" ';

  if( ($usr_type <> 'Faculty') || empty($tch_id) ){
    header('Location: '.base_url());
  }*/

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body" >

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/portal_sidebar')?>
        </div>

    </div>

    <div class="main-content">
      <h3 class="mb-0">Learner Registration</h3>
      <span>Enroll and monitor your child's academic performance through this portal.</span>

      <!-- <div class="row">
      
        <div class="col-lg-8 col-md-8 col-sm-9 col-xs-12">
          <h3 class="mb-0">Learner Registration</h3>
          <span>Enroll and monitor your child's academic performance through this portal.</span>
        </div>
      
        <div class="col-lg-4 col-md-4 col-sm-3 col-xs-12 text-right">
          <br/><br/>
          <button class="btn btn-success add"  type="button"><i class="fa fa-plus"></i> Add Learner</button>
        </div>
      
      </div> -->
        
        <hr/>

        <?php $this->load->view('inc/breadcrumbs')?>

        <div class="row">

            <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12">
             <div class="panel panel-success enroll_panel">
                  <div class="panel-heading">
                      <div class="panel-title">
                          <h4 class="text-white">Register a Learner (Kindly check the School ID of the child you want to register) </h4>
                      </div>
                      
                  </div>
              
                  <div class="panel-body">

                    <form method="post" id="frmSubmit" action="<?=base_url()?>home/register_learner" >

                      <div class="msg"></div>

                      <div class="row">

                          <div class="col-lg-6 col-md-12 col-sm-12 col-sx-12">
                            <div class="form-group">
                              <label>Learner Reference Number (LRN)</label>
                              <input class="form-control digit" type="text" name="stud_lrn" autofocus="" maxlength="12"  autocomplete="off" >
                            </div>
                          </div>

                          <div class="col-lg-3 col-md-6 col-sm-12 col-sx-12">
                            <div class="form-group">
                              <label>Student Number</label>
                              <input class="form-control stud_no" type="text" name="stud_no" autofocus="" required="" maxlength="8" autocomplete="off" >
                            </div>
                          </div>

                          <div class="col-lg-3 col-md-6 col-sm-12 col-sx-12">
                            <div class="form-group">
                              <label>Learners Birthdate </label>
                                <input type="text" class="form-control datepicker stud_birthdate" name="stud_birthdate" required="" autocomplete="off"  data-format="mm/dd/yyyy">
                                <span class="date_msg text-danger pt-5"></span> 
                                  
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-12 col-md-12 col-sm-12 col-sx-12">
                              <div class="form-group">
                                <button class="btn btn-success" type="submit">Register</button>
                                <button class="btn btn-default clear" type="reset">Clear</button>
                                <!-- <button class="btn btn-default close_btn" type="button">Close</button> -->
                              </div>
                          </div>
                        </div>

                    </form>

                  </div>
              </div> 
            </div>

            <div class="col-lg-10 col-md-12 col-sm-12 col-xs-12 ">
              <table class="table table-condensed  table-hover datatable responsive">
                <thead>
                  <th class="hidden-xs">No.</th>
                  <th class="">Student No.</th>
                  <th class="">LRN</th>
                  <th>Learner's Name</th>
                  <th>Status</th>
                  <th class="width-25"></th>
                </thead>
                <tbody>
                  <?php 

                    $cnt = 1;
                    foreach($enrollment->result() as $r): 
                      $stud_name = $r->stud_lastname.', '.$r->stud_firstname;
                      $is_approve = $r->prtle_stud_approve;
                      $gr_sec     = $r->lvl_name.' - '.$r->sec_name;
                      $prtle_id   = $r->prtle_id;
                    ?>
                      <tr>
                        <td class="hidden-xs"><?=$cnt++?></td>
                        <td class=""><?=$r->stud_no?></td>
                        <td class=""><?=$r->stud_lrn?></td>
                        <th><?=$stud_name?></th>
                         <td><?=($r->prtle_stud_approve == 'Y' ? '' : '<span class="label label-default">Pending</span>')?></td> 
                        <td class="text-right">
                          <!-- <a href="<?=base_url()?>portal/view_profile/<?=$r->stud_id?>" class="btn btn-xs btn-blue"> <i class="fa fa-search"></i> View</a> -->

                          <div class="btn-group">

                            <button class="btn  btn-xs view <?=($is_approve == 'N') ? 'btn-info' : 'disabled btn-default' ?>" data-id="<?=$prtle_id?>" data-sec="<?=$gr_sec?>" data-name="<?=$stud_name?>"><i class="fa fa-eye"></i></button>
                            <button class="btn btn-danger btn-xs remove" data-id="<?=$prtle_id?>"> <i class="fa fa-times"></i></button>
                          </div>
                        </td> 
                      </tr>
                  <?php endforeach;?>
                </tbody>
              </table>
            </div>


        </div>
    </div>
</div>

        <!-- Modal 7 (Ajax Modal)-->
  <div class="modal fade" id="modal-7">
    <div class="modal-dialog">
      <div class="modal-content">
        
        <!-- <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Delete record</h4>
        </div> -->
        
        <div class="modal-body modal-1 text-center">
            <p class="mt-0 text-danger big-icon"><i class="entypo-cancel-circled"></i></p>
            <h3 class="m-0">Are you sure you want to remove this record?</h3>
        </div>
        
        <div class="modal-footer">
          <input type="hidden" class="prtle_id" >
          <button type="button" class="btn btn-danger confirm"><i class="fa fa-check"></i> Yes</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal 7 (Ajax Modal)-->
  <div class="modal fade" id="modal-8">
    <div class="modal-dialog" >
      <div class="modal-content">
        <form method="post" id="frmSubmit2" action="<?=base_url()?>home/confirm_learner" >
          <div class="modal-header" style="background-color: #21a9e1; border-color:#21a9e1;">
            <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->
            <h4 class="modal-title text-white">Confirm Learner</h4>
          </div>
          
          <div class="modal-body modal-1 ">
              <div class="msg"></div>
                <div class="form-group  ">
                  <h2 class="stud_name m-0"></h2>
                  <h4 class="gr_section m-0"></h4>

                  

                  <input type="hidden" class="prtle_id" name="prtle_id">
                </div>

                <div class="form-group ">
                  <label class="title-header">Your 6 digit code</label>
                    <input class="form-control input-lg text-center code" maxlength="6" type="text" name="prtle_code" autofocus="" autocomplete="off" placeholder="xxxxxx">
                  
                </div>

                <div class="form-group ">
                  <button type="submit" class="btn btn-info">Submit Code</button>
                  <button type="button" class="btn btn-default close_btn" data-dismiss="modal">Cancel</button>
                </div>
              

          </div>
        
        </form>
      </div>
    </div>
  </div>


<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    $('.stud_no').mask('00-000');

    $('.datepicker').datepicker().on('changeDate', function (ev) {

        $(this).datepicker('hide');


    });



    $('#frmSubmit').enroll_student();

    $('#frmSubmit2').confirm_student();

    $('.view').click(function(e){
        e.preventDefault();
        name    = $(this).data('name');
        gr_sec  = $(this).data('sec');
        id      = $(this).data('id');

        $('.stud_name').html(name);
        $('.gr_section').html(gr_sec);
        $('.prtle_id').val(id);

        $('.msg').empty();

        $('#modal-8').modal({backdrop: 'static', keyboard: false});
        
        //$('#modal-8').modal({show:true, {backdrop: 'static'} });
    
    });

    $('.remove').click(function(e){
        e.preventDefault();
        id = $(this).data('id');

        $('.prtle_id').val(id);
        $('.msg').empty();

        $('#modal-7').modal({backdrop: 'static', keyboard: false});



        /*if (confirm('Are you sure you want to delete this record?')) {
            $.ajax({url: base_url+'portal/delete_enrollment/'+id, success: function(result){
                window.setTimeout(function(){location.reload()},2000);
            }});
        }*/
    });

    $('.confirm').click(function(e){
        e.preventDefault();
        id = $('.prtle_id').val();

        $.ajax({url: base_url+'home/delete_enrollment/'+id, 
            success: function(result){
            window.setTimeout(function(){location.reload()},500);
        }});

    });

    $('.stud_birthdate').mask('00/00/0000', {placeholder: "mm/dd/yyyy"});

    $('.stud_birthdate').on('change', function(){
      var birthdate = $(this).val();
      var date_now  = $('#date_now').val();

      if (Date.parse(birthdate) > Date.parse(date_now)) {
        $(this).val('');
        $('.date_msg').html('Invalid date format (mm/dd/yyyy)');
      }else{
        if(validate_date(birthdate) == true ){
          $('.date_msg').html('');
        }else{
          $(this).val('');
          $('.date_msg').html('Invalid date format (mm/dd/yyyy)');
        }
      }
      
    });


    $(".digit").keypress(function (e) {
       //if the letter is not digit then display error and don't type anything
       if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
          //display error message
          $("#errmsg").html("Digits Only").show().fadeOut("slow");
                 return false;
      }
    });

    $('.add').click(function(e){
      e.preventDefault()

      $('.enroll_panel').fadeIn().removeClass('hidden');

    });

    $('.close_btn').click(function(e){
      e.preventDefault()

      //$('.enroll_panel').fadeOut().addClass('hidden');
      $('.msg').empty();
      $('#frmSubmit')[0].reset();
      $('.code').val('');
    });

    $('.clear').click(function(){
      $('.msg').empty().fadeOut();
    });

    /*$('.logout').click(function(e){
          e.preventDefault();
          $('#modal-9').modal({backdrop: 'static', keyboard: false});
    });*/




    function validate_date(birthdate){
      var bdate = birthdate;
      var comp = bdate.split('/');
      var m = parseInt(comp[0], 10);
      var d = parseInt(comp[1], 10);
      var y = parseInt(comp[2], 10);
      var date = new Date(y,m-1,d);
      if (date.getFullYear() == y && date.getMonth() + 1 == m && date.getDate() == d) {
        return true;
      } else {
        return false;
      }
    }

    
       

  });
</script>
</body>
</html>