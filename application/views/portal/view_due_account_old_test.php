<?php 

  $prtl_id        = $this->session->userdata('prtl_id');
  $usr_name         = $this->session->userdata('usr_name');
  $prtl_fname       = $this->session->userdata('prtl_fname');
  $prtl_lname       = $this->session->userdata('prtl_lname');
  $usr_is_login     = $this->session->userdata('usr_is_login');
  $sy_id            = $this->module->get_active_sy();

  $sy_last_payment  = $this->module->table_where('school_year', array('sy_id' => $sy_id))->row('sy_last_payment');

  $uri_sy           = $this->uri->segment(3);
  if(empty($uri_sy)){
    $sy_id = $sy_id;
  }else{
    $sy_id = $uri_sy;
  }
?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body " >

<div class="page-container">

    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/portal_sidebar')?>
        </div>

    </div>

    <div class="main-content">
        <h3 ><?=$title?></h3>
        <hr/>

        <div class="profile-env">
            <section class="profile-info-tabs m-10" style="margin-top: -20px">
                <div class="row">
                    <div class="col-md-4 col-sm-5 col-xs-12">
                        <label>Learner's Name</label>
                          <select class="form-control  has-success stud_id" name="stud_id"  >  <!--  onchange= "location = this.value" -->
                            <option disabled="" selected="">Select Learner</option>             
                            <?php 
                                foreach ($my_learners->result() as $l):
                                  $lstud_id   = $l->stud_id;
                                  $lstud_name = $l->stud_lastname.', '. $l->stud_firstname.' '. $l->stud_suffix;
                            ?>
                                <option value="<?=$lstud_id?>" > <?= $lstud_name?></option>
                            <?php endforeach; ?>
                        </select>              
                    </div>
                    <div class="col-md-4 col-sm-5 col-xs-12">
                      <label>School Year</label>
                        <select class="form-control  has-success sy_id" name="sy_id" >  <!--  onchange= "location = this.value" -->
                          <option disabled="" selected="">Select School Year</option>             
                          <?php 
                              foreach ($school_year->result() as $k):
                                $ksy_id = $k->sy_id;
                          ?>
                              <option value="<?=$k->sy_id?>" <?=($sy_id == $ksy_id ? 'selected="" ' : ''  )?> > S Y. <?= $k->sy_name?> <?= $k->sy_is_active == 'Y' ? '(Active)' : '' ?></option>
                          <?php endforeach; ?>
                      </select>
                    </div>
                    <!-- <div class="col-md-2 col-xs-2">
                      <button class="btn btn-success mt-20 view_grades" type="button"> <i class="fa fa-search"> </i> View Grades</button>
                    </div> -->
                </div>
            </section>
            <div class="row">
              <div class="col-md-12 msg"></div>
            </div>
          <!-- </form> -->
        </div>

  </div>

        
        

    

    
</div> <!-- end of body container -->


<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    $('.stud_id, .sy_id').change(function(){
          var stud_id = $('.stud_id').val();
          var sy_id   = $('.sy_id').val();

          $.ajax({
            url:base_url+'home/view_grades/'+stud_id+'/'+sy_id,//location for the url
            beforeSend:function(){
              $('.msg').empty().html('<h3>Processing . . .</h3>');

            },
            success:function(rrdata){
              $('.msg').load(base_url+'home/view_due_accounts/'+stud_id+'/'+sy_id);
            },
            error:function(rdata){
              $('.msg').empty().html(alert_error('An error occured, please try again later'));
            }
          });


          //$('.msg').load(base_url+'portal/view_grades/'+stud_id+'/'+sy_id);
    });
       
     /*$('.sy_id').change(function(){
        val = $(this).val();
        stud_id = $('ul.ul_student').find('li.active').data('id');

        window.location = base_url+'portal/view_due_accounts/'+val+'/'+stud_id;
     });*/

  });
</script>
</body>
</html>