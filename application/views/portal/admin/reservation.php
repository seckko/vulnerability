
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body " >

<div class="page-container">

    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/portal_sidebar')?>
        </div>

    </div>

    <div class="main-content">

      <h3 >Reservation</h3>
      <hr/>

      <?php $this->load->view('inc/breadcrumbs')?>
      <br/>
      
      
      <div class="row">
        <div class="col-ld-6 col-md-6 col-sm-10 col-xs-12">
          
          <?php if(!empty($my_learners)):?>
          <h3>Make Reservations</h3>
          <div class="panel panel-default"> 
            <div class="panel-heading" style="background: #1f232a">
              <h3 class="panel-title text-white">Choose Learner and Section</h3>
            </div>

            <form method="post" id="frmSubmit" action="<?=base_url()?>padmin/proceed_payment" >

            <div class="panel-body">
                
                  <?php 
                    $cnt = 1;
                    foreach($my_learners as $r):

                    $lvl_id        = $r['next_lvl_id'];
                    $next_section  = $r['next_section'];
                  ?>
                  <div class="panel panel-primary">
                    <div class="panel-body">
                    <h3 class="stud_name" ><?=$r['stud_name']?></h3>

                    <table class="table table-primary table-condensed ">
                      
                      <tbody>
                       <!--  <tr>
                         <td class="bold">Grade Level</td>
                         <td class="bold">Section</td>
                       </tr> -->

                          <tr class="row_stud">
                              <!-- <td class="vmiddle"><?=$r['next_sy_name']?></td> -->
                              <td >
                                <label class="title-header"><small>Grade Level</small></label>
                                <h5 class="m-0 "><?=$r['next_lvl_name']?> | <span ><?=$r['next_dept_name']?></span></h5>
                                
                                
                              </td>
                              <td >
                                <label class="title-header"><small>Section</small></label>
                              
                                <select class="form-control  has-success sec_id mb-5"  name="res<?=$cnt?>[sec_id]"  >  <!--  onchange= "location = this.value" -->
                                    <option disabled="" selected="" value="0">Choose one</option>             
                                    <?php  foreach($next_section->result() as $l):  ?>
                                       <option value="<?=$l->sec_id?>" > <?= $l->sec_name?></option> 
                                    <?php endforeach; ?>
                                </select> 

                                <div class="msg_stud"></div>
                                <input type="hidden" class="stud_name" name="res<?=$cnt?>[stud_name]"  value="<?=$r['stud_name']?>">
                                <input type="hidden" class="dept_name" name="res<?=$cnt?>[dept_name]"  value="<?=$r['next_dept_name']?>">
                                <input type="hidden" class="lvl_name" name="res<?=$cnt?>[lvl_name]"  value="<?=$r['next_lvl_name']?>">
                                <input type="hidden" class="stud_name" name="res<?=$cnt?>[stud_name]"  value="<?=$r['stud_name']?>">
                                
                                <input type="hidden" class="stud_id" name="res<?=$cnt?>[stud_id]" value="<?=$r['stud_id']?>">
                                <input type="hidden" class="sy_id" name="res<?=$cnt?>[sy_id]" value="<?=$r['next_sy_id']?>" >
                                <input type="hidden" class="lvl_id" name="res<?=$cnt++?>[lvl_id]" value="<?=$r['next_lvl_id']?>">
                                
                              </td>
                               <!-- <td>
                                <button class="btn btn-sm btn-danger remove"><i class="fa fa-times"></i></button>
                               
                               
                                
                                <button class="btn btn-sm btn-success select"><i class="fa fa-check"></i> Select</button>
                                                     </td>  -->
                          </tr>
                      </tbody>
                    </table>
                    </div>
                  </div>
                  <?php endforeach; ?>

                <div class="msg"></div>
            </div>

            <div class="panel-footer">
                
                  <div class="responsive text-right">
                    <div class="form-group">
                      <button class="btn btn-lg btn-primary" type="submit">Reserve</button>
                      
                    </div>
                  </div>
            </div>

            </form>
          </div>

          <?php endif;?>

        </div>
          
      

      </div>

      

      <div class="row">
        <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
          
          
          
          <h3>My Reservation</h3>
          
          <table class="table table-primary datatable">
            <thead>
              <th>No.</th>
              <th>Reference No.</th>
              <th>Date Reserve</th>
              <th>Receipt</th>
              <th></th>
            </thead>
            <tbody>
              <?php 
                  $cnt = 1;
                  foreach($pending_reservation->result() as $r):?>
                <tr>
                  <td><?=$cnt++?></td>
                  <td><?=$r->prhdr_no?></td>
                  <td><?=date('M d, Y h:m a',strtotime($r->prhdr_date_reserved));?></td>
                  <td>
                    <?php 
                    if(!empty($r->prhdr_receipt_img)):?>
                      <a href="#" data-img="<?=base_url()?>asset/uploads/receipt/<?=$r->prhdr_receipt_img?> " class="view " > <i class="fa fa-picture-o"></i>  View Image </a>
                   <?php endif; ?>
                      
                  </td>
                  <td>
                    <a href="<?=base_url()?>padmin/update_reservation/<?=$r->prhdr_id?>" class="btn btn-primary btn-sm">View</a>
                  </td>
                </tr>

              <?php endforeach;?>
            </tbody>
          </table>


          <?php if($my_reservation->num_rows() > 0):  ?>

          <div class="row">
            <?php foreach($my_reservation->result() as $r): 
              $stud_name      = $r->stud_lastname.', '.$r->stud_firstname.' '.$r->stud_suffix; 
              $sy_name        = $r->sy_name;
              $gr_sec         = $r->lvl_name.' - '.$r->sec_name;
              $date_reserved  = date('M d, Y',strtotime($r->prd_date_approved));
              $status         = $r->prd_status;

              ?>

          


              <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                  <div class="member-entry p-10">

                    <div class="text-center">
                      <img src="<?=base_url()?>asset/uploads/blank.jpg" class="img-circle" style="width:90px; height: 90px;"  >
                      <h4 class="bold mb-0 "><?=$stud_name?></h4>
                    </div>
                    
                    <br/>

                    <table class="responsive  table-condensed table  mb-0">

                      <thead>
                        <th colspan="2" class="vmiddle bold" style="background-color: #f5f5f5;"> 
                          <i class="fa fa-calendar"></i> &nbsp; Reservation Details

                        </th>
                      </thead>

                      <tbody>

                      <tr>
                          <td class="vmiddle"> School Year</td>
                          <td class="vmiddle"><?=$sy_name?></td>
                        </tr>

                        <tr>
                          <td class="vmiddle"> Grade & Section</td>
                          <td class="vmiddle"><?=$gr_sec?></td>
                        </tr>

                        <tr>
                          <td class="vmiddle"> Date</td>
                          <td class="vmiddle"><?=$date_reserved?></td>
                        </tr>

                        <tr>
                          <td class="vmiddle"> Status</td>
                          <td class="vmiddle">
                            <?php 
                              if($status=='Approved'):?>
                                <span class="badge badge-success badge-roundless">RESERVED</span>
                              <?php else: ?>
                                <span class="badge badge-default badge-roundless">PENDING</span>
                            <?php endif;?>
                              
                          </td>
                        </tr>   
                      </tbody>
                    </table>

                    <!-- <?php if($status == 'Pending'): ?>
                    
                      <hr/>
                    
                      <a href="<?=base_url()?>padmin/update_reservation/" class="btn btn-primary btn-block"> Update Reservation</a>
                    
                    <?php endif?> -->

                  </div>
              </div>

            <?php endforeach; ?>
          </div>


           <?php endif; ?>

        </div>
      </div>









        <!-- Modal 7 (Ajax Modal)-->
        <div class="modal fade" id="modal-1">
          <div class="modal-dialog" >
            <div class="modal-content">
              
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title">View Receipt</h4>
                </div>
                
                <div class="modal-body modal-1 p-0">
                   
                </div>

                <!-- <div class="modal-footer">
                  <button type="button" class="btn btn-default close_btn" data-dismiss="modal">Close</button>
                </div> -->
            </div>
          </div>
        </div>

    
      
    </div>






    
</div> <!-- end of body container -->


<?= $this->load->view('inc/js')?>


<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

      $('#frmSubmit').crud_simple();


      $('.remove').click(function(){
         $(this).closest('tr').remove();
      });

      $('.sec_id').on('change', function(){
        tr        = $(this).closest('tr');

        sy_id     = tr.find('.sy_id').val();
        dept_name = tr.find('.dept_name').val();
        sec_id    = tr.find('.sec_id option:selected').val();
        sec       = tr.find('.sec_id');
        msg       = tr.find('.msg_stud');

        if(sec_id <= 0){
          msg.html('<span class="text-danger mt-5"> <i class="fa fa-exclamation-triangle"></i> Select section</span>');
        }else{
          //msg.load(base_url+'padmin/check_available_slot/'+sy_id+'/'+sec_id+'/'+dept_name);


          $.ajax({
              url:base_url+'padmin/check_available_slot/'+sy_id+'/'+sec_id+'/'+dept_name,//location for the url
              beforeSend:function(){
                //msg.empty().html('Processing...');
              },
              success:function(rrdata){
                var rdata = $.parseJSON(rrdata);

                if(!rdata.stat){
                  msg.empty().html(rdata.msg); 
                  sec.prop('selectedIndex',0);
                  //sec.prop('selected', true);
                }else{
                   msg.empty();
                 

                //$('.tbl_reservation tr:last').after('<tr><td>'+name+'</td><td class="text-right">1,000.00</td></tr>');
                }

              },
              error:function(rdata){
                msg.empty().html('An error occured, please try again later');
              }
            });

        }

      });


      $('.view').click(function(e){
        e.preventDefault();

        $('#modal-1').modal({backdrop: 'static', keyboard: false});

        src = $(this).data('img');

        $('.modal-1').html('<a href="'+src+'" target="_blank"><img class="responsive" src="'+src+'" width="100%"></img></a>');
        console.log(src);

      });





  });
</script>
</body>
</html>