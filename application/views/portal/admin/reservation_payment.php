
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body " >

<div class="page-container">

    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/portal_sidebar')?>
        </div>

    </div>

    <div class="main-content">

      <h3 >Reservation</h3>
      <hr/>

      <?php $this->load->view('inc/breadcrumbs')?>
      <br/>
      
      
      <div class="row">
        <div class="col-ld-7 col-md-7 col-sm-10 col-xs-12">

          <div class="panel panel-default assessment">
            <div class="panel-heading">
              <h3 class="panel-title">Assessment of Fees</h3>
            </div>

            <div class="panel-body">

                <table class="table table-condensed  responsive">
                  <thead>
                    <th class="width-5 bold">No.</th>
                    <th class="bold">Learner's Name</th>
                    <th class="bold text-right">Reservation Fee</th>
                  </thead>
                  <tbody>
                    <?php 
                    $total  = 0;
                    if(!empty($my_reservation)):

                    $cnt    = 1;
                    foreach($my_reservation as $r):?>

                    <tr>
                      <td class="vmiddle"><?=$cnt++?></td>
                      <td class="vmiddle">
                        <h4 class=" mb-0"><?=$r['stud_name']?></h4>
                        <span class="title-header"><?=$r['lvl_name'].' - '. $r['sec_name']?></span>
                      </td>
                      <td class="vmiddle text-right">
                        <?php 
                          $total += $r['res_fee'];
                          echo number_format($r['res_fee'],2);
                        ?>
                      </td>
                    </tr>
                  <?php endforeach;?>

                  <?php endif; ?>
                  </tbody>
                  <tfoot>
                    <tr>
                      <td class="vmiddle text-right" colspan="3">
                        <small>Total amount to be paid</small>
                        <h3 class="m-0 bold"><?=number_format($total,2);?></h3>
                      </td>
                    </tr>
                  </tfoot>
                </table>

                <hr/>

                <div class="form-group">
                  <button class="btn btn-primary btn-lg proceed">Proceed to Payment</button>
                  <button class="btn btn-lg btn-default" onclick="goBack()">Back</button>
                </div>
                  

            </div>
          </div>


          <div class="panel panel-primary payment hidden">
            <div class="panel-heading">
              <h3 class="panel-title">Payment</h3>
            </div>

            <div class="panel-body">
              
               <form id="form_upload" action="<?php echo base_url()?>padmin/reservation_payment" enctype="multipart/form-data" method="POST">
                  
                  <blockquote>
                    <p class="bold"> Instruction on How to Pay </p>
                      
                      <ul>
                        <li>
                          Pay the total reservation fee through over-the-counter deposit or online bank transfer to our partner banks.<br/>

                          <span><em>(Note: The reservation fee is non-transferrable and non-refundable but deductible from the tuition fee upon enrollment.)</em></span>

                           <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">

                              <div class="tile-stats tile-white tile-white-primary">
                                
                                <h4 style="color:#303641" class="bold">China Banking Corporation</h4>

                                <small>Name: </small>
                                <p class="bold m-0">Isidore de Seville Integrated School, Inc. </p>

                                <small>Current Account No. :</small> 
                                <p class="bold m-0">368-001801-1 </p>

                              </div>

                            </div>

                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">

                              <div class="tile-stats tile-white tile-white-primary">

                                <h4 style="color:#303641" class="bold">Philippine National </h4>

                                <small>Name: </small> 
                                <p class="bold m-0">Isidore de Seville Integrated School, Inc. </p>
                                <small>Current Account No. :</small> 
                                <p class="bold m-0">2005-70001131 </p>
                            </div>

                            </div>
                          </div>

                        </li>
                        <br/>
                        <li>
                        Upload the payment confirmation receipt or deposit slip. The slot is reserved only for 24 hours. 
                          <br/><br/>

                          <div class="panel panel-primary">

                            <div class="panel-body">
                              <div class="form-group">
                                  <label>Select File</label>
                                  <input class="img" type="file" name="receipt" accept="image/*"/> 
                              </div>
                            
                              <div class="form-group">
                            
                                <p class="mb-0 text-right"  id="prog_percent">0%</p>
                                <!-- <div class="progress progress-striped mb-0" style="height:7px;">
                                    <div id="prog_bar" aria-valuemax="100" aria-valuemin="0" role="progressbar" class="progress-bar progress-bar-default">
                                    </div>
                                </div> -->
                              </div>
                            
                              <hr/>
                            
                              <div class="upload_msg"></div>
                            
                              <div class="form-group">
                                 <button class="btn btn-success btn-lg submit2" name="upload" type="submit"><i class="fa fa-upload"></i> Upload Deposit Slip</button>
                              </div>
                            </div>
                          </div>


                        </li>
                        <br/>
                        <li>An SMS verification will be sent to your registered number upon confirmation of your payment. </li>
                      </ul>

                  </blockquote>

                  
                  <hr/>
                  
                  <div class="form-group text-right">
                    <p class="mb-0">Total amount to be paid</p>
                    <h3 class="mt-0 bold"><?=number_format($total,2)?></h3>
                  </div>

                  <hr/>

                  
                
                </form> 

            </div>
          </div>


        </div>
      </div>

    
      
    </div>


    
</div> <!-- end of body container -->


<?= $this->load->view('inc/js')?>


<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    bar      = $('#prog_bar');
    percent  = $('#prog_percent');
    msg      = $('.upload_msg');
    btn      = $('.submit2');

    $('#form_upload').ajaxForm({
          data:$(this).serialize(),
              beforeSend: function() {
                  var percentVal = '0%';
                  bar.empty().width(percentVal);
                  percent.html(percentVal);
              },
              uploadProgress: function(event, position, total, percentComplete,e){
                  var percentVal = percentComplete + '%';
                  bar.empty().width(percentVal);
                  percent.html(percentVal);
                  btn.prop('disabled', true);
                  
              },
              success: function() {
                  var percentVal = '100%';
                  bar.width(percentVal)
                  percent.html(percentVal);

              },
              complete: function(xhr){
                  var rdata = $.parseJSON(xhr.responseText);
                  $(".upload").prop("disabled",false);
                  if(rdata){
                      if(rdata.stat){
                          msg.html(alert_success(rdata.msg));

                          window.setTimeout(function(){
                            window.location = base_url + 'padmin/reservation/';
                          },3000)
                          //location.reload();

                          /*sec_id = rdata.id;
                          $('.tbl_section').load(base_url+'admin/load_ps_section/'+sec_id);
                          $('.submit').removeClass('hidden');

                          btn.prop('disabled', true);
                          $('#form_upload')[0].reset();*/
                      }
                      else{
                          bar.empty().width(0);
                          percent.html('0%');
                          msg.html(alert_error(rdata.msg));
                          btn.prop('disabled', false);
                      }
                  }
                  else{
                      msg.html(alert_error("Oooops! An error occured upon uploading."));
                      btn.prop('disabled', false);
                  }
              },
              error:function(){
                  msg.html(alert_error("Oooops! An error occured upon uploading."));
                  btn.prop('disabled', false);
              }
     });//END AJAX UPLOAD


    $('.proceed').click(function(){
      $('.assessment').fadeOut();
      $('.payment').fadeIn().removeClass('hidden');

    });

  });

  function goBack() {
    window.history.back();
  }
</script>
</body>
</html>