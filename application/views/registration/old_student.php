<!DOCTYPE html>
<html lang="en">
<?= $this->load->view('inc/css')?>

<style type="text/css">
	.form-control{
		border: 1px solid #d3d1d1 !important;
	}
</style>

<body class="page-body gray" style="color:#373e4a">

<div class="page-container horizontal-menu pt-0">

	<div class="main-content">

		<div class="container">

			<div class="panel panel-primary panel-table">
					<div class="panel-heading">
						<div class="panel-title">
							<h2 class="bold">Old Student Registration Form</h2>
							<h4 class="m-0">School Year <?=$this->module->get_query("SELECT sy_name FROM school_year WHERE sy_selected = 'Y' ")->row('sy_name');?></4>
						</div>

						<div class="panel-options p-10">
							<button class="btn btn-primary" onclick="goback()"> <i class="fa fa-arrow-left"></i> Back</button>
						</div>
						
					</div>
					<form  class="form-horizontal form-groups-bordered" id="frmSubmit" action="<?php echo base_url()?>registration/old_student" method="POST">
						<div class="panel-body"  style="padding: 30px;">	

							<div class="panel panel-primary panel-shadow ">
								<div class="panel-body">
									<h3>Search Learners Name</h3>
									<hr/>
											
                                    <select class="form-control select2" name="stud_id" id="stud_id" required="">
                                            <option selected="" disabled="">Select Learner</option>
                                        <?php foreach ($student->result() as $k):?>
                                            <option value="<?=$k->stud_id?>" data-level="<?=$k->lvl_id?>" data-lvlname = "<?=$k->lvl_name?>" data-secname="<?=$k->sec_name?>"> <?=strtoupper($k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix.' '.$k->stud_middlename)?></option>
                                        <?php endforeach; ?>
                                    </select>
								</div>
							</div>

							<!-- <div class="row">
								<div class="col-md-10 col-md-offset-1">
									
								</div>
							</div> -->
							<hr/>
							


							<div id="learners_data">
								
							</div>
							

							<div class="row hidden submit">
								<div class="col-md-3">
									<button class="btn btn-success btn-lg btn-block btn-icon icon-left" type="submit"> <i class="fa fa-check"></i> SUBMIT APPLICATION</button>
								</div>
								<!-- <div class="col-md-1 pl-0">
									<button class="btn btn-lg btn-default btn-block" type="reset">Clear</button>
								</div> -->

								
							</div>

							<br/>
							<div class="msg"></div>
							

						</div>
					</form>
				</div>

		</div>

	</div>

</div>
	<?= $this->load->view('inc/js')?>

	<script type="text/javascript">
	  $(document).ready(function() {
	  	$('.stud_birthdate').mask('00/00/0000', {placeholder: "mm/dd/yyyy"});

	  	$('#stud_id').on('change', function(){
	  		var stud_id = $(this).val();

	  		var lvl_id = $(this).find(':selected').data('level');
	  		var lvl_name = $(this).find(':selected').data('lvlname');
	  		var sec_name = $(this).find(':selected').data('secname');

	  		var sec_level = lvl_name+' - '+sec_name;

	  		console.log(stud_id);

	  		if($('#learners_data').load(base_url+'registration/get_learners_data/'+stud_id)){
	  			$('.submit').removeClass('hidden');
	  		}
	  		
	  	});

	  	$('#frmSubmit').submit(function(e){
	  		e.preventDefault(); 

	  		var base 	= $(this);
			var msg 	= base.find(".msg");
			var btn 	= base.find("button");

	  		$.ajax({
				type:base.attr("method"),//get/post
				data:base.serialize(),
				url:base.attr("action"),//location for the url
				beforeSend:function(){
					msg.empty().html(alert_minimal('Processing . . .'));
					btn.prop("disabled",true);
				},
				success:function(rrdata){

					btn.prop("disabled",false);
					var rdata = $.parseJSON(rrdata);
					if(rdata.stat){
						msg.empty().html(alert_success(rdata.msg)).show();
						
						window.setTimeout(function(){
							window.location = base_url + 'registration/print_student/'+rdata.id;
						},1000);
					}
					else{
						msg.empty().html(alert_error(rdata.msg));
					}
					
				},
				error:function(rdata){
					btn.prop("disabled",false);
					msg.empty().html(alert_error('An error occured, please try again later'));
				}
			});
	  	});

	  	//GET AGE GROUP
	  	//
	  	$(document.body).on('change','.stud_birthdate',function(){

		//$('.stud_birthdate').on('change', function(){
			var birthdate = $(this).val();
			var date_now  = $('#date_now').val();

			if (Date.parse(birthdate) > Date.parse(date_now)) {
				$(this).val('');
				$('.date_msg').html('Invalid date format (mm/dd/yyyy)');
			}else{
				if(validate_date(birthdate) == true ){
					$('.date_msg').html('');
				}else{
					$(this).val('');
					$('.date_msg').html('Invalid date format (mm/dd/yyyy)');
				}
			}
			
		});

	  });


	$(".digit").keypress(function (e) {
	     //if the letter is not digit then display error and don't type anything
	     if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
	        //display error message
	        $("#errmsg").html("Digits Only").show().fadeOut("slow");
	               return false;
	    }
	});

	$('.type').click(function() {

		$type = $(this).is(':checked');

		//var isChecked = $('#rdSelect').prop('checked');


		if($type){
			$('.stud_no').prop('disabled', false);
		}else{
			$('.stud_no').prop('disabled', true);
		}
	    //$('input[type="radio"]').not(':checked').prop("checked", true);
	});



	function validate_date(birthdate){
		var bdate = birthdate;
		var comp = bdate.split('/');
		var m = parseInt(comp[0], 10);
		var d = parseInt(comp[1], 10);
		var y = parseInt(comp[2], 10);
		var date = new Date(y,m-1,d);
		if (date.getFullYear() == y && date.getMonth() + 1 == m && date.getDate() == d) {
		  return true;
		} else {
		  return false;
		}
	}


	function goback(){
	  window.location.href = base_url+'/registration';
 	}
	</script>
</body>
</html>