<!DOCTYPE html>
<html lang="en">
<?= $this->load->view('inc/css')?>
<link rel="stylesheet" href="<?php echo base_url()?>asset/css/print.css">
<link rel="stylesheet" href="<?php echo base_url()?>asset/css/print_media11.css">
<body class="page-body"   > <!-- onload="window.print()"   onload="window.print()" onafterprint="goback()" onload="window.print()"--> 

<div class="page-container">

	<div class="main-content">
			
			<div class="row">
                            <div class="col-md-12">

                                <h1 class="bold"><?=strtoupper($title)?> | SY <?=$this->module->get_active_sy_name()?></h1>
                                

                                    <?php 

                                        $mo  = array( 'jul', 'aug', 'sep', 'oct', 'nov', 'dec', 'jan', 'feb', 'mar');  

                                        $array_total = [];
                                    ?>


                                    <?php foreach($level->result() as $r): 
                                        $lvl_name  	= preg_replace('/\s+/', '', $r->lvl_name); 
                                        $rlvl_id  	= $r->lvl_id;
                                    ?>
                                        <h3 class="bold"><?=$r->lvl_name?></h3>

                                        	<div class="row">
                                                <div class="col-md-12">
                                                    <table class=" ">
                                                        <thead>
                                                            
                                                            <th class="text-center" style="width:10px">No.</th>
                                                            <th class="text-center">Student Name</th>
                                                            <th class="text-center width-10">Section</th>
                                                            <th class="text-center vmiddle width-5">Mode</th>
                                                            <th class="text-center vmiddle width-5">Discount</th>
                                                            <th class="text-center vmiddle width-10"> TOTAL</th>
                                                            
                                                            <?php for($x=0; $x < count($mo); $x++ ):?>
                                                            <th class="text-center vmiddle width-5"><?= ucfirst($mo[$x])?></th>
                                                            <?php endfor;?>
                                                            
                                                        </thead>
                                                    
                                                        <tbody>
															 <?php 
                                                                $cnt        = 1;
                                                                $student_tf = 0;
                                                                $mf         = 0;
                                                                $mo_mf      = 300;
                                                                $qua_mf     = 800;
                                                                $sem_mf     = 2400;

                                                                $jul        = 0;
                                                                $aug        = 0;
                                                                $sep        = 0;
                                                                $oct        = 0;
                                                                $nov        = 0;
                                                                $dec        = 0;
                                                                $jan        = 0;
                                                                $feb        = 0;
                                                                $mar        = 0;

                                                                $total_tf   = 0;


                                                                $total_jul = 0;
                                                                $total_aug = 0;
                                                                $total_sep = 0;
                                                                $total_oct = 0;
                                                                $total_nov = 0;
                                                                $total_dec = 0;
                                                                $total_jan = 0;
                                                                $total_feb = 0;
                                                                $total_mar = 0;

                                                                $grand_total = 0;


                                                                $array_total_per_student =  [];
                                                                
                                                                foreach($enrollment_data->result() as $s): 
                                                                    $stud_id        = $s->stud_id;
                                                                    $stud_name      = $s->stud_lastname.', '. $s->stud_firstname;
                                                                    $lvl_id         = $s->lvl_id;
                                                                    $sec_name       = $s->sec_name;
                                                                    $payment_mode   = substr($s->se_mode_payment, 0, 1);
                                                                    $sib_discount   = $s->sad_has_sib_discount;
                                                                    $is_scholar     = $s->sa_is_scholar; 
                                                                    $scholar_tf     = $s->sad_scholar_sub_total;
                                                                    $fee_tf         = $s->fee_tf;
                                                                    $dept_name      = $s->dept_name;


                                                                    $tf_jul     = 0;
                                                                    $tf_aug     = 0;
                                                                    $tf_sep     = 0;
                                                                    $tf_oct     = 0;
                                                                    $tf_nov     = 0;
                                                                    $tf_dec     = 0;
                                                                    $tf_jan     = 0;
                                                                    $tf_feb     = 0;
                                                                    $tf_mar     = 0;

                                                                    $tf_sq2     = 0;
                                                                    $tf_sq3     = 0;
                                                                    $tf_sq4     = 0;

                                                                    $tf_s2      = 0;


                                                                    /*computaion for miscellaneous*/

                                                                    if($dept_name <> 'Pre-School'){
                                                                        if($payment_mode == 'M'){
                                                                            $mf     = $mo_mf;
                                                                        }else if($payment_mode == 'Q'){
                                                                            $mf     = $qua_mf;
                                                                        }else if($payment_mode == 'S'){
                                                                            $mf     = $sem_mf;
                                                                        }else if($payment_mode == 'C'){
                                                                            $mf      = 0;
                                                                        }
                                                                    }else{
                                                                        $mf      = 0;
                                                                    }

                                                                    
                                                                    if($payment_mode == 'C'){
                                                                            $student_tf = 0;
                                                                    }else{
                                                                        if($sib_discount == 'Y'){
                                                                            $student_tf = $fee_tf - ($fee_tf * 0.10)  + $mf;
                                                                        }else{
                                                                            if($is_scholar == 'Y'){
                                                                                $student_tf = $scholar_tf;
                                                                            }else{
                                                                                $student_tf = $fee_tf + $mf;
                                                                            }
                                                                        }
                                                                    }

                                                                    

                                                                    foreach($payment_data->result() as $p){
                                                                        $pstud_id   = $p->stud_id;
                                                                        $tf_months  = $p->tf_months;
                                                                        $paid_tf    = $p->tf;


                                                                        if($pstud_id == $stud_id){

                                                                            switch ($tf_months) {
                                                                                case 'July':
                                                                                    $tf_jul    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'August':
                                                                                    $tf_aug    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'September':
                                                                                    $tf_sep    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'October':
                                                                                    $tf_oct    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'November':
                                                                                    $tf_nov    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'December':
                                                                                    $tf_dec    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'January':
                                                                                    $tf_jan    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'February':
                                                                                    $tf_feb    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'March':
                                                                                    $tf_mar    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case '2nd Quarter [August]':
                                                                                    $tf_sq2    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;


                                                                                case '3rd Quarter [October]':
                                                                                    $tf_sq3    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;


                                                                                case '4th Quarter [January]':
                                                                                    $tf_sq4    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case '2nd Semester [October]':
                                                                                    $tf_s2     =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;
                                                                            }

                                                                        }

                                                                    }


                                                                    if($payment_mode == 'M'){
                                                                        $jul  = $tf_jul >= $student_tf ? 0 : $student_tf - $tf_jul;
                                                                        $aug  = $tf_aug >= $student_tf ? 0 : $student_tf - $tf_aug;
                                                                        $sep  = $tf_sep >= $student_tf ? 0 : $student_tf - $tf_sep;
                                                                        $oct  = $tf_oct >= $student_tf ? 0 : $student_tf - $tf_oct;
                                                                        $nov  = $tf_nov >= $student_tf ? 0 : $student_tf - $tf_nov;
                                                                        $dec  = $tf_dec >= $student_tf ? 0 : $student_tf - $tf_dec;
                                                                        $jan  = $tf_jan >= $student_tf ? 0 : $student_tf - $tf_jan;
                                                                        $feb  = $tf_feb >= $student_tf ? 0 : $student_tf - $tf_feb;
                                                                        $mar  = $is_scholar == 'Y' ? ($tf_mar >= $student_tf ? 0 : $student_tf - $tf_mar ) : 0;
                                                                    }else if($payment_mode == 'Q'){
                                                                        $jul  = 0;
                                                                        $aug  = $tf_sq2 >= $student_tf ? 0 : $student_tf - $tf_sq2;
                                                                        $sep  = 0;
                                                                        $oct  = $tf_sq3 >= $student_tf ? 0 : $student_tf - $tf_sq3;
                                                                        $nov  = 0;
                                                                        $dec  = 0;
                                                                        $jan  = $tf_sq4 >= $student_tf ? 0 : $student_tf - $tf_sq4;
                                                                        $feb  = 0;
                                                                        $mar  = 0;
                                                                    }else if($payment_mode == 'S'){
                                                                        $jul  = 0;
                                                                        $aug  = 0;
                                                                        $sep  = 0;
                                                                        $oct  = $tf_s2 >= $student_tf ? 0 : $student_tf - $tf_s2;
                                                                        $nov  = 0;
                                                                        $dec  = 0;
                                                                        $jan  = 0;
                                                                        $feb  = 0;
                                                                        $mar  = 0;
                                                                    }else{
                                                                        $jul  = 0;
                                                                        $aug  = 0;
                                                                        $sep  = 0;
                                                                        $oct  = 0;
                                                                        $nov  = 0;
                                                                        $dec  = 0;
                                                                        $jan  = 0;
                                                                        $feb  = 0;
                                                                        $mar  = 0;
                                                                    }


                                                                    $total_tf = $jul + $aug + $sep + $oct + $nov + $dec + $jan + $feb + $mar;

                                                                   /* array_push($array_total_per_student, $total_tf);*/
                                                                  

                                                            ?>

                                                                    <?php if($rlvl_id == $lvl_id):?>
                                                                    
                                                                    <?php if($total_tf > 0): ?>

                                                                    <tr>
                                                                        <td class="text-center width-2"><?= $cnt++; ?></td>
                                                                        <td><?=$stud_name ?></td>
                                                                        <td><?= $sec_name ?></td>
                                                                        <td class="text-center "><?= substr($payment_mode, 0, 1);  ?></td>
                                                                        <td class="text-center "><?=$sib_discount?></td>
                                                                        
                                                                        <td class="text-right"><?=number_format($total_tf,2)?></td>  <!-- Total -->


                                                                        <td class="text-right"><?=number_format($jul,2)?></td> 
                                                                        <td class="text-right"><?=number_format($aug,2)?></td> 
                                                                        <td class="text-right"><?=number_format($sep,2)?></td> 
                                                                        <td class="text-right"><?=number_format($oct,2)?></td> 
                                                                        <td class="text-right"><?=number_format($nov,2)?></td> 
                                                                        <td class="text-right"><?=number_format($dec,2)?></td> 
                                                                        <td class="text-right"><?=number_format($jan,2)?></td> 
                                                                        <td class="text-right"><?=number_format($feb,2)?></td> 
                                                                        <td class="text-right"><?=number_format($mar,2)?></td>
                                                                        
                                                                    </tr>
                                                                    <?php endif;?>


                                                                    <?php 
                                                                        $total_jul += $jul;
                                                                        $total_aug += $aug;
                                                                        $total_sep += $sep;
                                                                        $total_oct += $oct;
                                                                        $total_nov += $nov;
                                                                        $total_dec += $dec;
                                                                        $total_jan += $jan;
                                                                        $total_feb += $feb;
                                                                        $total_mar += $mar;

                                                                        $grand_total += $total_tf;





                                                                    ?>

                                                                    <?php endif;?>

                                                            <?php endforeach;?>
                                                        </tbody>

                                                        <tfoot>
                                                            <tr>
                                                                <td colspan="5" class="text-right bold">Total</td>
                                                                <td class="text-right bold"><?=number_format($grand_total,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_jul,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_aug,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_sep,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_oct,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_nov,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_dec,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_jan,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_feb,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_mar,2)?></td>
                                                                
                                                            </tr>
                                                        </tfoot>
                                                       
                                                    </table>

                                                    <?php array_push($array_total , $grand_total) ;?>
                                                </div>
                                            </div>

                                            

                                    <?php endforeach;?>
                            </div>
                        </div>

                        <?php $total_receivables =  array_sum(array_filter($array_total));?>
                        <hr/>
                        <div class="row">
                            <!-- <div class="col-md-3 text-right"><h3>Total Receivables: </h3></div> -->
                            <div class="col-md-12 text-right">
                                <h4 class="m-0">Total Receivables: </h4>
                                <h1 class="bold m-0">P <?=number_format($total_receivables,2)?></h1></div>
                        </div>
            

			
	</div>

</div>
<script type="text/javascript">
	var base_url = "<?php echo base_url(); ?>"; 

 function goback(){
	 window.location.href = base_url+'grading';
 	//window.location.replace(base_url);
 }
</script>
</body>
</html>