<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
         <h1><?=$title?> Summary</h1>
             
        <hr/>

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-primary panel-table">
                    <div class="panel-body">
                        
                        <ul class="nav nav-tabs"><!-- available classes "bordered", "right-aligned" -->
                            <li class="active">
                                <a href="#collection" data-toggle="tab"> COLLECTION</a>
                            </li>
                            <li class="">
                                <a href="#uponenrollment" data-toggle="tab">UPON ENROLLMENT</a>
                            </li>
                            <li class="">
                                <a href="#receivables" data-toggle="tab">RECEIVABLES</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="collection">
                                <div class="row">
                                   <div class="col-md-12">
                                        <table class="table responsive table-bordered table-condensed table-striped">
                                            <thead>
                                                <tr>
                                                    <th></th>
                                                    <th></th>
                                                    <th colspan="3" class="text-center"><h4 class="bold m-0">MONTHLY</h4></th>
                                                    <th colspan="3"class="text-center"><h4 class="bold m-0">QUARTERLY</h4></th>
                                                    <th colspan="3"class="text-center"><h4  class="bold m-0">SEMESTRAL</h4></th>
                                                    <th colspan="3"class="text-center"><h4  class="bold m-0">ANNUAL</h4></th>
                                                    <th rowspan="2" class="text-center vmiddle"><h4  class="bold m-0">TOTAL</h4></th>
                                                </tr>
                                                
                                                <tr>
                                                    <th><h5 class="m-0">GRADE LEVEL</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Discount</h5></th>
                                                    <th class="text-center"abbr=""><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                <?php 

                                                    $overall_total  = 0;
                                                    $grand_total    = 0;   

                                                    $right = $this->module->get_query(" SELECT dept_id, dept_name, lvl_id, lvl_name, as_sib_discount, as_reservation, as_disc_tf FROM v_student_assessment GROUP BY lvl_name, as_sib_discount ORDER BY lvl_sort, as_sib_discount ASC ");

                                                    foreach( $right->result() as $r):

                                                        $sib_discount = $r->as_sib_discount;
                                                ?>

                                                <tr>
                                                    <td><?= $r->lvl_name ?></td>
                                                    <td class="text-center"><?= $sib_discount ?></td>
                                                    
                                                    <?php 

                                                        $mode = array('Monthly', 'Quarterly', 'Semestral', 'Cash');

                                                        foreach($mode as $v): 
                                                    ?>

                                                    <td class="text-center">
                                                    <?php 

                                                       $q = $this->module->get_query(" SELECT COUNT(*) AS mcnt FROM v_student_assessment WHERE as_mode = '".$v."' AND lvl_id = ".$r->lvl_id." AND as_sib_discount = '".$sib_discount."' AND stud_type <> 'Scholar' GROUP BY lvl_name, as_sib_discount ")->row('mcnt');

                                                       echo (empty($q) ? 0 : $q );
                                                    ?>
                                                    </td>

                                                    <td class="text-right">
                                                        <?php 
                                                            //NO DISCOUNT
                                                            
                                                            $fee    = 0;
                                                            $total  = 0;

                                                            $qfee   = $this->module->get_query(" SELECT * FROM v_fee_schedule WHERE fee_type = '".$v."' AND dept_id = ".$r->dept_id."  AND lvl_id = ".$r->lvl_id." ");

                                                            $fee_tf             = $qfee->row('fee_tf');
                                                            $fee_other_schl_fee = $qfee->row('fee_other_schl_fee');

                                                            $fee_july           = $qfee->row('fee_july');
                                                            $fee_aug            = $qfee->row('fee_aug');
                                                            $fee_sept           = $qfee->row('fee_sept');
                                                            $fee_oct            = $qfee->row('fee_oct');
                                                            $fee_nov            = $qfee->row('fee_nov');
                                                            $fee_dec            = $qfee->row('fee_dec');
                                                            $fee_jan            = $qfee->row('fee_jan');
                                                            $fee_feb            = $qfee->row('fee_feb');

                                                            $monthly            = $fee_july + $fee_aug + $fee_sept + $fee_oct + $fee_nov + $fee_dec + $fee_jan + $fee_feb;

                                                            $msc_mo             = 300;
                                                            $msc_quar           = 800;
                                                            $msc_sem            = 2400;


                                                             if($sib_discount == 'N'){

                                                                $fee    = $qfee->row('fee_amnt_to_pay') + $monthly;
                                                                $total  = (floatval($fee) * floatval($q));

                                                             }else{

                                                                $dept_name = $r->dept_name;

                                                                $discounted_fee = $fee_tf - ($fee_tf * 0.10) ;
                                                                $monthly_fee    = 0;

                                                                if($dept_name == 'Pre-School'){
                                                                    //no miscellaneous
                                                                    
                                                                    if($v == 'Monthly'){
                                                                        $monthly_fee = $discounted_fee * 9;
                                                                    }elseif($v == 'Quarterly'){
                                                                        $monthly_fee = $discounted_fee * 4;
                                                                    }elseif($v == 'Semestral'){
                                                                        $monthly_fee = $discounted_fee * 2;
                                                                    }else{
                                                                        $monthly_fee = $discounted_fee;
                                                                    }

                                                                    $fee    = $monthly_fee + $fee_other_schl_fee; 
                                                                    $total  = (floatval($fee) * floatval($q));

                                                                    //$fee    = $monthly_fee + $fee_other_schl_fee; //(($fee_tf * 0.10) + $fee_other_schl_fee - $fee_tf) + $monthly + $fee_other_schl_fee + $monthly
                                                                    //$total  = (floatval($fee) * floatval($q));
                                                                    
                                                                }else{
                                                                    //add miscellaneous
                                                                    
                                                                    if($v == 'Monthly'){
                                                                        $monthly_fee = ($discounted_fee + $fee_other_schl_fee) + ($discounted_fee + $msc_mo) * 8;
                                                                    }elseif($v == 'Quarterly'){
                                                                        $monthly_fee = ($discounted_fee + $fee_other_schl_fee) + ($discounted_fee + $msc_quar) * 3;
                                                                    }elseif($v == 'Semestral'){
                                                                        $monthly_fee = ($discounted_fee + $fee_other_schl_fee) + ($discounted_fee + $msc_sem) * 1;
                                                                    }else{
                                                                        $monthly_fee = $discounted_fee + $fee_other_schl_fee;
                                                                    }

                                                                    $fee    =  $monthly_fee; 
                                                                    $total  = (floatval($fee) * floatval($q));
                                                                   

                                                                }

                                                               


                                                             }
                                                            

                                                            echo number_format($fee,2);

                                                            $overall_total += $total; 
                                                            $grand_total += $overall_total;
                                                        ?>
                                                    </td>

                                                    <td class="text-right text-success"><?= number_format($total,2); ?></td>
                                                    <?php endforeach; ?>

                                                    <td class="text-right bold text-danger"><?= number_format($overall_total,2); ?></td>

                                                </tr>

                                                <?php endforeach; ?>

                                                <tr>
                                                    <td colspan="14" class="vmiddle"><h4 class="m-0 text-right bold">GRAND TOTAL</h4></td>
                                                    <td class="vmiddle"><h3 class="m-0 text-right bold"><?= number_format($grand_total ,2); ?></h3></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                   </div>
                               </div>
                            </div>

                            <div class="tab-pane " id="uponenrollment">
                                 <div class="row">
                                   <div class="col-md-12">
                                        <table class="table responsive table-bordered table-condensed table-striped">
                                            <thead>
                                                <tr>
                                                    <th></th>
                                                    <th></th>
                                                    <th colspan="2" class="text-center"><h4 class="bold m-0">MONTHLY</h4></th>
                                                    <th colspan="2" class="text-center"><h4 class="bold m-0">QUARTERLY</h4></th>
                                                    <th colspan="2" class="text-center"><h4  class="bold m-0">SEMESTRAL</h4></th>
                                                    <th colspan="2" class="text-center"><h4  class="bold m-0">ANNUAL</h4></th>
                                                    <th rowspan="2" class="text-center vmiddle"><h4  class="bold m-0">TOTAL</h4></th>
                                                </tr>
                                                
                                                <tr>
                                                    <th><h5 class="m-0">GRADE LEVEL</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Discount</h5></th>
                                                    <th class="text-center"abbr=""><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                <?php 

                                                    $overall_total  = 0;
                                                    $grand_total    = 0; 

                                                    $total          = 0;

                                                    $right = $this->module->get_query(" SELECT dept_id, dept_name, lvl_id, lvl_name, as_sib_discount, as_reservation, as_disc_tf FROM v_student_assessment GROUP BY lvl_name, as_sib_discount ORDER BY lvl_sort, as_sib_discount ASC ");

                                                    foreach( $right->result() as $r):

                                                        $sib_discount = $r->as_sib_discount;
                                                ?>

                                                <tr>
                                                    <td><?= $r->lvl_name ?></td>
                                                    <td class="text-center"><?= $sib_discount ?></td>
                                                    
                                                    <?php 

                                                        $mode = array('Monthly', 'Quarterly', 'Semestral', 'Cash');

                                                        foreach($mode as $v): 
                                                    ?>

                                                    <td class="text-center">

                                                        <?php 

                                                            $q = $this->module->get_query(" SELECT lvl_name ,as_sib_discount, COUNT(*) as cnt, SUM(as_disc_tf + as_reservation) as total  FROM v_student_assessment WHERE as_mode = '".$v."' AND lvl_id = ".$r->lvl_id." AND as_sib_discount = '".$sib_discount."' AND stud_type <> 'Scholar'  GROUP BY lvl_name, as_sib_discount ORDER BY lvl_sort, as_sib_discount ASC ");

                                                            echo (empty($q->row('cnt')) ? 0 : $q->row('cnt') );
                                                        ?>
                                                    </td>

                                                    <td class="text-right text-success">
                                                        <?php 
                                                            $total = (empty($q->row('total')) ? 0 : $q->row('total') );
                                                            $overall_total += $total; 

                                                            echo number_format($total,2); 
                                                        ?>
                                                    </td>

                                                        <?php endforeach; ?>

                                                    <td class="text-right text-danger bold">
                                                        <?php 
                                                         //$total = ;

                                                         
                                                         $grand_total += $overall_total;

                                                         echo number_format($overall_total,2);?>
                                                    </td>

                                                    <?php endforeach; ?>

                                                    

                                                

                                                <tr>
                                                    <td colspan="10" class="vmiddle"><h4 class="m-0 text-right bold">GRAND TOTAL</h4></td>
                                                    <td class="vmiddle">
                                                        <h3 class="m-0 text-right bold">
                                                            <?php echo number_format($grand_total,2);
                                                            ?>
                                                        </h3>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                   </div>
                               </div>   
                            </div>

                            <div class="tab-pane" id="receivables">
                                <div class="row">
                                   <div class="col-md-12">
                                        <!-- <table class="table responsive table-bordered table-condensed table-striped">
                                            <thead>
                                                <tr>
                                                    <th></th>
                                                    <th></th>
                                                    <th colspan="3" class="text-center"><h4 class="bold m-0">MONTHLY</h4></th>
                                                    <th colspan="3"class="text-center"><h4 class="bold m-0">QUARTERLY</h4></th>
                                                    <th colspan="3"class="text-center"><h4  class="bold m-0">SEMESTRAL</h4></th>
                                                    <th colspan="3"class="text-center"><h4  class="bold m-0">ANNUAL</h4></th>
                                                    <th></th>
                                                </tr>
                                                
                                                <tr>
                                                    <th><h5 class="m-0">GRADE LEVEL</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Discount</h5></th>
                                                    <th class="text-center"abbr=""><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">No</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Fee</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                    <th class="text-center"><h5 class="m-0">Total</h5></th>
                                                </tr>
                                            </thead>
                                        
                                            <tbody>
                                                <?php 
                                        
                                                    $overall_total  = 0;
                                                    $grand_total    = 0;   
                                        
                                                    $right = $this->module->get_query(" SELECT dept_id, dept_name, lvl_id, lvl_name, as_sib_discount, as_reservation, as_disc_tf FROM v_student_assessment GROUP BY lvl_name, as_sib_discount ORDER BY lvl_sort, as_sib_discount ASC ");
                                        
                                                    foreach( $right->result() as $r):
                                        
                                                        $sib_discount = $r->as_sib_discount;
                                                ?>
                                        
                                                <tr>
                                                    <td><?= $r->lvl_name ?></td>
                                                    <td class="text-center"><?= $sib_discount ?></td>
                                                    
                                                    <?php 
                                        
                                                        $mode = array('Monthly', 'Quarterly', 'Semestral', 'Cash');
                                        
                                                        foreach($mode as $v): 
                                                    ?>
                                        
                                                    <td class="text-center">
                                                    <?php 
                                        
                                                       $q = $this->module->get_query(" SELECT COUNT(*) AS mcnt FROM v_student_assessment WHERE as_mode = '".$v."' AND lvl_id = ".$r->lvl_id." AND as_sib_discount = '".$sib_discount."' AND stud_type <> 'Scholar' GROUP BY lvl_name, as_sib_discount ")->row('mcnt');
                                        
                                                       echo (empty($q) ? 0 : $q );
                                                    ?>
                                                    </td>
                                        
                                                    <td class="text-right">
                                                        <?php 
                                                            //NO DISCOUNT
                                                            
                                                            $fee    = 0;
                                                            $total  = 0;
                                        
                                                            $qfee   = $this->module->get_query(" SELECT * FROM v_fee_schedule WHERE fee_type = '".$v."' AND dept_id = ".$r->dept_id."  AND lvl_id = ".$r->lvl_id." ");
                                        
                                                            $fee_tf             = $qfee->row('fee_tf');
                                                            $fee_other_schl_fee = $qfee->row('fee_other_schl_fee');
                                        
                                                            $fee_july           = $qfee->row('fee_july');
                                                            $fee_aug            = $qfee->row('fee_aug');
                                                            $fee_sept           = $qfee->row('fee_sept');
                                                            $fee_oct            = $qfee->row('fee_oct');
                                                            $fee_nov            = $qfee->row('fee_nov');
                                                            $fee_dec            = $qfee->row('fee_dec');
                                                            $fee_jan            = $qfee->row('fee_jan');
                                                            $fee_feb            = $qfee->row('fee_feb');
                                        
                                                            $monthly            = $fee_july + $fee_aug + $fee_sept + $fee_oct + $fee_nov + $fee_dec + $fee_jan + $fee_feb;
                                        
                                                            $msc_mo             = 300;
                                                            $msc_quar           = 800;
                                                            $msc_sem            = 2400;
                                        
                                        
                                                             if($sib_discount == 'N'){
                                        
                                                                $fee    = $qfee->row('fee_amnt_to_pay') + $monthly;
                                                                $total  = (floatval($fee) * floatval($q));
                                        
                                                             }else{
                                        
                                                                $dept_name = $r->dept_name;
                                        
                                                                $discounted_fee = $fee_tf - ($fee_tf * 0.10) ;
                                                                $monthly_fee    = 0;
                                        
                                                                if($dept_name == 'Pre-School'){
                                                                    //no miscellaneous
                                                                    
                                                                    if($v == 'Monthly'){
                                                                        $monthly_fee = $discounted_fee * 9;
                                                                    }elseif($v == 'Quarterly'){
                                                                        $monthly_fee = $discounted_fee * 4;
                                                                    }elseif($v == 'Semestral'){
                                                                        $monthly_fee = $discounted_fee * 2;
                                                                    }else{
                                                                        $monthly_fee = $discounted_fee;
                                                                    }
                                        
                                                                    $fee    = $monthly_fee + $fee_other_schl_fee; 
                                                                    $total  = (floatval($fee) * floatval($q));
                                        
                                                                    //$fee    = $monthly_fee + $fee_other_schl_fee; //(($fee_tf * 0.10) + $fee_other_schl_fee - $fee_tf) + $monthly + $fee_other_schl_fee + $monthly
                                                                    //$total  = (floatval($fee) * floatval($q));
                                                                    
                                                                }else{
                                                                    //add miscellaneous
                                                                    
                                                                    if($v == 'Monthly'){
                                                                        $monthly_fee = ($discounted_fee + $fee_other_schl_fee) + ($discounted_fee + $msc_mo) * 8;
                                                                    }elseif($v == 'Quarterly'){
                                                                        $monthly_fee = ($discounted_fee + $fee_other_schl_fee) + ($discounted_fee + $msc_quar) * 3;
                                                                    }elseif($v == 'Semestral'){
                                                                        $monthly_fee = ($discounted_fee + $fee_other_schl_fee) + ($discounted_fee + $msc_sem) * 1;
                                                                    }else{
                                                                        $monthly_fee = $discounted_fee + $fee_other_schl_fee;
                                                                    }
                                        
                                                                    $fee    =  $monthly_fee; 
                                                                    $total  = (floatval($fee) * floatval($q));
                                                                   
                                        
                                                                }
                                        
                                                               
                                        
                                        
                                                             }
                                                            
                                        
                                                            echo number_format($fee,2);
                                        
                                                            $overall_total += $total; 
                                                            $grand_total += $overall_total;
                                                        ?>
                                                    </td>
                                        
                                                    <td class="text-right bold text-success"><?= number_format($total,2); ?></td>
                                                    
                                                        <?php endforeach; ?>
                                        
                                                    <td class="text-right bold text-danger"><?= number_format($overall_total,2); ?></td>
                                        
                                                </tr>
                                        
                                                <?php endforeach; ?>
                                        
                                                <tr>
                                                    <td colspan="14" class="vmiddle"><h4 class="m-0 text-right bold">GRAND TOTAL</h4></td>
                                                    <td class="vmiddle"><h3 class="m-0 text-right bold"><?= number_format($grand_total ,2); ?></h3></td>
                                                </tr>
                                            </tbody>
                                        </table> -->
                                   </div>
                               </div>
                            </div>
                        </div>



                       
                    </div>
                </div>
            </div>
        </div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
      
       
  });
</script>
</body>
</html>