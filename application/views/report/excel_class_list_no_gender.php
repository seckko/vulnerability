<?php 

header('Content-Description: File Transfer');
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="ExportClassList.csv', date( 'd m Y' ));
header('Content-Transfer-Encoding: binary');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Pragma: public');
echo "\xEF\xBB\xBF"; // UTF-8 BOM

?>

<style type="text/css">
  .text-center{
    text-align: center !important;
  }

  .text-danger{
    color: #ff6c60;
  }

  table {
    border-collapse: collapse;
  }


  table, th, td {
    border: thin solid #373e4a;
    padding:2px 10px;
  }

  td{
    text-align: left !important;
  }

  td.green{
    color: white !important;
      background-color: #109618 !important;
  }

  td.orange{
    color: white !important;
      background-color: #FF9900 !important;
  }

  .text-left{
    text-align: left !important;
  }

  .text-right{
    text-align: right !important;
  }

  .text-center{
    text-align: center !important;
  }

  td.no-border{
    border: none !important; 
  }

</style>

<div class="row">
        <table style="border: none !important;">
          <tr>
            <td style="border: none !important; font-size: 25px;" colspan="7">ISIDORE DE SEVILLE INTEGRATED SCHOOL</td>
          </tr> 
          <tr>
            <td style="border: none !important; font-size: 15px" colspan="7">S.Y. <?= $this->module->get_active_sy_name()?></td>
          </tr>
        </table>

        <br/>

        <?php foreach($section->result() as $r): ?>
            
          <table style="border: none !important; ">
            <tr>
              <td style="border: none !important; " colspan="3"><h3 class="bold m-0"><?= strtoupper($r->lvl_name).' - '.strtoupper($r->sec_name)  ?></h3></td>
              <td style="border: none !important; " class="text-right no-border" colspan="4"><h4 class="m-0"><?= $r->sec_teacher ?></h4></td>
            </tr> 
          </table>

          <table>
            <thead>
              <th class="width-5" style="background: #dbdbdd">No.</th>
              <th colspan="6" style="background: #dbdbdd">Name of Student</th>
            </thead>
          
            <tbody>


              <?php 
                $sy         = $this->module->get_active_sy();
                $get_student_male   = $this->module->get_query("SELECT * FROM v_student_section WHERE sy_id = ".$sy." AND sec_id = ".$r->sec_id."  ORDER BY sec_sort, stud_lastname ");
              ?>

              <?php 
                $cnt = 1; 
                foreach($get_student_male->result() as $k): ?>
                <tr>
                  <td class="text-center"><small><?= $cnt++; ?></small></td>
                  <td colspan="6">
                    <?php 
                      
                      $suffix   = $k->stud_suffix;
                      $middlename = $k->stud_middlename;


                      if(empty($suffix)){
                        if(empty($middlename)){
                            $fullname = $k->stud_lastname.', '.$k->stud_firstname;
                          }else{
                            $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '. substr($k->stud_middlename,0,1).'.';
                          }
                        echo ucwords($fullname);
                      }else{
                        if(empty($middlename)){
                          $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix;
                        }else{
                          $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix .' '. substr($k->stud_middlename,0,1).'.';
                        }

                        echo ucwords($fullname);
                      }
                    ?>
                  </td>
                </tr>
              <?php endforeach; ?>


            </tbody>
          </table>

          <br/>

        <?php endforeach; ?>

      </div>


<?php 



//header('Content-Type:application/xls');
//header("Content-Disposition:attachment; filename=ExportClassList.xls");
?>
