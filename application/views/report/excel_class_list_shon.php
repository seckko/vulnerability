<?php 

header('Content-Description: File Transfer');
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="ExportClassList.csv', date( 'd m Y' ));
header('Content-Transfer-Encoding: binary');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Pragma: public');
echo "\xEF\xBB\xBF"; // UTF-8 BOM

?>

<style type="text/css">
  .text-center{
    text-align: center !important;
  }

  .text-danger{
    color: #ff6c60;
  }

  table {
    border-collapse: collapse;
  }


  table, th, td {
    border: thin solid #373e4a;
    padding:2px 10px;
  }

  td{
    text-align: left !important;
  }

  td.green{
    color: white !important;
      background-color: #109618 !important;
  }

  td.orange{
    color: white !important;
      background-color: #FF9900 !important;
  }

  .text-left{
    text-align: left !important;
  }

  .text-right{
    text-align: right !important;
  }

  .text-center{
    text-align: center !important;
  }

</style>

<div class="row">

        <table style="border: none !important; ">
          <tr>
            <td style="border: none !important; font-size: 25px" class="no-border text-center" colspan="8">ISIDORE DE SEVILLE INTEGRATED SCHOOL</td>
          </tr> 
          <tr>
            <td style="border: none !important; font-size: 15px" class="text-center no-border" colspan="8">S.Y. <?= $this->module->get_active_sy_name()?></td>
          </tr>
        </table>



        <br/>

        <?php foreach($section->result() as $r): ?>
            
          <table style="border: none !important; ">
            <tr>
              <td  style="border: none !important; " class="no-border" colspan="3"><h3 class="bold m-0"><?= strtoupper($r->lvl_name).' - '.strtoupper($r->sec_name)  ?></h3></td>
              <td style="border: none !important; text-align: right !important " colspan="5"><h4 class="m-0"><?= $r->sec_teacher ?></h4></td>
            </tr> 
          </table>

          <table>
            <thead>
              <th class="width-5" style="background: #dbdbdd">No.</th>
              <th colspan="3" style="background: #dbdbdd">Name of Student</th>
              <th style="background: #dbdbdd" class="text-center">Birthdate</th>
              <!-- <th style="background: #dbdbdd" class="text-center">Father</th>
              <th style="background: #dbdbdd" class="text-center">Contact</th>
              <th style="background: #dbdbdd" class="text-center">Mother</th>
              <th style="background: #dbdbdd" class="text-center">Contact</th>
              <th style="background: #dbdbdd" class="text-center">Guardian</th>
              <th style="background: #dbdbdd" class="text-center">Contact</th>
              <th style="background: #dbdbdd" class="text-center">Relationship</th> -->

            </thead>
          
            <tbody>
              <tr>
                <td colspan="10" class="bold" style="font-weight: 900;"> BOYS</td>
              </tr>

              <?php 
                $sy         = $this->module->get_active_sy();
                $get_student_male   = $this->module->get_query("SELECT * FROM v_student_section WHERE sy_id = ".$sy." AND sec_id = ".$r->sec_id." AND stud_gender = 'Male' ORDER BY sec_sort, stud_lastname ");
              ?>

              <?php 
                $cnt = 1; 
                foreach($get_student_male->result() as $k): ?>
                <tr>
                  <td class="text-center"><small><?= $cnt++; ?></small></td>
                  <td colspan="3">
                    <?php 
                      
                      $suffix   = $k->stud_suffix;
                      $middlename = $k->stud_middlename;


                      if(empty($suffix)){
                        if(empty($middlename)){
                            $fullname = $k->stud_lastname.', '.$k->stud_firstname;
                          }else{
                            $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '. substr($k->stud_middlename,0,1).'.';
                          }
                        echo ucwords($fullname);
                      }else{
                        if(empty($middlename)){
                          $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix;
                        }else{
                          $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix .' '. substr($k->stud_middlename,0,1).'.';
                        }

                        echo ucwords($fullname);
                      }
                    ?>
                  </td>
                  <td><?=$k->stud_birthdate; ?></td>

                 <!--  <td><?= $k->stud_father_name?></td>
                 <td><?= $k->stud_father_contact?></td>
                 <td><?= $k->stud_mother_name?></td>
                 <td><?= $k->stud_mother_contact?></td>
                 <td><?= $k->stud_guar_name?></td>
                 <td><?= $k->stud_guar_contact?></td>
                 <td><?= $k->stud_guar_relation?></td> -->
                </tr>
              <?php endforeach; ?>

              <tr>
                <td colspan="10" class="bold"  style="font-weight: 900;"> GIRLS</td>
              </tr>

              <?php 
                $sy         = $this->module->get_active_sy();
                $get_student_male   = $this->module->get_query("SELECT * FROM v_student_section WHERE sy_id = ".$sy." AND sec_id = ".$r->sec_id." AND stud_gender = 'Female'  ORDER BY sec_sort,stud_lastname ");
              ?>

              <?php 
                $cnt = 1; 
                foreach($get_student_male->result() as $k): ?>
                <tr>
                  <td class="text-center"><small><?= $cnt++; ?></small></td>
                  <td colspan="3">
                    <?php 
                      
                      $suffix   = $k->stud_suffix;
                      $middlename = $k->stud_middlename;


                      if(empty($suffix)){
                        if(empty($middlename)){
                            $fullname = $k->stud_lastname.', '.$k->stud_firstname;
                          }else{
                            $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '. substr($k->stud_middlename,0,1).'.';
                          }
                        echo ucwords($fullname);
                      }else{
                        if(empty($middlename)){
                          $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix;
                        }else{
                          $fullname = $k->stud_lastname.', '.$k->stud_firstname.' '.$k->stud_suffix .' '. substr($k->stud_middlename,0,1).'.';
                        }

                        echo ucwords($fullname);
                      }
                    ?>
                  </td>
                   <td><?=$k->stud_birthdate; ?></td>
                 <!--  <td><?= $k->stud_father_name?></td>
                 <td><?= $k->stud_father_contact?></td>
                 <td><?= $k->stud_mother_name?></td>
                 <td><?= $k->stud_mother_contact?></td>
                 <td><?= $k->stud_guar_name?></td>
                 <td><?= $k->stud_guar_contact?></td>
                 <td><?= $k->stud_guar_relation?></td> -->
                </tr>
              <?php endforeach; ?>


            </tbody>
          </table>

          <br/>

        <?php endforeach; ?>

      </div>


<?php 



//header('Content-Type:application/xls');
//header("Content-Disposition:attachment; filename=ExportClassList.xls");
?>
