<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
        

        <div class="panel panel-primary panel-table">
            <div class="panel-heading">
                <div class="panel-title">
                    <h3> <strong>Age Profile</strong> </h3>
                    <h4> SY<?= $this->module->get_active_sy_name()?></h4>
                </div>
            </div>
            <div class="panel-body"> 

                <ul class="nav nav-tabs bordered"><!-- available classes "bordered", "right-aligned" -->
                    <li class="active">
                        <a href="#summary" data-toggle="tab">
                            <span class="hidden-xs">Summary</span>
                        </a>
                    </li>
                    <li>
                        <a href="#detail" data-toggle="tab">
                            <span class="hidden-xs">Details</span>
                        </a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="summary">

                       <table class="table table-bordered table-condensed table-responsive table-hover">
                            <thead>
                                <tr>
                                  <th rowspan="2" class="text-center bold">Age</th>
                                  <?php foreach($level->result() as $r): ?>
                                  <th class="text-center bold" colspan="2"><?=$r->lvl_name?></th>
                                  <?php  endforeach; ?>
                                </tr>
                                <tr>
                                   <?php foreach($level->result() as $r): ?>
                                    <th class="text-center">Male</th>
                                    <th class="text-center">Female</th>
                                  <?php endforeach; ?>
                                </tr>
                            </thead>

                             <tbody>

                                <?php 

                                  
                                
                                for($x=2; $x<=18; $x++): ?>
                                <tr>
                                  <td class="text-center"><h4 class="bold m-0"><?=$x?></h4></td>
                                  <?php 
                                 
                                  $total_male    = 0;
                                  $total_female  = 0;

                                  foreach($level->result() as $r): 
                                    $sy            = $this->module->get_active_sy();
                                    $get_student   = $this->module->get_query(" SELECT stud_lastname, stud_firstname, stud_middlename, stud_suffix, stud_gender, lvl_id, stud_birthdate, TIMESTAMPDIFF(YEAR, stud_birthdate, '2019-08-31') AS stud_age FROM v_section_students WHERE sy_id =".$sy." and lvl_id = ".$r->lvl_id." ORDER BY stud_lastname, stud_firstname ASC ");

                                      $lvl_id = $r->lvl_id;

                                       $male   = 0;
                                       $female = 0;

                                    
                                      foreach($get_student->result() as $g){
                                        $stud_age     = $g->stud_age;
                                        $stud_gender  = $g->stud_gender;
                                        $glvl_id      = $g->lvl_id;

                                        if($stud_gender == 'Male'){
                                            if($stud_age == $x && $glvl_id == $lvl_id ){
                                              $male   += 1;

                                            }
                                        }else{
                                          if($stud_age == $x && $glvl_id == $lvl_id ){
                                              $female += 1;
                                          }

                                        }
                                        
                                      }


                                       
                                  ?>


                                    <td class="text-center"><?=$male?></td>
                                    <td class="text-center"><?=$female?></td>

                                  <?php endforeach;

                                  

                                  ?>
                                </tr>
                                <?php endfor;?>

                               
                              </tbody>
                        
                       </table>
                    </div>

                    <div class="tab-pane" id="detail">
                       <ul class="nav nav-tabs bordered"><!-- available classes "bordered", "right-aligned" -->
                            
                            <?php foreach($level->result() as $r): 

                                $lvl_name  =  preg_replace('/\s+/', '', $r->lvl_name); 
                            ?>
    
                            <li class="<?=$lvl_name == 'Kinder2' ? 'active' : '' ?>">
                                <a href="#<?=$lvl_name?>" data-toggle="tab">
                                    <span class="hidden-xs"><?=$r->lvl_name?></span>
                                </a>
                            </li>

                            <?php endforeach; ?>
                        </ul>

                        <div class="tab-content">
                            <?php foreach($level->result() as $r): 
                                $lvl_name  = preg_replace('/\s+/', '', $r->lvl_name); 
                            ?>

                            <div class="tab-pane <?=$lvl_name == 'Kinder2' ? 'active' : '' ?> " id="<?=$lvl_name?>">
                                <h3><?=$r->lvl_name?></h3>
                                
                                 <table class="table table-bordered table-condensed table-responsive table-hover tabletable">
                                    <thead>
                                        <th class="width-5 text-center bold" style="background: #dbdbdd;">No.</th>
                                        <th class="bold" style="background: #dbdbdd;">Student Name</th>
                                        <th class="width-15 text-center bold"  style="background: #dbdbdd;">Birthdate</th>
                                        <th class="width-10 text-center bold"  style="background: #dbdbdd;">Age as of <br/>Aug.31 <?=date('Y')?></th>
                                    </thead>

                                    <tbody>

                                      <?php 
                                            $sy            = $this->module->get_active_sy();
                                            $get_student   = $this->module->get_query(" SELECT stud_lastname, stud_firstname, stud_middlename, stud_suffix, stud_gender, stud_birthdate, TIMESTAMPDIFF(YEAR, stud_birthdate, '2019-08-31') AS stud_age FROM v_section_students WHERE sy_id =".$sy." and lvl_id = ".$r->lvl_id." ORDER BY stud_lastname, stud_firstname ASC ");
                                            
                                            $cnt_boys      = 1;
                                            $cnt_girls     = 1;

                                            $cut_off  = '2019-08-31'; ?>

                                          <tr>
                                            <td colspan="4" class="bold">BOYS</td>
                                          </tr>

                                        <?php 
                                            foreach($get_student->result() as $k): 

                                                $stud_birthdate = $k->stud_birthdate;
                                                $stud_gender    = $k->stud_gender;


                                                if($stud_gender == 'Male'):
                                        ?>

                                                   <tr>
                                                    <td class="text-center"><?= $cnt_boys++; ?></td>
                                                    <td>
                                                        <?php 
                                                            
                                                            $stud_name = $k->stud_firstname.' '.substr($k->stud_middlename, 0,1).(empty($k->stud_middlename) ? '' : '. ').' '.$k->stud_lastname.' '.$k->stud_suffix;
                                                            echo ucwords($stud_name);
                                                        ?>
                                                    </td>
                                                    <td class="text-center"><?= $stud_birthdate?></td>
                                                    <td class="text-center">
                                                      <?= $k->stud_age; ?>
                                                    </td>

                                                  </tr>
                                                <?php endif;?>

                                            <?php endforeach; ?>  <!-- Get STudent -->


                                            <tr>
                                            <td colspan="4" class="bold">GIRLS</td>
                                          </tr>

                                        <?php 
                                            foreach($get_student->result() as $k): 
                                                $stud_birthdate = $k->stud_birthdate;
                                                $stud_gender    = $k->stud_gender;
                                                if($stud_gender == 'Female'):
                                        ?>

                                                   <tr>
                                                    <td class="text-center"><?= $cnt_girls++; ?></td>
                                                    <td>
                                                        <?php 
                                                            
                                                            $stud_name = $k->stud_firstname.' '.substr($k->stud_middlename, 0,1).(empty($k->stud_middlename) ? '' : '. ').' '.$k->stud_lastname.' '.$k->stud_suffix;
                                                            echo ucwords($stud_name);
                                                        ?>
                                                    </td>
                                                    <td class="text-center"><?= $stud_birthdate?></td>
                                                    <td class="text-center">
                                                      <?= $k->stud_age; ?>
                                                    </td>

                                                  </tr>
                                                <?php endif;?>

                                            <?php endforeach; ?>

                                      
                                      
                                    </tbody>
                                </table>

                            </div>
                            <?php endforeach; ?>
                        </div>

                    </div>
                </div>

            </div>
        </div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
     
       
  });
</script>
</body>
</html>