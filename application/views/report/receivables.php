<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
         

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-primary panel-table">

                    <div class="panel-body">
                        
                        <div class="row">
                            <div class="col-md-12">

                                <div class="row">
                                    <div class="col-md-8">
                                        <h2 class="bold"><?=strtoupper($title)?></h2>
                                        <h4>SY <?=$this->module->get_active_sy_name()?></h4>
                                    </div>

                                    <div class="col-md-4 text-right">
                                        <a href="<?=base_url()?>report/print_receivables" class="btn btn-primary"><i class="fa fa-print"></i> Print</a>
                                    </div>

                                </div>

                                <hr/>

                                <ul class="nav nav-tabs bordered"><!-- available classes "bordered", "right-aligned" -->

                                    <?php foreach($level->result() as $r): 
                                        $lvl_name  =  preg_replace('/\s+/', '', $r->lvl_name); 
                                    ?>
            
                                    <li class=" <?= ($lvl_name == 'Nursery' ? 'active' : '' ) ?> ">
                                        <a href="#<?=$lvl_name?>" data-toggle="tab">
                                            <span class="hidden-xs"><?=$r->lvl_name?></span>
                                        </a>
                                    </li>

                                    <?php endforeach; ?>
                                </ul>

                                <div class="tab-content">

                                    <?php 
                                        $mo   = array( 'jul', 'aug', 'sep', 'oct', 'nov', 'dec', 'jan', 'feb', 'mar'); 

                                    ?>

                                    <?php foreach($level->result() as $r): 
                                        $rlvl_id    = $r->lvl_id;
                                        $lvl_name   = preg_replace('/\s+/', '', $r->lvl_name); 
                                    ?>

                                    <div class="tab-pane <?= ($lvl_name == 'Nursery' ? 'active' : '' ) ?> " id="<?=$lvl_name?>">
                                        <h3 class="bold"><?=$r->lvl_name?></h3>

                                        <div class="row">
                                                <div class="col-md-12">
                                                    <table class="table table-bordered table-condensed table-responsive table-hover">
                                                        <thead>
                                                            
                                                            <th class="width-2 text-center">No.</th>
                                                            <th class="text-center">Student Name</th>
                                                            <th class="text-center">Section</th>
                                                            <th class="text-center vmiddle width-5">Mode</th>
                                                            <th class="text-center vmiddle width-5">Discount</th>
                                                            <th class="text-right width-5 vmiddle ws-default">Tuition Fee</th>
                                                            
                                                            <?php for($x=0; $x < count($mo); $x++ ):?>
                                                            <th class="text-center vmiddle width-5"><?= ucfirst($mo[$x])?></th>
                                                            <?php endfor;?>

                                                            <th class="text-center vmiddle width-10"> TOTAL</th>
                                                        </thead>
                                                    
                                                        <tbody>
                                                            <?php 
                                                                $cnt        = 1;
                                                                $student_tf = 0;
                                                                $mf         = 0;
                                                                $mo_mf      = 300;
                                                                $qua_mf     = 800;
                                                                $sem_mf     = 2400;

                                                                $jul        = 0;
                                                                $aug        = 0;
                                                                $sep        = 0;
                                                                $oct        = 0;
                                                                $nov        = 0;
                                                                $dec        = 0;
                                                                $jan        = 0;
                                                                $feb        = 0;
                                                                $mar        = 0;

                                                                $total_tf   = 0;


                                                                $total_jul = 0;
                                                                $total_aug = 0;
                                                                $total_sep = 0;
                                                                $total_oct = 0;
                                                                $total_nov = 0;
                                                                $total_dec = 0;
                                                                $total_jan = 0;
                                                                $total_feb = 0;
                                                                $total_mar = 0;

                                                                $grand_total = 0;



                                                                
                                                                foreach($enrollment_data->result() as $s): 
                                                                    $stud_id        = $s->stud_id;
                                                                    $stud_name      = $s->stud_lastname.', '. $s->stud_firstname;
                                                                    $lvl_id         = $s->lvl_id;
                                                                    $sec_name       = $s->sec_name;
                                                                    $payment_mode   = substr($s->se_mode_payment, 0, 1);
                                                                    $sib_discount   = $s->sad_has_sib_discount;
                                                                    $is_scholar     = $s->sa_is_scholar; 
                                                                    $scholar_tf     = $s->sad_scholar_sub_total;
                                                                    $fee_tf         = $s->fee_tf;
                                                                    $dept_name      = $s->dept_name;



                                                                    /*computaion for miscellaneous*/

                                                                    if($dept_name <> 'Pre-School'){
                                                                        if($payment_mode == 'M'){
                                                                            $mf     = $mo_mf;
                                                                        }else if($payment_mode == 'Q'){
                                                                            $mf     = $qua_mf;
                                                                        }else if($payment_mode == 'S'){
                                                                            $mf     = $sem_mf;
                                                                        }else if($payment_mode == 'C'){
                                                                            $mf      = 0;
                                                                        }
                                                                    }else{
                                                                            $mf      = 0;
                                                                    }

                                                                    
                                                                    if($payment_mode == 'C'){
                                                                            $student_tf = 0;
                                                                    }else{
                                                                        if($sib_discount == 'Y'){
                                                                            $student_tf = $fee_tf - ($fee_tf * 0.10)  + $mf;
                                                                        }else{
                                                                            if($is_scholar == 'Y'){
                                                                                $student_tf = $scholar_tf;
                                                                            }else{
                                                                                $student_tf = $fee_tf + $mf;
                                                                            }
                                                                        }
                                                                    }

                                                                    $tf_jul     = 0;
                                                                    $tf_aug     = 0;
                                                                    $tf_sep     = 0;
                                                                    $tf_oct     = 0;
                                                                    $tf_nov     = 0;
                                                                    $tf_dec     = 0;
                                                                    $tf_jan     = 0;
                                                                    $tf_feb     = 0;
                                                                    $tf_mar     = 0;

                                                                    $tf_sq2     = 0;
                                                                    $tf_sq3     = 0;
                                                                    $tf_sq4     = 0;

                                                                    $tf_s2      = 0;
                                                                    

                                                                    foreach($payment_data->result() as $p){
                                                                        $pstud_id   = $p->stud_id;
                                                                        $tf_months  = $p->tf_months;
                                                                        $paid_tf    = $p->tf;


                                                                        if($pstud_id == $stud_id){

                                                                            switch ($tf_months) {
                                                                                case 'July':
                                                                                    $tf_jul    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'August':
                                                                                    $tf_aug    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'September':
                                                                                    $tf_sep    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'October':
                                                                                    $tf_oct    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'November':
                                                                                    $tf_nov    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'December':
                                                                                    $tf_dec    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'January':
                                                                                    $tf_jan    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'February':
                                                                                    $tf_feb    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case 'March':
                                                                                    $tf_mar    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case '2nd Quarter [August]':
                                                                                    $tf_sq2    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;


                                                                                case '3rd Quarter [October]':
                                                                                    $tf_sq3    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;


                                                                                case '4th Quarter [January]':
                                                                                    $tf_sq4    =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;

                                                                                case '2nd Semester [October]':
                                                                                    $tf_s2     =  empty($paid_tf) ? 0 : $paid_tf;
                                                                                    break;
                                                                            }

                                                                        }

                                                                    }


                                                                    if($payment_mode == 'M'){
                                                                        $jul  = $tf_jul >= $student_tf ? 0 : $student_tf - $tf_jul;
                                                                        $aug  = $tf_aug >= $student_tf ? 0 : $student_tf - $tf_aug;
                                                                        $sep  = $tf_sep >= $student_tf ? 0 : $student_tf - $tf_sep;
                                                                        $oct  = $tf_oct >= $student_tf ? 0 : $student_tf - $tf_oct;
                                                                        $nov  = $tf_nov >= $student_tf ? 0 : $student_tf - $tf_nov;
                                                                        $dec  = $tf_dec >= $student_tf ? 0 : $student_tf - $tf_dec;
                                                                        $jan  = $tf_jan >= $student_tf ? 0 : $student_tf - $tf_jan;
                                                                        $feb  = $tf_feb >= $student_tf ? 0 : $student_tf - $tf_feb;
                                                                        $mar  = $is_scholar == 'Y' ? ($tf_mar >= $student_tf ? 0 : $student_tf - $tf_mar ) : 0;
                                                                    }else if($payment_mode == 'Q'){
                                                                        $jul  = 0;
                                                                        $aug  = $tf_sq2 >= $student_tf ? 0 : $student_tf - $tf_sq2;
                                                                        $sep  = 0;
                                                                        $oct  = $tf_sq3 >= $student_tf ? 0 : $student_tf - $tf_sq3;
                                                                        $nov  = 0;
                                                                        $dec  = 0;
                                                                        $jan  = $tf_sq4 >= $student_tf ? 0 : $student_tf - $tf_sq4;
                                                                        $feb  = 0;
                                                                        $mar  = 0;
                                                                    }else if($payment_mode == 'S'){
                                                                        $jul  = 0;
                                                                        $aug  = 0;
                                                                        $sep  = 0;
                                                                        $oct  = $tf_s2 >= $student_tf ? 0 : $student_tf - $tf_s2;
                                                                        $nov  = 0;
                                                                        $dec  = 0;
                                                                        $jan  = 0;
                                                                        $feb  = 0;
                                                                        $mar  = 0;
                                                                    }else if($payment_mode == 'C'){
                                                                        $jul  = 0;
                                                                        $aug  = 0;
                                                                        $sep  = 0;
                                                                        $oct  = 0;
                                                                        $nov  = 0;
                                                                        $dec  = 0;
                                                                        $jan  = 0;
                                                                        $feb  = 0;
                                                                        $mar  = 0;
                                                                    }


                                                                    $total_tf = $jul + $aug + $sep + $oct + $nov + $dec + $jan + $feb + $mar;


                                                            ?>

                                                                    <?php if($rlvl_id == $lvl_id):?>
                                                                    <tr>
                                                                        <td class="text-center width-2"><?= $cnt++; ?></td>
                                                                        <td><?=$stud_name ?></td>
                                                                        <td><?= $sec_name ?></td>
                                                                        <td class="text-center "><?= substr($payment_mode, 0, 1);  ?></td>
                                                                        <td class="text-center "><?=$sib_discount?></td>
                                                                        <td class="text-right ws-default"><?=number_format($student_tf,2)?></td>
                                                                        
                                                                        <td class="text-right"><?=number_format($jul,2)?></td> 
                                                                        <td class="text-right"><?=number_format($aug,2)?></td> 
                                                                        <td class="text-right"><?=number_format($sep,2)?></td> 
                                                                        <td class="text-right"><?=number_format($oct,2)?></td> 
                                                                        <td class="text-right"><?=number_format($nov,2)?></td> 
                                                                        <td class="text-right"><?=number_format($dec,2)?></td> 
                                                                        <td class="text-right"><?=number_format($jan,2)?></td> 
                                                                        <td class="text-right"><?=number_format($feb,2)?></td> 
                                                                        <td class="text-right"><?=number_format($mar,2)?></td>
                                                                        <td class="text-right"><?=number_format($total_tf,2)?></td> <!-- Total -->
                                                                    </tr>
                                                                    <?php 
                                                                        $total_jul += $jul;
                                                                        $total_aug += $aug;
                                                                        $total_sep += $sep;
                                                                        $total_oct += $oct;
                                                                        $total_nov += $nov;
                                                                        $total_dec += $dec;
                                                                        $total_jan += $jan;
                                                                        $total_feb += $feb;
                                                                        $total_mar += $mar;

                                                                        $grand_total += $total_tf;

                                                                    ?>

                                                                    <?php endif;?>

                                                            <?php endforeach;?>

                                                        </tbody>
                                                        <tfoot>
                                                            <tr>
                                                                <td colspan="6" class="text-right bold">Total</td>
                                                                <td class="text-right bold"><?=number_format($total_jul,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_aug,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_sep,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_oct,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_nov,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_dec,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_jan,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_feb,2)?></td>
                                                                <td class="text-right bold"><?=number_format($total_mar,2)?></td>
                                                                <td class="text-right bold"><?=number_format($grand_total,2)?></td>
                                                            </tr>
                                                        </tfoot>                                                            
                                                    </table>
                                                </div>
                                            </div>
                                    </div>

                                    <?php endforeach;?>
                                </div>
                            </div>
                        </div>

    
                    </div>
                </div>
            </div>
        </div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
     
       
  });
</script>
</body>
</html>