<?php 

/*header('Content-Description: File Transfer');
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="MasterList.csv', date( 'd m Y' ));
header('Content-Transfer-Encoding: binary');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Pragma: public');
echo "\xEF\xBB\xBF"; // UTF-8 BOM*/

?>

<style type="text/css">
  .text-center{
    text-align: center !important;
  }

  .text-danger{
    color: #ff6c60;
  }

  table {
    border-collapse: collapse;
  }


  table, th, td {
    border: thin solid #373e4a;
    padding:2px 10px;
  }

  td{
    text-align: left !important;
  }

  th{
    background:#dbdbdd !important;
  }

  td.green{
    color: white !important;
      background-color: #109618 !important;
  }

  td.orange{
    color: white !important;
      background-color: #FF9900 !important;
  }

  .text-left{
    text-align: left !important;
  }

  .text-right{
    text-align: right !important;
  }

  .text-center{
    text-align: center !important;
  }

</style>

<h1 style="margin-bottom: 5px;"> <?=$title;?> </h1>
<br/>

<table>
    <thead>
        <th class="width-5 text-center" style="background: #dbdbdd;">No.</th>
        <th style="background: #dbdbdd;" >Student No.</th>
        <th style="background: #dbdbdd;">LRN No.</th>
        <th style="background: #dbdbdd;">Student Name</th>
        <th style="background: #dbdbdd;">Middle Name</th>
        <th style="background: #dbdbdd;">Nickname</th>
        <th style="background: #dbdbdd;">Birthday</th>
        <th style="background: #dbdbdd;">Age</th>
        <th style="background: #dbdbdd;">Gender</th>
        <th style="background: #dbdbdd;">Father</th>
        <th style="background: #dbdbdd;">Occupation</th>
        <th style="background: #dbdbdd;">Mother</th>
        <th style="background: #dbdbdd;">Occupation</th>
        <th style="background: #dbdbdd;">Address</th>
        <th style="background: #dbdbdd;">Contact Name</th>
        <th style="background: #dbdbdd;">Contact Nos.</th>
        <th style="background: #dbdbdd;">Religion</th>
        <th style="background: #dbdbdd;">Left</th>
        <th style="background: #dbdbdd;">Right</th>
        <th style="background: #dbdbdd;">Person to Contact in Case of Emergency </th>
        <th style="background: #dbdbdd;">Relation to Student</th>
        <th style="background: #dbdbdd;">Contact Number/s</th>
        <!-- <th style="background: #dbdbdd;">Enrollment Date</th> -->
    </thead>

    <tbody>
      <?php foreach($section->result() as $r): ?>
        <tr>
          <td colspan="21" style="border: none !important;"></td>
        </tr>
      <tr>
        <td colspan="5" class="bold" style="font-size:16px; font-weight: 900; border: none !important;" ><?= strtoupper($r->lvl_name).' - '.strtoupper($r->sec_name)  ?></td>
        <td colspan="16" style="font-size:16px; font-weight: 900; border: none !important;"><?= $r->sec_teacher ?></td>
      </tr>

      <?php 
            $sy            = $this->module->get_active_sy();
            $get_student   = $this->module->get_query("SELECT * FROM v_section_students WHERE sy_id = ".$sy." AND sec_id = ".$r->sec_id." ORDER BY stud_lastname ASC ");
        ?>

        <?php 
            $cnt = 1; 
            foreach($get_student->result() as $k): 
                $handedness = $k->stud_handedness;
        ?>


        <tr>
            <td class="text-center"><small><?= $cnt++; ?></small></td>
            <td class="text-center"><?=$k->stud_no?></td>
            <td class="text-center"><?=$k->stud_lrn?></td>
            <td>
                <?php 

                   $stud_name = $k->stud_lastname.', '.$k->stud_firstname.' '.substr($k->stud_middlename, 0,1).(empty($k->stud_middlename) ? '' : '. ').$k->stud_suffix;
                    echo ucwords($stud_name);
                    
                    /*$suffix     = $k->stud_suffix;
                    $middlename = $k->stud_middlename;


                    if(empty($suffix)){
                        if(empty($middlename)){
                                $fullname = $k->stud_lastname.', '.$k->stud_firstname;
                            }else{
                                $fullname = $k->stud_lastname.', '.$k->stud_lastname.' '.substr($k->stud_middlename,0,1).'. ' ;
                            }
                        echo ucwords($fullname);
                    }else{
                        if(empty($middlename)){
                            $fullname = $k->stud_lastname.' '.$k->stud_suffix.', '.$k->stud_firstname;
                        }else{
                            $fullname = $k->stud_firstname.' '.$k->stud_suffix .' '. substr($k->stud_middlename,0,1).'. '.$k->stud_lastname;
                        }

                        echo ucwords($fullname);
                    }*/
                ?>
            </td>
            <!-- <td><?= $k->stud_firstname.' '.$k->stud_suffix?></td> -->
            <td><?= $k->stud_middlename?></td>
            <td><?= $k->stud_nickname?></td>
            <td class="text-center"><?= date('m/d/Y', strtotime($k->stud_birthdate))?></td>
            <td class="text-center"><?= $this->module->get_age_month($k->stud_birthdate)?> </td>
            <td><?= $k->stud_gender?></td>
            <td><?= $k->stud_father_name?></td>
            <td><?= $k->stud_father_occupation?></td>
            <td><?= $k->stud_mother_name?></td>
            <td><?= $k->stud_mother_occupation?></td>
            <td><?= $k->stud_address?></td>
            <td><?= $k->stud_guardian_name ?></td>
            <td><?= $k->stud_guardian_contact ?></td>
            <td><?= $k->stud_religion?></td>
            <td class="text-center"><?= ($handedness == 'Left-handed') ? 1 : '' ?></td>
            <td class="text-center"><?= ($handedness == 'Right-handed') ? 1 : '' ?></td>
            <td><?= $k->stud_emergency_name?></td>
            <td><?= ucwords($k->stud_relationship)?></td>
            <td><?= $k->stud_emergency_contact?></td>
            <!-- <td class="text-right"><?= date('d-M', strtotime($k->stud_reg_date))?></td> -->
        </tr>

    <?php endforeach; ?>

      <?php endforeach; ?>
      
    </tbody>

</table>
<?php 

header('Content-Type:application/xls');
header("Content-Disposition:attachment; filename=MasterList.xls");
?>
