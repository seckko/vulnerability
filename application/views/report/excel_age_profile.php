<?php 

/*header('Content-Description: File Transfer');
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="MasterList.csv', date( 'd m Y' ));
header('Content-Transfer-Encoding: binary');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Pragma: public');
echo "\xEF\xBB\xBF"; // UTF-8 BOM*/

?>

<style type="text/css">
  .text-center{
    text-align: center !important;
  }

  .text-danger{
    color: #ff6c60;
  }

  table {
    border-collapse: collapse;
  }


  table, th, td {
    border: thin solid #373e4a;
    padding:2px 10px;
  }

  td{
    text-align: left !important;
  }

  th{
    background:#dbdbdd !important;
  }

  td.green{
    color: white !important;
      background-color: #109618 !important;
  }

  td.orange{
    color: white !important;
      background-color: #FF9900 !important;
  }

  .text-left{
    text-align: left !important;
  }

  .text-right{
    text-align: right !important;
  }

  .text-center{
    text-align: center !important;
  }

</style>

<h1 style="margin-bottom: 5px;"> <?=$title;?> </h1>
<br/>

<table>
  <thead>
    <tr>
      <th rowspan="2">Age</th>
      <?php foreach($level->result() as $r): ?>
      <th class="text-center" colspan="2"><?=$r->lvl_name?></th>
      <?php  endforeach; ?>
    </tr>
    <tr>
       <?php foreach($level->result() as $r): ?>
        <th>Male</th>
        <th>Female</th>
      <?php endforeach; ?>
    </tr>
  </thead>

  <tbody>

    <?php 
    
    

    for($x=5; $x<=18; $x++): ?>
    <tr>
      <td class="text-center"><?=$x?></td>
      <?php 
     
      $total_male    = 0;
      $total_female  = 0;

      foreach($level->result() as $r): 
        $sy            = $this->module->get_active_sy();
        $get_student   = $this->module->get_query(" SELECT stud_lastname, stud_firstname, stud_middlename, stud_suffix, stud_gender, lvl_id, stud_birthdate, TIMESTAMPDIFF(YEAR, stud_birthdate, '2019-08-31') AS stud_age FROM v_section_students WHERE sy_id =".$sy." and lvl_id = ".$r->lvl_id." ORDER BY stud_lastname, stud_firstname ASC ");

          $lvl_id = $r->lvl_id;

           $male   = 0;
           $female = 0;

        
          foreach($get_student->result() as $g){
            $stud_age     = $g->stud_age;
            $stud_gender  = $g->stud_gender;
            $glvl_id      = $g->lvl_id;

            if($stud_gender == 'Male'){
                if($stud_age == $x && $glvl_id == $lvl_id ){
                  $male   += 1;
                }
            }else{
              if($stud_age == $x && $glvl_id == $lvl_id ){
                  $female += 1;
              }

            }

            /*if($stud_gender == 'Male' && $stud_age == $x && $glvl_id == $lvl_id ){
              $male   += 1;
            }

            if($stud_gender == 'Female' && $stud_age == $x && $glvl_id == $lvl_id ){
              $female += 1;
            }*/
            
          }
      ?>

      <!-- <?php 
            $total_male   += $male; 
            $total_female += $female; 
      ?> -->

        <td class="text-center"><?=$male?></td>
        <td class="text-center"><?=$female?></td>

      <?php endforeach; ?>
    </tr>
    <?php endfor;?>

 <!--    <tr>
   <td class="text-center "><strong>TOTAL</strong></td>
   <?php foreach($level->result() as $r): ?>
     <td class="text-center"><?=$total_male?></td>
     <td class="text-center"><?=$total_female?></td>
   <?php endforeach; ?>
 </tr> -->
   
  </tbody>
</table>


<hr/>
<table>
    <thead>
        <th class="width-5 text-center" style="background: #dbdbdd;">No.</th>
        <th style="background: #dbdbdd;">Student Name</th>
        <th style="background: #dbdbdd;">Birthdate</th>
        <th style="background: #dbdbdd;">Age as of Aug.31,<?=date('Y')?></th>
    </thead>

    <tbody>
      
      <?php foreach($level->result() as $r): ?>
      <tr>
        <td  class="bold" style="font-size:16px; font-weight: 900; border: none !important;" ><?= strtoupper($r->lvl_name) ?></td>
      </tr>

      <?php 
            $sy            = $this->module->get_active_sy();
            $get_student   = $this->module->get_query(" SELECT stud_lastname, stud_firstname, stud_middlename, stud_suffix, stud_gender, stud_birthdate, TIMESTAMPDIFF(YEAR, stud_birthdate, '2019-08-31') AS stud_age FROM v_section_students WHERE sy_id =".$sy." and lvl_id = ".$r->lvl_id." ORDER BY stud_lastname, stud_firstname ASC ");
            
            $cnt_boys      = 1;
            $cnt_girls     = 1;

            $cut_off  = '2019-08-31'; ?>

          <tr>
            <td colspan="4">BOYS</td>
          </tr>

        <?php 
            foreach($get_student->result() as $k): 

                $stud_birthdate = $k->stud_birthdate;
                $stud_gender    = $k->stud_gender;


                if($stud_gender == 'Male'):
        ?>

                   <tr>
                    <td class="text-center"><?= $cnt_boys++; ?></td>
                    <td>
                        <?php 
                            
                            $stud_name = $k->stud_firstname.' '.substr($k->stud_middlename, 0,1).(empty($k->stud_middlename) ? '' : '. ').' '.$k->stud_lastname.' '.$k->stud_suffix;
                            echo ucwords($stud_name);
                        ?>
                    </td>
                    <td><?= $stud_birthdate?></td>
                    <td class="text-center">
                      <?= $k->stud_age; ?>
                    </td>

                  </tr>
                <?php endif;?>

            <?php endforeach; ?>  <!-- Get STudent -->


            <tr>
            <td colspan="4">GIRLS</td>
          </tr>

        <?php 
            foreach($get_student->result() as $k): 
                $stud_birthdate = $k->stud_birthdate;
                $stud_gender    = $k->stud_gender;
                if($stud_gender == 'Female'):
        ?>

                   <tr>
                    <td class="text-center"><?= $cnt_girls++; ?></td>
                    <td>
                        <?php 
                            
                            $stud_name = $k->stud_firstname.' '.substr($k->stud_middlename, 0,1).(empty($k->stud_middlename) ? '' : '. ').' '.$k->stud_lastname.' '.$k->stud_suffix;
                            echo ucwords($stud_name);
                        ?>
                    </td>
                    <td><?= $stud_birthdate?></td>
                    <td class="text-center">
                      <?= $k->stud_age; ?>
                    </td>

                  </tr>
                <?php endif;?>

            <?php endforeach; ?>

      <?php endforeach; ?>
      
      
    </tbody>

</table>
<?php 

/*header('Content-Type:application/xls');
header("Content-Disposition:attachment; filename=AgeProfile as of Aug 31.xls");*/
?>
