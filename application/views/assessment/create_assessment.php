<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->


      <div class="row">
        <div class="col-md-7">
          
          <div class="panel panel-primary panel-shadow panel-table">
            <div class="panel-heading">
              <div class="panel-title">
                <h3>Create <?= $title?></h3>
              </div>
          
            </div>
            <div class="panel-body">  

              <form  class="form-horizontal form-groups-bordered" id="frmSubmit" action="<?php echo base_url()?>assessment/compute_assessment" method="POST">
                 
                  <div class="msg"></div>

                  <?php 
                    /*RESERVATION VARIABLES*/

                    $stud_id = $this->uri->segment(3);

                    if($reservation->num_rows() > 0){
                        $cl_id         = 0;
                        $stud_fullname = '';
                        $stud_type     = '';
                        $cl_date_reserved      = '';
                        $sec_id        = 0;
                        $sec_name      = '';
                        $lvl_id        = 0;

                      foreach($reservation->result() as $r){
                        $cl_id              = $r->cl_id;
                        $stud_fullname      = $r->stud_lastname.', '.$r->stud_firstname;
                        $stud_type          = $r->stud_type;
                        $cl_date_reserved   = $r->cl_date_reserved;
                        $sec_id             = $r->sec_id;
                        $sec_name           = $r->sec_name;
                        $lvl_id             = $r->lvl_id;
                        $lvl_name           = $r->lvl_name;
                      }

                    }

                  ?>

                  <?php foreach($assessment->result() as $r):?>

                  <div class="form-group">
                    <label class="col-sm-3 control-label mt-15">Learners Name</label>
                    
                    <div class="col-md-9">
                      <h2><?= $fullname = ucwords(strtolower($r->stud_lastname.', '.$r->stud_firstname.' '.$r->stud_suffix.' '.$r->stud_middlename));?></h2>
                      
                      <input type="hidden" name="sa_id" value="<?=$this->uri->segment(4)?>">
                      <input type="hidden" name="stud_lastname" value="<?=$r->stud_lastname?>">
                      <input type="hidden" name="stud_firstname" value="<?=$r->stud_firstname?>">
                      <input type="hidden" name="stud_birthdate" value="<?=$r->stud_birthdate?>">
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="col-sm-3 control-label">Level & Section</label>

                    <div class="col-md-4">
                        <select class="form-control txt_lvl" name="lvl_id" > 
                          <?php  
                            $assessment_lvl_id  = $assessment->row('lvl_id');
                            //$rlvl_id            = $reservation->row('lvl_id'); 
                            $level              = $this->module->get_table('grade_level');
                            $llvl_id            = 0;

                            foreach($level->result() as $g): 
                              $glvl_id = $g->lvl_id; 

                              if($reservation->num_rows() > 0){
                                $llvl_id = $lvl_id;
                              }else{
                                $llvl_id = $assessment_lvl_id;
                              }

                          ?>
                            <option  value="<?=$g->lvl_id?>" <?=($llvl_id == $g->lvl_id ? 'selected="" ' : '' )?> ><?=$g->lvl_name?></option>
                          <?php endforeach; ?>

                          <input type="hidden" name="dept_id" value="<?=$r->dept_id?>">
                          <input type="hidden" name="se_stud_type" value="<?=$r->se_stud_type?>">

                        </select>
                    </div>
                    
                    <div class="col-sm-4">
                        <select class="form-control txt_sec" name="sec_id" > 
                          <?php 

                              //$rsec_id  = $reservation->row('sec_id'); 
                              
                              if($reservation->num_rows() > 0){
                                $ssec_id = $sec_id;
                              }else{
                                $ssec_id = '';
                              }

                              /*$slvl_id  = '';
                              if(empty($lvl_id)){
                                $slvl_id = $assessment_lvl_id;
                              }else{
                                $slvl_id = $lvl_id;
                              }*/

                              $section  = $this->module->get_query("SELECT * FROM v_sy_section WHERE sy_selected = 'Y' AND lvl_id = ".$llvl_id." ORDER BY sec_sort ");

                              foreach ($section->result() as $s):
                          ?>
                              <option value="<?=$s->sec_id?>" <?=($ssec_id == $s->sec_id ? 'selected="" ' : '' )?> ><?=$s->sec_name?></option>
                          <?php endforeach; ?>
                        </select>

                    </div>
                  </div>

                  <div class="form-group">
                    <label class="col-sm-3 control-label">Mode of Payment</label>
                    
                    <div class="col-sm-8">
                        <select class="form-control" name="se_mode_payment"> 
                             <?php $mode = ucfirst(strtolower($r->se_mode_payment)); ?>
                            <option value="Cash" <?=($mode =='Cash'? 'selected="" ':'') ?> >ANNUAL (CASH)</option>
                            <option value="Semestral" <?= ($mode =='Semestral'? 'selected="" ':'') ?> >SEMESTRAL</option>
                            <option value="Quarterly" <?= ($mode =='Quarterly'? 'selected="" ':'') ?> >QUARTERLY</option>
                            <option value="Monthly" <?= ($mode =='Monthly'? 'selected="" ':'') ?> >MONTHLY</option>
                        </select>
                    </div>
                  </div>


                  <div class="form-group">
                    <label class="col-sm-3 control-label">Sibling Discount</label>
                    
                    <div class="col-sm-2">
                      <input class="icheck" type="radio" value="Y" name="sad_has_sib_discount" required="" >
                          <label>YES</label>
                    </div>

                    <div class="col-sm-2">
                      <input class="icheck" type="radio" value="N" name="sad_has_sib_discount" checked>
                          <label>NO</label>
                    </div>

                    <div class="col-md-3 col-md-offset-1">
                      <?php 
                          $name = ucwords(strtolower($r->stud_lastname.', '.$r->stud_firstname));

                                        
                          if($reservation->num_rows() > 0){
                            $sad_is_reserved = 'Y';
                          }else{
                            $sad_is_reserved = 'N';
                          }

                          
                      ?>
                      <input type="hidden" name="stud_name" value="<?=$name?>"> 
                      <!-- <input type="hidden" name="sad_is_reserved" value="<?=$sad_is_reserved?>"> -->
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="col-sm-3 control-label">Reservation</label>
                    
                    <div class="col-sm-3">
                      <div class="checkbox">
                          <label>
                            <input type="checkbox" name="sad_is_reserved" value="Y" <?= ($sad_is_reserved == 'Y' ? 'checked' : '') ?> > Reserve?
                          </label>
                        </div>
                    </div>

                     <div class="col-sm-5">
                        <?php 

                            if($reservation->num_rows() > 0){
                              echo '<span class="badge badge-roundless badge-danger"><i class="fa fa-check"></i> WITH RESERVATION </span><br/>';
                              echo $lvl_name.'-'.$sec_name.' | '.date('m-d-Y', strtotime($cl_date_reserved));
                            }
                        ?>
                     </div>
                  </div>

                  <div class="form-group p-10">
                    <table class="table m-0 table-condensed table-bordered">
                      <thead>
                        <th colspan="3">OTHERS</th>
                        <th class="text-right"><button class="btn btn-default btn-xs clear" type="button"> clear </button></th>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            <label class="control-label bold">Books</label><br/>
                            <input type="text" class="form-control digit text-right others" name="sad_books" autofocus=""  autocomplete="off" value="0.00">
                          </td>
                          <td>
                            <label class="control-label bold">Notebooks/Diary</label><br/>
                            <input type="text" class="form-control digit text-right others" name="sad_notebooks" autocomplete="off" value="0.00" >
                          </td>
                          <td>
                            <label class="control-label bold">School Uniforms</label><br/>
                            <input type="text" class="form-control digit text-right others" name="sad_uniforms" autofocus=""  autocomplete="off" value="0.00">
                          </td>
                          <td>
                            <label class="control-label bold">P.E. Shoes</label><br/>
                            <input type="text" class="form-control digit text-right others" name="sad_shoes" autocomplete="off" value="0.00">
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <div class="form-group p-10">
                    

                    <table class="table m-0 table-condensed table-bordered">
                      <thead>
                        <th colspan="5" style="background-color: #373e4a; color: #fff;">SCHOLARSHIP</th>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            <label class="control-label bold">Is Scholar?</label><br/>
                            <select class="form-control" name="sad_is_scholar" id="sad_is_scholar">
                              <option value="N" >NO</option>
                              <option value="Y" >YES</option>
                            </select>
                            <!-- <div class="checkbox">
                              <label>
                                <input type="checkbox" name="sad_is_scholar" id="sad_is_scholar" value="Y" > YES
                              </label>
                            </div> -->
                          </td>
                          <td>
                            <label class="control-label bold">Percentage (%)</label><br/>
                            <select class="form-control scholar percentage" name="sad_percentage" disabled="">
                                <option value="0" >0%</option>
                                <option value="25" >25%</option>
                                <option value="50" >50%</option>
                                <option value="75" >75%</option>
                                <option value="100" >100%</option>
                              </select>
                          </td>
                          <td>
                            <label class="control-label bold">Tuition Fee (<?=number_format($fee_schedule->row('fee_tf'),2)?>)</label><br/>
                            <input type="text" class="form-control digit text-right scholar" id="fee_tf" autocomplete="off"  disabled="" value="<?= number_format($fee_schedule->row('fee_tf'),2)?>">
                            
                            <input type="hidden" value="<?=$fee_schedule->row('fee_tf')?>" id="disc_tf" name="sad_scholar_tuition_fee">
                            <input type="hidden" value="<?=$fee_schedule->row('fee_tf')?>" class="fee_tf" name="sad_tuition_fee">
                          </td>
                          <td>
                            <label class="control-label bold">Miscellaneous Fee (<?=number_format($fee_schedule->row('fee_other_schl_fee'), 2)?>)</label><br/>
                            <input type="text" name="sad_scholar_miscellaneous_fee" class="form-control digit text-right scholar" autofocus=""  autocomplete="off"  disabled="" value="<?= number_format($fee_schedule->row('fee_other_schl_fee'),2)?>"> 
                            <!-- <input type="hidden" value="<?=$fee_schedule->row('fee_other_schl_fee')?>" name="sad_scholar_miscellaneous_fee" id="disc_misc"> -->
                            <input type="hidden" value="<?=$fee_schedule->row('fee_other_schl_fee')?>" class="fee_misc" name="sad_miscellaneous_fee">
                          </td>

                          <td>
                            <label class="control-label bold">Mode</label><br/>
                            <select class="form-control scholar" name="sad_is_scholar_mode" id="sad_is_scholar_mode" disabled="">
                              <option value="Full" >Full</option>
                              <option value="Partial" >Parial</option>
                            </select>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <?php endforeach; ?> 

                  <div class="form-group">
                    <div class="col-md-4 col-md-offset-8 text-right">
                       <button class="btn btn-success btn-lg " type="submit">Compute Assessment</button>
                    </div>
                  </div>

              </form>


            </div>
          </div>

        

        </div>

        <div class="col-md-5">
          <div class="panel panel-default panel-shadow">
            <div class="panel-heading" style="background-color: #373e4a; ">
              <div class="panel-title">
                <h3 class="text-white">Assessed Fees</h3>
              </div>
            </div>

            <div class="panel-body">
                

               <form  id="frmSavePrint" action="<?php echo base_url()?>assessment/save_assessment" method="POST">

                <?php foreach($assessment->result() as $d):?>

                <input type="hidden" name="sy_id" value="<?=$d->sy_id?>">
                <input type="hidden" name="sa_id" value="<?=$this->uri->segment(4)?>">
                <input type="hidden" name="stud_id" value="<?=$stud_id?>">

                <div class="row">
                  <div class="col-md-3">
                    <small>Queue No.: </small> 
                    <h4 class="mt-0 "><?=$d->sa_queue_no?></h4>
                  </div>

                  <div class="col-md-5">
                    <small>Grade & Section: </small> 
                    
                    <h4 class="m-0 grade_section"> 
                    <?php 
                      if($assess->num_rows() > 0){
                        echo $assess->row('lvl_name').'-'.$assess->row('sec_name');
                      }else{
                        echo '----';
                      }
                    ?>
                    </h4>
                  </div>

                  <div class="col-md-4 ">
                    <small>Date: </small> 
                    <h4 class="m-0 ">
                      <?php 
                      date_default_timezone_set("Asia/Manila");

                      if($assess->num_rows() > 0){
                        echo date('F d, Y l', strtotime($assess->row('sad_date_assessed')));
                      }else{
                        $dt = new DateTime();
                        echo $dt->format('F d, Y l');
                      }


                      ?>
                    </h4>
                  </div>

                </div>
                <?php endforeach; ?>

                <table class="table table-responsive table-condensed table-striped">
                  <thead>
                    <tr>
                      <th colspan="2" style="background-color:#eee" class="bold">Description</th>
                      <th width="20%" style="background-color:#eee" class="text-right bold">Amount</th>
                      <th width="20%" style="background-color:#eee" class="text-right bold">Discounted</th>
                      <th class="text-right bold" width="20%" style="background-color:#eee">Sub-total</th>
                    </tr>
                  </thead>
                  
                  <tbody id="tbl_fee">
                      <tr>
                            <td colspan="5" class="bold"><i class="fa fa-caret-right"></i> SCHOOL FEES</td>
                        </tr>

                        <tr>
                            <td class="width-5"></td>
                            <td> <i class="fa fa-angle-double-right"></i> Tuition Fee </td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_tuition_fee'),2) : '0.00') ?></td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_scholar_tuition_fee'),2) : '0.00')?></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td> <i class="fa fa-angle-double-right"></i> Miscellaneous Fees</td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_miscellaneous_fee'),2) : '0.00')?></td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_scholar_miscellaneous_fee'),2) : '0.00') ?></td>
                            <td class="text-right">
                              <?php 
                                  $is_scholar             = $assess->row('sad_is_scholar');
                                  $sad_sub_total          = $assess->row('sad_sub_total');
                                  $sad_scholar_sub_total  = $assess->row('sad_scholar_sub_total');
                                  
                                  if($assess->num_rows() > 0){
                                    if($is_scholar == 'Y'){
                                        $sad_scholar_sub_total = $sad_scholar_sub_total;
                                        echo number_format($sad_scholar_sub_total, 2);
                                    }else{
                                        $sad_scholar_sub_total = 0;
                                        echo number_format($sad_sub_total, 2);
                                    }
                                  }else{
                                    echo '0.00';
                                  }
                                  
                              ?>
                                
                            </td>
                        </tr>

                        <tr>
                            <td ></td>
                            <td class="bold" colspan="4">   Less </td>
                        </tr>

                        <tr>
                            <td></td>
                            <td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i class="fa fa-angle-double-right"></i> Sibling Discount</td>
                            <td class="text-right">
                              <?php 
                                $sad_has_sib_discount = $assess->row('sad_has_sib_discount');

                                if($sad_has_sib_discount == 'Y'){
                                  echo '- '.number_format($assess->row('sad_sib_discount_amount'),2);
                                }else{
                                  echo '0.00';
                                }
                              ?>
                            </td>
                            <td class="text-right"></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i class="fa fa-angle-double-right"></i> Reservation</td>
                            <td class="text-right">
                              <?php 
                                $sad_is_reserved = $assess->row('sad_is_reserved');

                                if($sad_is_reserved == 'Y'){
                                  echo '- '.number_format($assess->row('sad_reservation_amount'),2);
                                }else{
                                  echo '0.00';
                                }
                              ?>
                            </td>
                            <td class="text-right"></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td class="bold"> Total School Fees</td>
                            <td class="text-right bold" colspan="3">
                              <?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_total_school_fees'),2) : '0.00') ?>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="5" class="bold"><i class="fa fa-caret-right"></i> OTHER FEES</td>
                        </tr>

                        <tr>
                            <td></td>
                            <td > <i class="fa fa-angle-double-right"></i> Books</td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_books'),2) : '0.00') ?></td>
                            <td class="text-right"></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td >  <i class="fa fa-angle-double-right"></i> Notebooks/Diary</td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_notebooks'),2) : '0.00') ?></td>
                            <td class="text-right"></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td >  <i class="fa fa-angle-double-right"></i> School Uniforms</td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_uniforms'),2) : '0.00') ?></td>
                            <td class="text-right"></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td >  <i class="fa fa-angle-double-right"></i> P.E. Shoes</td>
                            <td class="text-right"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_shoes'),2) : '0.00') ?></td>
                            <td class="text-right"></td>
                            <td class="text-right"></td>
                        </tr>

                        <tr>
                            <td></td>
                            <td class="bold"> Total Other Fees</td>
                            <td class="text-right bold" colspan="3"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_total_other_fees'),2) : '0.00') ?></td>
                        </tr>

                        <tr>
                          <td></td>
                          <td><h4 class="m-0 bold">  Total Assessed Fees</h4></td>
                          <td class="text-right " colspan="3"><h3 class="m-0 bold"><?= ($assess->num_rows() > 0 ? number_format($assess->row('sad_total_assessed_fee'),2) : '0.00') ?></h3></td>
                        </tr>

                        <tr>
                            <td colspan="5"></td>
                        </tr>

                        <tr>
                          <td></td>
                          <td colspan="4"> Mode of Payment: <strong><?= ($assess->num_rows() > 0 ? $assess->row('se_mode_payment') : '') ?></strong></td>
                        </tr>
                      
                  </tbody>
                  <tfoot>
                    <tr>
                      <td class="text-right" colspan="5">
                        <a href="<?=base_url()?>assessment/print_assessment/<?=$this->uri->segment(4)?>" class="btn btn-primary" type="button">Print Only</a>
                        <button class="btn btn-success" type="submit"  >Save & Print</button>
                      </td>
                    </tr>
                  </tfoot>
                </table>

                <div id="msgPrint"></div>
              </form>
            </div>
        </div>

        <div class="panel panel-primary panel-shadow">
            <div class="panel-heading">
              <div class="panel-title">
                <h3>Due Accounts</h3>
              </div>
              <div class="panel-options p-10">
                
                <a href="<?=base_url()?>admin/payment_schedule/<?=$stud_id?>" class="btn btn-success btn-xs text-white">Do Payment</a>
              </div>
          
            </div>
            <div class="panel-body p-0" >  
                <table class="table table-responsive table-condensed table-striped">
                <thead>
                  <tr>
                    <th colspan="2" style="background-color:#eee" class="bold">Description</th>
                    <th width="30%" style="background-color:#eee" class="text-right bold">Amount</th>
                    <th class="text-right bold" width="30%" style="background-color:#eee">Running Balance </th>
                  </tr>
                </thead>
                
                <tbody id="tbl_fee">
                    <?php 
                    if($due_account->num_rows() > 0 ):
                      foreach($due_account->result() as $r):
                        $inst_id = $r->inst_id;

                        $get_details = $this->module->get_query("SELECT * FROM installment_details WHERE inst_id =  ".$inst_id." AND inst_det_payment = 0 ");
                    ?>
                      <tr>
                          <td colspan="4">  <i class="fa fa-caret-right"></i> SY <strong><?=$due_account->row('sy_name')?> </strong></td>
                      </tr>

                      <?php 
                        $outstanding_balance  = 0;
                        $running_total        = 0;
                        $cnt = 1;
                        if($get_details->num_rows() > 0):
                          foreach($get_details->result() as $s): 

                            $inst_det_month   = $s->inst_det_month;
                            $inst_det_amount  = $s->inst_det_amount;

                            $outstanding_balance += $inst_det_amount;
                      ?>

                      <tr>
                          <td class="width-5 text-right"> <?=$cnt++?></td>
                          <td>   <?=ucfirst($inst_det_month)?> </td>
                          <td class="text-right"><?=number_format($inst_det_amount,2)?></td>
                          <td class="text-right"><?= number_format($running_total += $inst_det_amount, 2 ); ?></td>
                      </tr>

                      <?php endforeach; ?>

                      <?php else: ?>

                        <tr>
                          <td colspan="4"> &nbsp;&nbsp;&nbsp; No due accounts. </td>
                        </tr>

                      <?php endif;?>

                      <tr>
                          <td colspan="3" class="bold"> Outstanding Balance </strong></td>
                          <td class="text-right bold"><?=number_format($outstanding_balance,2)?></td>
                      </tr>
                    <?php endforeach; 
                    endif;
                    ?>
                </tbody>
              </table>
            </div>
          </div>

      </div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
      

      $('.percentage').on('change', function(){
          var me = $(this);
          my_val = me.val();

          fee_tf      = $('.fee_tf').val();
          fee_misc    = $('.fee_misc').val();
          percentage  =  parseInt(my_val) / 100;

          disc_tf     = fee_tf - (fee_tf * percentage);

          
          $('#fee_tf').val(accounting.format(disc_tf,2)); /*disc_tf.toFixed(2)*/ 
          $('#disc_tf').val(disc_tf);

          console.log(disc_tf);

      });

      $("#sad_is_scholar").on('change', function() {
          var selected = $(this).val();
          if(selected == 'Y'){
            $('.scholar').prop('disabled', false);
          }else{
            $('.scholar').prop('disabled', true);
            //$('.scholar').val('0.00');
          }
      });

      $('.clear').click(function(){
        $('.others').val('0.00');
      });

     /* $('#sad_is_scholar').on('change', function(){

          var selected = $(this).is(':selected');

          console.log(selected);
          if(){
            $('.scholar').prop('disabled', false);
          }else{
            $('.scholar').prop('disabled', true);
          }
      });*/

      $('.digit').ForceNumericOnly();

      $('#frmSubmit').submit(function(e){
          e.preventDefault(); 
          var base  = $(this);
          var msg   = base.find(".msg");
          var btn   = base.find("button");

          var txt_sec = $('.txt_sec option:selected').text();
          var txt_lvl = $('.txt_lvl option:selected').text();

            $.ajax({
            type:base.attr("method"),//get/post
            data:base.serialize(),
            url:base.attr("action"),
            success:function(rrdata){
                $('#tbl_fee').html(rrdata); 
                $('.grade_section').html(txt_lvl+'-'+txt_sec);
            },
            error:function(rdata){
              btn.prop("disabled",false);
              msg.empty().html(alert_error('An error occured, please try again later'));
            }
          });
      });


      $('#frmSubmitScholar').submit(function(e){
          e.preventDefault(); 
          var base  = $(this);
          var msg   = base.find(".msg");
          var btn   = base.find("button");

          var txt_sec_sch = $('.txt_sec_sch option:selected').text();
          var txt_lvl_sch = $('.txt_lvl_sch option:selected').text();

          $('.section').html(txt_sec_sch +' - '+ txt_lvl_sch);

            $.ajax({
            type:base.attr("method"),//get/post
            data:base.serialize(),
            url:base.attr("action"),
            success:function(rrdata){
                $('#tbl_fee').html(rrdata); 
                

            },
            error:function(rdata){
              btn.prop("disabled",false);
              msg.empty().html(alert_error('An error occured, please try again later'));
            }
          });
      });



      $(document.body).on("submit", "#frmSavePrint",function(e){
        e.preventDefault(); 

        var base  = $(this);
        var msg   = $("#msgPrint");
        var btn   = base.find("button");

          $.ajax({
          type:base.attr("method"),//get/post
          data:base.serialize(),
          url:base.attr("action"),//location for the url
          beforeSend:function(){
            msg.empty().html(alert_minimal('Processing . . .'));
            btn.prop("disabled",true);
          },
          success:function(rrdata){

            btn.prop("disabled",false);
            var rdata = $.parseJSON(rrdata);
            if(rdata.stat){
              msg.empty().html(alert_success(rdata.msg)).show();
              
              window.setTimeout(function(){
                window.location = base_url + 'assessment/print_assessment/'+rdata.id;
              },500)
            }
            else{
              msg.empty().html(alert_error(rdata.msg));
            }
            
          },
          error:function(rdata){
            btn.prop("disabled",false);
            msg.empty().html(alert_error('An error occured, please try again later'));
          }
        });
      });




      $('.txt_lvl').on('change', function(){
        var txt_lvl = $(this).val();
        //console.log(txt_lvl);
        //$('#lvl_id').val(txt_lvl);
          $('.txt_sec').load(base_url+'assessment/get_section/'+txt_lvl);
          


      });

      $(document.body).on('blur','.digit',function(){
        $(this).val(accounting.format($(this).val(),2));
      });



    
       
  });
</script>
</body>
</html>