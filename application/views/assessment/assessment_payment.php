<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body" id="my-body">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
         <h1>Assessment Payment</h1>
        <hr/>

        <div class="row">
          <div class="col-md-6">
            <div class="table-responsive" id="cms_table"> 
              <table  class="table table-bordered table-primary table-striped table-hover datatable table-condensed">
                <thead>
                  <tr>
                    <th></th>
                    <th>Queue no.</th>
                    <th>Full name</th>
                    <th class="width-5"></th>
                  </tr>
                </thead>
                <tbody id="update">
                    <?php
                      $cnt = 1;
                       foreach($payment->result() as $r): 
                          $fullname     = ucwords(strtolower($r->stud_lastname.', '.$r->stud_firstname));
                        ?>
                      <tr>
                        <td class="text-center"><?=$cnt++?></td>
                        <td ><?=$r->sa_queue_no?></td>
                        <td><?=$fullname?></td>

                        <td>
                          <button class="btn btn-primary btn-xs process" type="button" data-sa_id="<?=$r->sa_id?>" data-total="<?=$r->sad_total_assessed_fee?>" >Process</button>
                        </td>
                      </tr>
                    <?php endforeach; ?>
                </tbody>
              </table>
            </div>
            
            <hr/>
            <h3 class="bold">PAYMENT RECORD</h3>
            <table  class="table table-bordered table-primary table-striped table-hover datatable table-condensed">
                <thead>
                  <tr>
                    <th></th>
                    <th class="text-center">Full name</th>
                    <th class="text-center">Payment Type</th>
                    <th class="text-center">Payment</th>
                    <th class="text-center">Payment Date</th>
                  </tr>
                </thead>
                <tbody >
                  <?php 
                    $cnt = 1;
                    foreach($payment_record->result() as $r):?>
                    <tr>
                      <td class="text-center"><?=$cnt++?></td>
                      <td><?= $r->stud_lastname.', '. $r->stud_firstname?></td>
                      <td><?=$r->sap_payment_type. ' <small>'.($r->sap_payment_type=='Check' ? '('.$r->sap_check_bank.'-'.$r->sap_check_no.')</small>' : '')?></td>
                      <td class="text-right"><?=number_format($r->sap_total_payment, 2)?></td>
                      <td class="text-right"><?=date('Y-m-d', strtotime($r->sap_payment_date))?></td>
                    </tr>
                  <?php endforeach;?>
                </tbody>
            </table>
          </div>

          <div class="col-md-6">
              <div class="panel panel-default panel-shadow">
                <div class="panel-heading" style="background-color: #373e4a; ">
                  <div class="panel-title">
                    <h3 class="text-white">Create Payment</h3>
                  </div>
                </div>

                <div class="panel-body ">

                  <form  id="frmSave" action="<?php echo base_url()?>assessment/create_payment" method="POST">
                    <div  class="msg"></div>
                    <table class="table table-condensed ">
                        <tbody class="tbl_payment">
                          
                        </tbody>
                        <tfoot>
                          <tr>
                            <td>Payment Type</td>
                            <td>
                             <select name="sap_payment_type" class="form-control sap_payment_type" >
                               <option value="Cash">Cash</option>
                               <option value="Check">Check</option>
                               <option value="Cash/Check">Cash/Check</option>
                             </select> 

                            </td>

                            <td>
                              <input type="text" class="form-control sap_cash_payment mb-5 digit"  autocomplete="off" name="sap_cash_payment" placeholder="Cash Payment" >
                              <input type="text" class="form-control sap_check_payment mb-5 digit"  autocomplete="off" name="sap_check_payment" placeholder="Check Payment" disabled="">
                              <input type="text" class="form-control sap_check_bank mb-5"  autocomplete="off" name="sap_check_bank" placeholder="Bank" disabled="" >
                              <input type="text" class="form-control sad_check_no mb-5"  autocomplete="off" name="sap_check_no" placeholder="Check Number" disabled="" >
                              <input type="text" class="form-control sad_check_date"   autocomplete="off" name="sap_check_date" placeholder="MM/DD/YYYY" value="<?=date('m/d/Y')?>" disabled="">
                              <div class="date_msg text-danger bold pt-5"></div>
                            </td>
                          </tr>

                          <!--
                          <tr>
                            <td class="vmiddle">Tendered</td>
                            <td class="text-right" colspan="2">
                              <input type="text" class="form-control digit text-right sap_tendered input-lg" autocomplete="off"  name="sap_tendered" >
                            </td>
                          </tr>


                           <tr>
                            <td class="vmiddle">Change</td>
                            <td class="text-right" colspan="2">
                              <h3 class="m-0 sap_changeh text-right">0.00</h3>
                              <input type="hidden" name="sap_change" class="form-control sap_change">
                            </td>
                          </tr> -->

                          <tr>
                            <td colspan="3"></td>
                          </tr>

                        </tfoot>
                    </table>

                    <div class="row">
                      <div class="col-md-12 text-right"><button class="btn btn-success" type="submit"  >Create Payment</button></div>
                    </div>

                  </form>
                </div>
              </div>

          </div>
        </div>
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script>


</script>

<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    $('.sad_check_date').mask('00/00/0000', {placeholder: "mm/dd/yyyy"});


    //$('.sap_cash_payment, .sap_check_payment')

    $(document.body).on('change','.sad_check_date',function(){

      var birthdate = $(this).val();
      var date_now  = $('#date_now').val();

      if (Date.parse(birthdate) > Date.parse(date_now)) {
        $(this).val('');
        $('.date_msg').html('Invalid date format (mm/dd/yyyy)');
      }else{
        if(validate_date(birthdate) == true ){
          $('.date_msg').html('');
        }else{
          $(this).val('');
          $('.date_msg').html('Invalid date format (mm/dd/yyyy)');
        }
      }
      
    });


    $('#frmSave').crud_refresh();

      $(".datatable").dataTable({
            "sPaginationType": "bootstrap"
      });

    //$('.process').click(function(){

     $(document.body).on("click", ".process",function(e){
      sa_id = $(this).data('sa_id');
      total = $(this).data('total');

      $('.tbl_payment').load(base_url+'assessment/get_payment/'+sa_id);

      $('.sap_changeh').html('0.00');
      $('.sap_tendered').val('');
      $('.sap_cash_payment').val(total);

      console.log(total);

    });

    $(document.body).on("change", ".sap_payment_type",function(e){
        e.preventDefault(); 
        me      = $(this);
        tr      = me.closest('tr');

        if(me.val() == 'Cash'){
          tr.find('.sap_cash_payment').prop('disabled', false);
          tr.find('.sad_check_no, .sap_check_bank, .sad_check_date, .sap_check_payment').prop('disabled', true);  
        }else if(me.val() == 'Check'){
          tr.find('.sap_cash_payment').prop('disabled', true);
          tr.find('.sad_check_no, .sap_check_bank, .sad_check_date, .sap_check_payment').prop('disabled', false);  
        }else{
          tr.find('.sad_check_no, .sap_check_bank, .sad_check_date, .sap_check_payment, .sap_cash_payment').prop('disabled', false);  
        }
        

    });

    $(document.body).on("keyup", ".sap_tendered",function(e){
        e.preventDefault(); 
        me      = $(this);
        tr      = me.closest('tr');

        sap_cash_due  = $('#sap_cash_due').val();
        sap_tendered  = me.val();
        sap_cash_due  = sap_tendered - sap_cash_due;

        console.log(sap_cash_due);


        $('.sap_changeh').html( accounting.format(sap_cash_due,2) );
        $('.sap_change').val(sap_cash_due);
    });
       
  });

  $(document.body).on('blur','.digit',function(){
    $(this).val(accounting.format($(this).val(),2));
  });


  function validate_date(birthdate){
    var bdate = birthdate;
    var comp = bdate.split('/');
    var m = parseInt(comp[0], 10);
    var d = parseInt(comp[1], 10);
    var y = parseInt(comp[2], 10);
    var date = new Date(y,m-1,d);
    if (date.getFullYear() == y && date.getMonth() + 1 == m && date.getDate() == d) {
      return true;
    } else {
      return false;
    }
  }




</script>
</body>
</html>