<?php 
    $monthly    = array('july', 'august', 'september', 'october', 'november', 'december', 'january', 'february');
    $quarterly  = array('august', 'october', 'january');
    $semestral  = array('october');
   

  $mode         = $computed_tf['as_mode'];
  $tf           = $computed_tf['discounted_tf'];
  $is_discount  = $computed_tf['sib_discount'];
  $as_id        = $computed_tf['as_id'];
  $cnt          = 1;

  $start_date   = date('Y-m-1');
  $today        = date('Y-m-d');

  $due_date     = strtotime(date("Y-m-d", strtotime($start_date)) . " +20 day");
  $today        = strtotime(date("Y-m-d", strtotime($today)));

  $check  = $this->module->table_where('installment_hdr', array('as_id' => $computed_tf['as_id']));

  ?>

<!-- <tr>
  <td colspan="8">
     <?php 
        if($today > $due_date){
          echo '<span class=" text-danger"> Due date today for the month of </span> <span class="bold text-danger">'.strtoupper(date('F')) .'</span>';
        }
      ?>
  </td>
</tr> -->



  <?php
         
  if($check->num_rows() < 1): 

    if($mode == 'Monthly'):
      foreach($monthly as $v): ?>
        <tr>  
          <td><?=$cnt?></td>
          <td>
            <input type="text" name="soa<?=$cnt?>[inst_det_month]" class="form-control month input-sm" required="" value="<?= strtoupper($v)?>" readonly="">
          </td>

          <td class="width-15">
            <input type="text" name="soa<?=$cnt?>[inst_det_date]" class="form-control date " data-format="yyyy-mm-dd" value="<?=date('Y-m-d')?>">
           
          </td>

          <td>
            <select name="soa<?=$cnt?>[inst_det_percentage]" class="form-control percentage">
               <option value="0">0%</option>
                <?php for ($x = 3; $x <= 30; $x+=3) : ?>
                  <option value="<?= $x ?>"><?= $x?>% </option>
                <?php endfor; ?>
            </select>
          </td>


          <td class="text-right">
            <input type="text" name="soa<?=$cnt?>[inst_det_fine]" class="fine form-control text-right" value="0.00">
          </td>

          <td class="text-right vmiddle">
            <input type="text" class="form-control to_pay text-danger text-right" readonly="" name="soa<?=$cnt?>[inst_det_amount]"  value="<?= number_format($computed_tf['discounted_tf'],2) ?>">
          </td>

          <td class="text-right vmiddle">
            <input type="text" class="form-control partial text-right" name="inst_det_partial" value="<?= number_format(0,2); ?>">
          </td>

          <td class="text-right" style="width:30%">
            <input type="text" name="soa<?=$cnt?>[inst_det_payment]" autocomplete="off" class="form-control amount text-right" value="<?= number_format(0,2) ?>">
            <input type="hidden" class="form-control payment" value="<?= $computed_tf['discounted_tf'] ?>">
            
          </td>

          <td class="stat"><button class="btn btn-info check" type="button"> <i class="fa fa-download"></i></button></td>
          

        </tr>



      

      <?php 
        $cnt++;
        endforeach;
?>





<?php  
  elseif($mode == 'Quarterly'):

    foreach($quarterly as $v): ?>
        <tr>  
          <td><?=$cnt?></td>
          <td>
            <input type="text" name="soa<?=$cnt?>[inst_det_month]" class="form-control month input-sm" required="" value="<?= strtoupper($v)?>" readonly="">
          </td>

           <td class="width-15">
            <input type="text" name="soa<?=$cnt?>[inst_det_date]" class="form-control date " data-format="yyyy-mm-dd" value="<?=date('Y-m-d')?>">
          </td>


          <td>
            <select name="soa<?=$cnt?>[inst_det_percentage]" class="form-control percentage">
               <option value="0">0%</option>
                <?php for ($x = 3; $x <= 30; $x+=3) : ?>
                  <option value="<?= $x ?>"><?= $x?>% </option>
                <?php endfor; ?>
            </select>
          </td>

         
          <td class="text-right">
            <input type="text" name="soa<?=$cnt?>[inst_det_fine]" class="fine form-control text-right" value="0.00">
          </td>

          <td class="text-right vmiddle">
             <input type="text" class="form-control to_pay text-danger text-right" readonly="" name="soa<?=$cnt?>[inst_det_amount]"  value="<?= number_format($computed_tf['discounted_tf'],2) ?>">
          </td>

          <td class="text-right vmiddle">
            <input type="text" class="form-control partial text-right" name="inst_det_partial" value="<?= number_format(0,2); ?>">
          </td>

          <td class="text-right" style="width:30%">
            <input type="text" name="soa<?=$cnt?>[inst_det_payment]" autocomplete="off" class="form-control amount text-right" value="<?= number_format(0,2) ?>">
            <input type="hidden" class="form-control payment" value="<?= $computed_tf['discounted_tf'] ?>">
            
          </td>

          <td class="stat"><button class="btn btn-info check" type="button"> <i class="fa fa-download"></i></button></td>
          

        </tr>

      

      <?php 
        $cnt++;
        endforeach;
?>


<?php  
  elseif($mode == 'Semestral'):

    foreach($semestral as $v): ?>
        <tr>  
          <td><?=$cnt?></td>
          <td>
            <input type="text" name="soa<?=$cnt?>[inst_det_month]" class="form-control month input-sm" required="" value="<?= strtoupper($v)?>" readonly="">
          </td>

           <td class="width-15">
            <input type="text" name="soa<?=$cnt?>[inst_det_date]" class="form-control date " data-format="yyyy-mm-dd" value="<?=date('Y-m-d')?>">
          </td>

          <td>
            <select name="soa<?=$cnt?>[inst_det_percentage]" class="form-control percentage">
               <option value="0">0%</option>
                <?php for ($x = 3; $x <= 30; $x+=3) : ?>
                  <option value="<?= $x ?>"><?= $x?>% </option>
                <?php endfor; ?>
            </select>
          </td>

         

          <td class="text-right">
            <input type="text" name="soa<?=$cnt?>[inst_det_fine]" class="fine form-control text-right" value="0.00">
          </td>

          <td class="text-right vmiddle">
             <input type="text" class="form-control to_pay text-danger text-right" readonly=""  name="soa<?=$cnt?>[inst_det_amount]"  value="<?= number_format($computed_tf['discounted_tf'],2) ?>">
          </td>

          <td class="text-right vmiddle">
            <input type="text" class="form-control partial text-right" name="inst_det_partial" value="<?= number_format(0,2); ?>">
          </td>

          <td class="text-right" style="width:30%">
            <input type="text" name="soa<?=$cnt?>[inst_det_payment]" autocomplete="off" class="form-control amount text-right" value="<?= number_format(0,2) ?>">
            <input type="hidden" class="form-control payment" value="<?= $computed_tf['discounted_tf'] ?>">
            
          </td>

          <td class="stat"><button class="btn btn-info check" type="button"> <i class="fa fa-download"></i></button></td>
          

        </tr>

      

      <?php 
        $cnt++;
        endforeach;
?>
<?php endif;?>


<?php else: ?>


<?php 
  $get_det = $this->module->table_where('installment_details', array('inst_id' => $check->row('inst_id') ));

  foreach($get_det->result() as $r): 
    $payment = $r->inst_det_payment;
  ?>

  <tr>  
    <td><?=$cnt?></td>
    <td>
      <input type="text" name="soa<?=$cnt?>[inst_det_month]" class="form-control month input-sm" required="" value="<?= strtoupper($r->inst_det_month)?>" readonly="">
    </td>

    <td class="width-15">
      <input type="text" name="soa<?=$cnt?>[inst_det_date]" <?=(empty($payment) ? '' : 'readonly' )?> class="form-control date " data-format="yyyy-mm-dd" value="<?= (empty($payment) ? date('Y-m-d') : $r->inst_det_date) ?>">
    </td>

    <td>
      <select name="soa<?=$cnt?>[inst_det_percentage]" class="form-control percentage" <?=(empty($payment) ? '' : 'readonly' )?> >
         
          <?php for ($x = 0; $x <= 30; $x+=3) : 
            $percent = $r->inst_det_percentage;
          ?>
            <option  <?=($percent == $x ? 'selected=""': '') ?> value="<?= $x ?>" ><?= $x?>% </option>
          <?php endfor; ?>
      </select>
    </td>

    

    <td class="text-right">
      <input type="text" name="soa<?=$cnt?>[inst_det_fine]" class="fine form-control text-right" value="<?= number_format($r->inst_det_fine,2)?>" <?=(empty($payment) ? '' : 'readonly' )?>>
    </td>

    <td class="text-right vmiddle">
      <!-- <h5 class="m-0 bold text-danger"><?=number_format($computed_tf['discounted_tf'],2)?></h5> -->
      <?php 
          /*$dt = $computed_tf['discounted_tf'];
          $p  = $r->inst_det_partial;

          $pay = abs($p - $dt);*/

          $pay = $r->inst_det_amount;


      ?>
      <input type="text" class="form-control to_pay text-danger text-right" readonly="" name="soa<?=$cnt?>[inst_det_amount]" value="<?= number_format($pay,2) ?>">
    </td>

    <td class="text-right vmiddle">
      <input type="text" class="form-control partial text-right" name="soa<?=$cnt?>[inst_det_partial]" <?=(empty($payment) ? '' : 'readonly' )?> value="<?= number_format($r->inst_det_partial,2); ?>">
    </td>

    <td class="text-right" style="width:30%">
      <input type="text" name="soa<?=$cnt?>[inst_det_payment]" autocomplete="off" class="form-control amount text-right" value="<?= number_format($r->inst_det_payment,2) ?>" <?=(empty($payment) ? '' : 'readonly' )?>>
      <input type="hidden" class="form-control payment" value="<?= $computed_tf['discounted_tf'] ?>">
    </td>

    <td class="vmiddle stat">
      <?php 
          $payment        = $r->inst_det_payment;
          $discounted_tf  = $computed_tf['discounted_tf'];

          if(empty($payment)):
      ?>
          <button class="btn btn-info check" type="button" > <i class="fa fa-download"></i></button>

      <?php else: ?>  
          <button class="edit btn btn-primary btn-xs">EDIT</button>
      <?php endif; ?>
    </td>

  </tr>

<?php $cnt++ ; endforeach; endif; ?>

<tr>
  <td colspan="9">
 <table class="table table-condensed table-bordered">
   <thead>
     <th colspan="9" class="bold">ACCOUNT DETAILS</th>
   </thead>
   <tbody class="tbl_account_details">
      <tr>
        <td>
          <small>GRADE LEVEL</small>
          <h4 class="bold m-0"><?= $computed_tf['lvl_name'].' <small>'.$computed_tf['dept_name'].'</small>'?></h4>
        </td>

        <td>
          <small>MODE OF PAYMENT</small>
          <h4 class="bold m-0"><?= $computed_tf['as_mode']?></h4>
        </td>

        <td>
          <small>SIBLING DISCOUNT</small>
          <h4 class="bold m-0"><?= ($computed_tf['sib_discount'] == 'Y' ? ' Yes' : ' No' )?></h4>
        </td>

        <td>
          <small>PAYMENT UPON ENROLLMENT</small>
          <h4 class="bold m-0"><?= number_format($computed_tf['enrollment_pay'],2)?></h4>
        </td>

        <td class="text-right">
          <small>AMOUNT TO PAY</small>
          <h4 class="bold m-0 text-info"><?= number_format($computed_tf['amount_to_pay'],2)?></h4>
        </td>
        <td  class="text-right">
          <small>AMOUNT PAID</small>
          <h4 class="bold m-0 text-success"><?= number_format($computed_tf['amount_paid'],2)?></h4>
        </td>
        <td class="text-right">
          <small>BALANCE</small>
          <h3 class="bold m-0 text-danger"><?= number_format(($computed_tf['amount_to_pay'] - $computed_tf['amount_paid'] + $computed_tf['inst_det_fine']),2)?></h3>
        </td>

      </tr>
   </tbody>
 </table>

</td>
</tr>

<tr>
  <td colspan="9" class="text-right">
    <input type="hidden" name="as_id" value="<?=$as_id?>">
    <button class="btn btn-success submit" type="submit">Create Payment</button>
  </td>
</tr>

