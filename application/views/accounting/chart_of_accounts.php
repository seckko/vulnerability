<?php 
  
  $usr_name     	= $this->session->userdata('usr_name');
  $usr_type     	= $this->session->userdata('usr_type');
  $usr_firstname  	= $this->session->userdata('usr_firstname');
  $usr_lastname   	= $this->session->userdata('usr_lastname');
  $usr_is_login   	= $this->session->userdata('usr_is_login');


  if(!$usr_is_login && ($usr_type != 'Admin' || $usr_type !='System Admin' || $usr_type != 'Principal' )  ){
  	header('Location: '.base_url());
  }

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body">

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    
    <div class="sidebar-menu">

        <div class="sidebar-menu-inner">
            <?= $this->load->view('inc/sidebar')?>
        </div>

    </div>

    <div class="main-content"> <!---START MAIN CONTENT -->
		<h1><?= $title;?></h1>
        <hr/>

        <div class="row">
        	<div class="col-md-10">
        		<ul class="nav nav-tabs bordered">

					<li class="active">
						<a href="#type" data-toggle="tab">Type</a>
					</li>

					<li>
						<a href="#group" data-toggle="tab">Group</a>
					</li>

					<li>
						<a href="#title" data-toggle="tab">Title</a>
					</li>
					
				</ul>

				<div class="tab-content">
					<div class="tab-pane active" id="type">
						<h3 class="bold">COA - TYPE</h3>
						<hr/>
						
						<div class="panel panel-default panel-shadow" data-collapsed="0"><!-- to apply shadow add class "panel-shadow" -->
		                    <!-- panel head -->
		                    <div class="panel-heading">
		                        <div class="panel-title">Create New COA - Type</div>
		                    </div>
		                    
		                    <!-- panel body -->
		                    <div class="panel-body">

		                        <form method="post" id="frmSubmitCoaType" action="<?=base_url()?>accounting/coa_type" class="form-horizontal form-groups-bordered">
		                            <div class="msg"></div>

		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Code</label>
		                                
		                                <div class="col-sm-5">
		                                    <input class="form-control" type="text" name="coatype_code" autofocus="" required="" >
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Description</label>
		                                
		                                <div class="col-sm-5">
		                                    <input class="form-control" type="text" name="coatype_desc" autofocus="" required="" >
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <div class="col-sm-offset-3 col-sm-5">
		                                    <button type="submit" class="btn btn-success"> <i class="fa fa-check"></i> Create</button>
		                                    <button type="reset" class="btn btn-default"> Clear</button>
		                                </div>
		                            </div>
		                        </form>
		                    </div>
		                    
		                </div>

		                

						<table class="table table-bordered table-condensed datatable">
							<thead>
								<th class="width-5">No.</th>
								<th>Code</th>
								<th>Description</th>
								<th class="width-5"></th>
							</thead>

							<tbody>
								<?php 
									$cnt = 1;
									foreach($coa_type->result() as $r):?>
										<tr>
											<td class="text-center"><?=$cnt++?></td>
											<td><?=$r->coatype_code?></td>
											<td><?=$r->coatype_desc?></td>
											<td>
												<!-- <button class="btn btn-info btn-xs">Edit</button> -->
												<button class="btn btn-danger btn-xs coatype_delete" data-id="<?=$r->coatype_id?>">Remove</button>
											</td>
										</tr>
								<?php endforeach;?>
							</tbody>
						</table>
					</div>

					<div class="tab-pane" id="group">
						<h3 class="bold">COA - GROUP</h3>
						<hr/>

						<div class="panel panel-default panel-shadow" data-collapsed="0"><!-- to apply shadow add class "panel-shadow" -->
		                    <!-- panel head -->
		                    <div class="panel-heading">
		                        <div class="panel-title">Create New COA - Group</div>
		                    </div>
		                    
		                    <!-- panel body -->
		                    <div class="panel-body">

		                        <form method="post" id="frmSubmitCoaGroup" action="<?=base_url()?>accounting/coa_group" class="form-horizontal form-groups-bordered">
		                            <div class="msg"></div>
		                            
		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Type</label>
		                                
		                                <div class="col-sm-5">
		                                	<select name="coatype_id" class="form-control">
		                                		<?php foreach($coa_type->result() as $t): ?>
		                                			<option value="<?=$t->coatype_id?>"><?=$t->coatype_code.' - '.$t->coatype_desc?></option>
		                                		<?php endforeach;?>
		                                	</select>
		                                </div>
		                            </div>


		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Description</label>
		                                
		                                <div class="col-sm-5">
		                                    <input class="form-control" type="text" name="coagrp_desc" autofocus="" required="" >
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <div class="col-sm-offset-3 col-sm-5">
		                                    <button type="submit" class="btn btn-success"> <i class="fa fa-check"></i> Create</button>
		                                    <button type="reset" class="btn btn-default"> Clear</button>
		                                </div>
		                            </div>
		                        </form>
		                    </div>
		                    
		                </div>

						<table class="table table-bordered table-condensed datatable">
							<thead>
								<th class="width-5">No.</th>
								<th>Type</th>
								<th>Description</th>
								<th></th>
							</thead>

							<tbody>
								<?php 
									$cnt = 1;
									foreach($coa_group->result() as $g):?>
										<tr>
											<td class="text-center"><?=$cnt++?></td>
											<td><?=$g->coatype_code.' - '.$g->coatype_desc?></td>
											<td><?=$g->coagrp_desc?></td>
											<td>
												<!-- <button class="btn btn-info btn-xs">Edit</button> -->
												<button class="btn btn-danger btn-xs coagrp_delete" data-id="<?=$g->coagrp_id?>">Remove</button>
											</td>
										</tr>
								<?php endforeach;?>
							</tbody>
						</table>
					</div>

					<div class="tab-pane" id="title">
						<h3 class="bold">COA - TITLE</h3>
						<hr/>

						<div class="panel panel-default panel-shadow" data-collapsed="0"><!-- to apply shadow add class "panel-shadow" -->
		                    <!-- panel head -->
		                    <div class="panel-heading">
		                        <div class="panel-title">Create New COA - Title</div>
		                    </div>
		                    
		                    <!-- panel body -->
		                    <div class="panel-body">

		                        <form method="post" id="frmSubmitCoaTitle" action="<?=base_url()?>accounting/coa_title" class="form-horizontal form-groups-bordered">
		                            <div class="msg"></div>
		                            
		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Type</label>
		                                
		                                <div class="col-sm-5">
		                                	<select name="coatype_id" class="form-control coatype_id">
		                                		<option selected="" disabled="">Select</option>
		                                		<?php foreach($coa_type->result() as $t): ?>
		                                			<option value="<?=$t->coatype_id?>"><?=$t->coatype_code.' - '.$t->coatype_desc?></option>
		                                		<?php endforeach;?>
		                                	</select>
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Group</label>
		                                
		                                <div class="col-sm-5">
		                                	<select name="coagrp_id" class="form-control coagrp_id">
		                                		
		                                	</select>
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Code</label>
		                                
		                                <div class="col-sm-5">
		                                    <input class="form-control" type="text" name="coatitle_code" autofocus="" required="" >
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <label class="col-sm-3 control-label">Description</label>
		                                
		                                <div class="col-sm-5">
		                                    <input class="form-control" type="text" name="coatitle_desc" autofocus="" required="" >
		                                </div>
		                            </div>

		                            <div class="form-group">
		                                <div class="col-sm-offset-3 col-sm-5">
		                                    <button type="submit" class="btn btn-success"> <i class="fa fa-check"></i> Create</button>
		                                    <button type="reset" class="btn btn-default"> Clear</button>
		                                </div>
		                            </div>
		                        </form>
		                    </div>
		                    
		                </div>

						<table class="table table-bordered table-condensed datatable">
							<thead>
								<th class="width-5">No.</th>
								<th>Type</th>
								<th>Group</th>
								<th>Code & Description</th>
								<th class="width-5"></th>
							</thead>

							<tbody>
								<?php 
									$cnt = 1;
									foreach($coa_title->result() as $t):?>
										<tr>
											<td class="text-center"><?=$cnt++?></td>
											<td><?=$t->coatype_code.' - '.$t->coatype_desc?></td>
											<td><?=$t->coagrp_desc?></td>
											<td><?=$t->coatitle_code.' - '.$t->coatitle_desc?></td>
											<td>
												<button class="btn btn-danger btn-xs coatitle_delete" data-id="<?=$t->coatitle_id?>">Remove</button>
											</td>
										</tr>
								<?php endforeach;?>
							</tbody>
						</table>
					</div>
				</div>
        	</div>
        </div>
        
    </div><!---END MAIN CONTENT -->

    
    
</div> <!-- end of body container -->

<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
    $(".datatable").dataTable({  "sPaginationType": "bootstrap"  });

    $('#frmSubmitCoaType').crud_refresh();
    $('#frmSubmitCoaGroup').crud();
    $('#frmSubmitCoaTitle').crud();

    $('.coatype_id').on('change', function(){
    	coatype_id = $(this).val();
    	$('.coagrp_id').load(base_url+'accounting/get_coa_group/'+coatype_id);
    });



    //DELETE function
    $(document.body).on("click",".coatype_delete",function(e){
        var tr = $(this).closest('tr');
        var id = tr.find('.coatype_delete').attr('data-id');

        $.ajax({url: base_url+'accounting/delete_coa_type/'+id, success: function(result){
            tr.fadeOut(1000);
            window.setTimeout(function(){location.reload()},1000);
        }});
    });

    $(document.body).on("click",".coagrp_delete",function(e){
        var tr = $(this).closest('tr');
        var id = tr.find('.coagrp_delete').attr('data-id');

        $.ajax({url: base_url+'accounting/delete_coa_group/'+id, success: function(result){
            tr.fadeOut(1000);
            window.setTimeout(function(){location.reload()},1000);
        }});
    });

    $(document.body).on("click",".coatitle_delete",function(e){
        var tr = $(this).closest('tr');
        var id = tr.find('.coatitle_delete').attr('data-id');

        $.ajax({url: base_url+'accounting/delete_coa_title/'+id, success: function(result){
            tr.fadeOut(1000);
            window.setTimeout(function(){location.reload()},1000);
        }});
    });

  });

  
</script>
</body>
</html>