
        <?php 
            $sec_name       = '';
            $lvl_name       = '';
            $lvl_id         = '';
            $sec_teacher    = '';
            $dept_name      = '';
            $lvl_color      = '';

            $sy_id          = $this->module->get_active_sy();
            $sec_id         = $sec_id;
            //$quarter        = $this->module->table_where('quarter', array('qtr_active' => 'Y'));
            $qtr_code       = $this->uri->segment(4);
            $controller     = $this->uri->segment(1);

            if($section->num_rows() > 0){
                foreach($section->result() as $r){
                    $lvl_id         = $r->lvl_id;
                    $lvl_name       = $r->lvl_name;
                    $sec_name       = $r->sec_name;
                    $sec_teacher    = $r->sec_teacher;
                    $dept_name      = $r->dept_name;
                    $lvl_color      = $r->lvl_color;
                }
            }
        ?>
        

        <div class="row">
            <div class="col-md-12 ">
                <div class="panel panel-primary " >
                    <div class="panel-heading" style="padding:20px 20px">
                        <div class="row">
                            <div class="col-md-6">
                                <h1 class="m-0 bold" style="color:#<?=$lvl_color?>"><?=$sec_name?></h1>
                                <h4 class="m-0"><?= '<strong>'.$lvl_name .'</strong> | '.$dept_name.' Department' ?></h4>
                                <h4 class="m-0"><strong><?=$sec_teacher?></strong> <small> | Class Adviser</small> </h4>
                                <h4 class="m-0">School Year <?= $this->module->get_active_sy_name()?></h4>
                            </div>

                            <div class="col-md-6 text-right">

                                <div class="row">

                                    <div class="col-md-6 col-md-offset-6 text-right">
                                        <select class="form-control selectboxit"  id="quarter"  onchange= "location = this.value" > 
                                            <?php  
                                              $quarters      = $this->module->get_table('quarter');
                                              foreach($quarters->result() as $q): ?>
                                              <option value="<?=base_url().$controller.'/advisory_class/'.$sec_id.'/'.$q->qtr_code?>" <?=($qtr_code==$q->qtr_code ?  'selected="" ' : '' )?> ><?=$q->qtr_name?></option>
                                            <?php endforeach; ?>
                                        </select>
                                        
                                    </div>

                                    <br/>
                                    <br/><br/>


                                    <div class="col-md-12 text-right">
                                        <div class="btn-group">
                                            
                                            <a href="<?=base_url()?>grading/print_report_card/<?=$sec_id?>" class="btn btn-blue "><i class="fa fa-print"></i> Print Report Card</a>
                                            <a href="<?=base_url()?>grading/print_advisory_class/<?=$sec_id.'/'.$qtr_code?>" class="btn btn-primary "><i class="fa fa-print"></i> Print Advisory Class</a>
                                            <?php 
                                                $usr_type       = $this->session->userdata('usr_type');
                                                if( ($usr_type == 'Admin') ||  ($usr_type == 'System Admin')):
                                            ?>
                                            <a href="<?=base_url()?>admin/rating_sheet/<?=$sec_id?>" class="btn btn-primary "><i class="fa fa-table"></i> Rating Sheet</a>
                                            <?php endif;?>

                                        </div>
                                    </div>
                                    
                                </div>
                                
                                

                                
                                
                            </div>
                        </div>
                    </div>

                    <div class="panel-body">
                        

                        <div class="table-wrapper">
                            <div class="table-scroll">
                                <table class="table-custom table-bordered " id="data">
                                    <thead>
                                            <th class="text-center bold" style="width:2%">Rank</th>
                                            <th  style="width:20%" class="bold" > &nbsp;&nbsp; Learners Name</th>
                                            <?php 

                                                    foreach ($subject->result() as $r):
                                                        $sub_name   = $r->sub_name;
                                                        $sub_id     = $r->sub_id;

                                                        $check_subject = $this->module->table_where('subject_assignment', array('sub_id' => $sub_id, 'sec_id' => $sec_id));
                                                        if($check_subject->num_rows() > 0):
                                                    ?>

                                                       <th class="text-center  vmiddle width-5 bold">
                                                        <?=$sub_name?> 
                                                       </th>
                                                        
                                                        <?php 
                                                            $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));                                                        foreach($subject_detail->result() as $s):
                                                                $subj_det_name = $s->subj_det_name;
                                                        ?>

                                                            <th class=" vbottom text-center bold" style="width:10px;">
                                                               <small> <?=$subj_det_name?></small>
                                                            </th>

                                                        <?php endforeach; ?>
                                                    <?php endif; ?>
                                            <?php endforeach; ?>
                                            <th class="text-center vmiddle width-5 bold">Average</th>
                                            <th class="text-center vmiddle width-5 bold">Rounded</th>
                                            <th class="text-center vmiddle width-5 bold">Lowest</th>
                                            <th class="text-center vmiddle width-15 bold">Award</th>
                                    </thead>

                                    <tbody>

                                    <?php 
                                            $cnt=1;
                                            foreach($student_data as $d):
                                                $stud_id    = $d['stud_id'];
                                                $stud_name  = $d['stud_name'];
                                        ?>
                                            <tr class="me">
                                                <td class="text-center vmiddle td" ><small><?=$cnt++?></small></td>
                                                <td class="vmiddle td name">
                                                    &nbsp;&nbsp;<?=$stud_name?>
                                                </td>

                                                <?php 

                                                    $sub_grades = array(); 

                                                    $average_divider = 0;
                                                    $average         = 0;

                                                    foreach ($subject->result() as $r):
                                                    $sub_name   = $r->sub_name;
                                                    $sub_id     = $r->sub_id;

                                                    $check_subject = $this->module->table_where('subject_assignment', array('sub_id' => $sub_id, 'sec_id' => $sec_id));
                                                    if($check_subject->num_rows() > 0):
                                                    
                                                        foreach($student_data as $g):
                                                            $gstud_id   = $g['stud_id'];
                                                            $gsubjects  = $g['subjects'];


                                                            if($gstud_id == $stud_id):
                                                                foreach($gsubjects as $h):
                                                                    $hsub_id    = $h['sub_id'];
                                                                    if($hsub_id == $sub_id):
                                                                        $ggrade = $h['total_grade'];
                                                                        array_push($sub_grades,  $ggrade );

                                                                        
                                                                        $average         += $ggrade;
                                                                        $average_divider ++;
                                                                ?>
                                                                    <td class="text-center vmiddle td ">
                                                                       <?=empty($ggrade) ? '' : $ggrade?>
                                                                   </td>

                                                                    <?php endif; ?>
                                                               <?php endforeach; ?>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>

                                                            <?php 
                                                                $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));
                                                                foreach($subject_detail->result() as $s):
                                                                    $subj_det_name  = $s->subj_det_name;
                                                                    $subj_det_id    =  $s->subj_det_id;
                                                            ?>

                                                            <td class="text-center vmiddle td ">
                                                                <?php 
                                                                foreach($student_data as $g):
                                                                    $gstud_id   = $g['stud_id'];
                                                                    $gsubjects  = $g['subjects'];

                                                                    if($gstud_id == $stud_id):
                                                                        foreach($gsubjects as $h):
                                                                            $hsub_id    = $h['sub_id'];
                                                                            if($hsub_id == $sub_id):
                                                                                $ggrade             = $h['total_grade'];
                                                                                $gsubject_details   = $h['subject_details'];

                                                                                foreach($gsubject_details as $d):
                                                                                    $dsub_id      = $d['sub_id'];
                                                                                    $dsubj_det_id = $d['subj_det_id'];
                                                                                    $dgrade       = $d['grade'];

                                                                                    if( ($dsub_id == $sub_id) && ($dsubj_det_id == $subj_det_id) && ($gstud_id == $stud_id) ){
                                                                                        echo $dgrade;

                                                                                        if(strtolower($sub_name) <> 'english'){
                                                                                            //push to disqualifying grade
                                                                                            if($dgrade <> 0){
                                                                                                array_push($sub_grades,  $dgrade );
                                                                                            }
                                                                                            
                                                                                        } 
                                                                                    }
                                                                                ?>
                                                                                <?php endforeach; ?>
                                                                            <?php endif; ?>
                                                                       <?php endforeach; ?>
                                                                    <?php endif; ?>
                                                                <?php endforeach; ?>
                                                            </td>
                                                            <?php endforeach; ?> <!-- end subject_detail_result -->

                                                    <?php endif; ?>
                                                <?php endforeach; ?>

                                                <td class="text-center vmiddle td ws final">
                                                    <?php 

                                                    $final_average =  round( ($average / ($average_divider)), 3);
                                                    echo number_format($final_average, 3);
                                                        
                                                        /*if($average == 0){
                                                            $final_average = 0;
                                                        }else{
                                                            $final_average = round(($average / ($total_cnt)),3);
                                                        }


                                                        //$final_average =   ($ave / ($average_divider));
                                                        echo number_format( round($final_average, 2), 3);*/
                                                    ?>
                                                </td>

                                                <td class="text-center vmiddle td ">
                                                        <?= round($final_average);?>
                                                </td>

                                                <td class="text-center vmiddle td" >
                                                    <?php 
                                                        if(!empty($sub_grades)){
                                                            $min_grade  = 0;
                                                            $min        = min($sub_grades);
                                                            $min_grade  = $min;
                                                            echo $min_grade;
                                                        }
                                                    ?>
                                                </td>

                                                <td class="text-center vmiddle td ">
                                                    <?php 
                                                        $award = '---';
                                                        $ave = floor($final_average);


                                                        /*if($ave >=98 && $ave <=100 ){
                                                            
                                                            if($min_grade >= 97){
                                                                $award = 'With Highest Honors';  
                                                            }else if($min_grade >= 94){
                                                                $award = 'With High Honors';
                                                            }else if ($min_grade >= 90){
                                                                $award = 'With Honors';
                                                            }  

                                                        }else if($ave >=95 && $ave <=97){
                                                           
                                                            if($min_grade >= 94){
                                                                $award = 'With High Honors';
                                                            }else if ($min_grade >= 90){
                                                                $award = 'With Honors';
                                                            }  
                                                            
                                                        }else if($ave >=90 && $ave <=94) {
                                                            
                                                            if ($min_grade >= 90){
                                                                $award = 'With Honors';
                                                            }  
                                                        }else{
                                                            $award = $award;
                                                        }

                                                        echo $award;*/

                                                        if($ave >=98 && $ave <=100 ){
                                                            if($min_grade >= 97){
                                                                $award = 'With Highest Honors';  
                                                            }else if($min_grade >= 94){
                                                                $award = 'With High Honors';
                                                            }else if ($min_grade >= 90){
                                                                $award = 'With Honors';
                                                            }                                                                                             
                                                        }else if($ave >=95 && $ave <=97){
                                                            if($min_grade >= 97){
                                                                $award = 'With Highest Honors';  
                                                            }else if($min_grade >= 94){
                                                                $award = 'With High Honors';
                                                            }else if ($min_grade >= 90){
                                                                $award = 'With Honors';
                                                            }  
                                                        }else if($ave >=90 && $ave <=94) {
                                                            if($min_grade >= 97){
                                                                $award = 'With Highest Honors';  
                                                            }else if($min_grade >= 94){
                                                                $award = 'With High Honors';
                                                            }else if ($min_grade >= 90){
                                                                $award = 'With Honors';
                                                            }  
                                                        }else{
                                                            $award = $award;
                                                        }

                                                        echo $award;
                                                    ?>
                                                </td>
                                            </tr>
                                            <?php endforeach; ?>
                                    </tbody>

                                  
                                   
                                </table>
                            </div>
                                
                        </div>

                        

                    </div>
                </div>
            </div>
        </div>
