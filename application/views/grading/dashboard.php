<?php 

    
  $usr_name       = $this->session->userdata('usr_name');
  $usr_type       = $this->session->userdata('usr_type');
  $usr_firstname  = $this->session->userdata('usr_firstname');
  $usr_lastname   = $this->session->userdata('usr_lastname');
  $usr_is_login   = $this->session->userdata('usr_is_login');
  $tch_id         = $this->session->userdata('tch_id');
  $sy_id          = $this->module->get_active_sy();

  $where           = 'tch_id = "'.$tch_id.'"  AND sy_id = "'.$sy_id.'" ';

  if( ($usr_type <> 'Faculty') || empty($tch_id) ){
    header('Location: '.base_url());
  }

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container  horizontal-menu sidebar-collapsed"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    <header class="navbar navbar-fixed-top"><!-- set fixed position by adding class "navbar-fixed-top" -->
        
        <div class="navbar-inner">
            <?=$this->load->view('inc/topbar');?>
        </div>
    </header>

    <div class="main-content">
        
        <div class="row">

            <div class="col-md-2 col-sm-12">
                <div class="panel panel-primary panel-table">
                    <div class="panel-heading">
                        <div class="panel-title">
                            <h3>Dashboard</h3> 
                            <p>Hi Teacher this is your dashboard</p>
                        </div>
                    </div>

                    <div class="panel-body p-0">
                        <ul class="list-group mb-0"> 
                            <a href="<?=base_url()?>grading" class="list-group-item bold active">
                                <i class="fa fa-leaf"></i> <?= $usr_firstname.' '.$usr_lastname?>
                            </a>

                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-md-7 col-sm-7 col-xs-7">
                                        <a href="<?=base_url()?>grading/update_account"><i class="fa fa-pencil"></i> Update Account</a>
                                    </div>
                                    <div class="col-md-5 col-sm-5 col-xs-5 text-right">
                                        <a href="<?=base_url()?>auth/logout"><i class="fa fa-sign-out"></i> Logout</a>
                                    </div>
                                </div>
                            </li>

                            <li class="list-group-item">
                                <div class="row text-center text-black">
                                    <div class="col-md-4 col-xs-4 col-sm-4">
                                        <p class="font-38 mb-0">
                                            <?php 
                                                $sec_cnt = $this->module->get_query("SELECT COUNT(DISTINCT(sec_id)) as cnt FROM v_subject_teacher_assignment WHERE ".$where." ");
                                                echo ($sec_cnt->num_rows() < 1 ? 0 : $sec_cnt->row('cnt') )
                                            ?>
                                        </p>
                                        Sections
                                    </div>

                                    <div class="col-md-4 col-xs-4 col-sm-4 text-black">
                                        <p class="font-38 mb-0">
                                            <?php 
                                                $lvl_cnt = $this->module->get_query("SELECT COUNT(DISTINCT(lvl_id)) as cnt FROM v_subject_teacher_assignment WHERE ".$where." ");
                                                echo ($lvl_cnt->num_rows() < 1 ? 0 : $lvl_cnt->row('cnt') )
                                            ?>
                                        </p>
                                        Levels

                                    </div>

                                    <div class="col-md-4 col-xs-4 col-sm-4 text-black">
                                        <p class="font-38 mb-0 ">
                                            <?php 
                                                $sub_cnt = $this->module->get_query("SELECT COUNT(DISTINCT(sub_id)) as cnt FROM v_subject_teacher_assignment WHERE ".$where." ");
                                                echo ($sub_cnt->num_rows() < 1 ? 0 : $sub_cnt->row('cnt') )
                                            ?>
                                        </p>
                                        Subjects
                                    </div>
                                </div>
                            </li>

                            
                        </ul>
                    </div>
                </div>

            </div>

            <div class="col-md-10 col-sm-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="panel-title">
                            <h3>Subjects Load</h3>
                            <p>Panel for your subjects load for the School Year <?=$this->module->get_active_sy_name()?></p>
                        </div>
                    </div>

                    <div class="panel-body"> 
                        <div class="row">

                            <?php 
                                $subject_load = $this->module->get_query("SELECT * FROM v_subject_teacher_assignment WHERE ".$where."  GROUP BY sub_id  ORDER BY sub_sort ASC");
                                if($subject_load->num_rows() < 1 ): ?>
                                    <td colspan="2">Database Empty</td>
                            <?php else: 
                                $cnt =1;
                                foreach($subject_load->result() as $r):
                            ?>

                            <div class="col-sm-6">
                                
                                <div class="panel panel-default panel-shadow" data-collapsed="0">
                    
                                    <!-- panel head -->
                                    <div class="panel-heading">
                                        <div class="panel-title">
                                            <?=$r->sub_name;?>
                                        </div>
                                        
                                    </div>
                                    
                                    <!-- panel body -->
                                    <div class="panel-body">
                                        
                                       <table class="table table-striped  table-condensed ">
                                                
                                                        <tbody>
                                                            <?php 
                                                                $subj_det_id = $r->subj_det_id;

                                                                if($subj_det_id <> 0 ):

                                                                $subject_detail =  $this->module->get_query("SELECT * FROM v_subject_teacher_assignment_detail WHERE sub_id=".$r->sub_id." GROUP BY subj_det_id");

                                                                if($subject_detail->num_rows() > 0):
                                                                    foreach($subject_detail->result() as $s):
                                                            
                                                                        $section =  $this->module->get_query("SELECT * FROM v_subject_teacher_assignment_detail WHERE ".$where." AND subj_det_id = ".$s->subj_det_id." ORDER BY lvl_sort, sec_sort ASC " );

                                                                         if($section->num_rows() > 0 ):
                                                            ?>      
                                                                            <tr>
                                                                                <td class="text-center vmiddle width-15" ><h5 class="m-0 bold"><?=$s->subj_det_name;?></h5></td>
                                                                                <td class="">
                                                                                <?php foreach($section->result() as $sb): 
                                                                                    $color = 'color:#fff;background-color:#'.$sb->lvl_color;
                                                                                ?>

                                                                                    <div class="btn-group" style="margin-top:5px">
                                                                                        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" style="<?=$color?>">
                                                                                            <small><?=substr($sb->lvl_name, -1)?></small>  <?=$sb->sec_name ?>  <span class="caret" style="color:#fff; border-top: 4px solid #fff;border-right: 4px solid transparent;border-left: 4px solid transparent;"></span>
                                                                                        </button>
                                                                                        <ul class="dropdown-menu dropdown-default" role="menu" >
                                                                                            
                                                                                            <li>
                                                                                                <a href="<?=base_url()?>grading/add_score/<?=$sb->subj_id?>"  >
                                                                                                       <i class="fa fa-plus"></i> Record Score
                                                                                                </a>
                                                                                            </li>

                                                                                            <li>
                                                                                                <?php $active_qtr   = $this->module->table_where('quarter', array('qtr_active' => 'Y'))->row('qtr_code'); ?>
                                                                                                <a href="<?=base_url()?>grading/class_record/<?=$sb->subj_id.'/'.$active_qtr?>" >
                                                                                                        <i class="fa fa-table"></i> View Class Record
                                                                                                </a>
                                                                                            </li>

                                                                                            <!-- <li class="divider"></li>
                                                                                            
                                                                                            <li>
                                                                                                <a href="<?=base_url()?>grading/quarterly_grade/<?=$sb->subj_id?>" >
                                                                                                      <i class="fa fa-calendar"></i>  Quarterly Grades
                                                                                                </a>
                                                                                            </li> -->

                                                                                            

                                                                                            
                                                                                        </ul>
                                                                                    </div>

                                                                                
                                                                                <?php endforeach; ?>
                                                                            </td>
                                                                            </tr>

                                                            <?php 
                                                                        endif;
                                                                    endforeach;
                                                                endif; 

                                                                 else: ?>

                                                                 <tr>
                                                                    <td class="text-center width-15"></td>
                                                                    <td>
                                                                        <?php 
                                                                            $section =  $this->module->get_query("SELECT * FROM v_subject_teacher_assignment WHERE ".$where." AND sub_id = ".$r->sub_id." ORDER BY sec_sort ASC " );

                                                                            if($section->num_rows() > 0):
                                                                                foreach($section->result() as $sb):
                                                                                    $color = 'color:#fff;background-color:#'.$sb->lvl_color;

                                                                        ?>

                                                                        <div class="btn-group" style="margin-top:5px">
                                                                            <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" style="<?=$color?>">
                                                                                <small><?=substr($sb->lvl_name, -1)?></small>  <?=$sb->sec_name ?>  <span class="caret" style="color:#fff; border-top: 4px solid #fff;border-right: 4px solid transparent;border-left: 4px solid transparent;"></span>
                                                                            </button>
                                                                            <ul class="dropdown-menu dropdown-default" role="menu">
                                                                                
                                                                                <li>
                                                                                    <a href="<?=base_url()?>grading/add_score/<?=$sb->subj_id?>" >
                                                                                            <i class="fa fa-plus"></i> Record Score
                                                                                    </a>
                                                                                </li>

                                                                                <li>
                                                                                    <?php $active_qtr   = $this->module->table_where('quarter', array('qtr_active' => 'Y'))->row('qtr_code'); ?>
                                                                                    <a href="<?=base_url()?>grading/class_record/<?=$sb->subj_id.'/'.$active_qtr?>" >
                                                                                          <i class="fa fa-table"></i>  View Class Record
                                                                                    </a>
                                                                                </li>

                                                                                <!-- <li class="divider"></li>
                                                                                
                                                                                <li>
                                                                                    <a href="<?=base_url()?>grading/quarterly_grade/<?=$sb->subj_id?>" >
                                                                                          <i class="fa fa-calendar"></i>  Quarterly Grades
                                                                                    </a>
                                                                                </li> -->

                                                                                
                                                                            </ul>
                                                                        </div>




                                                                        <?php endforeach; 
                                                                            endif;
                                                                        ?>
                                                                    </td>
                                                                </tr>


                                                            <?php endif; ?>
                                                        </tbody>
                                                    </table>
                                        
                                        
                                    </div>
                                </div>
                                
                            </div>

                            <?php endforeach; 
                                    endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

        
    </div>

    
</div> <!-- end of body container -->


<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
       

  });
</script>
</body>
</html>