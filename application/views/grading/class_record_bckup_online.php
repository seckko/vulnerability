<?php 

  if(empty($subj_id)){
    header('Location: '.base_url().'grading');
  }

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

 

</head>
<body class="page-body gray">

<div class="page-container  horizontal-menu sidebar-collapsed"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    <header class="navbar navbar-fixed-top"><!-- set fixed position by adding class "navbar-fixed-top" table-responsive -->
        
        <div class="navbar-inner">
            <?=$this->load->view('inc/topbar');?>
        </div>
    </header>

    <div class="main-content">
        
        <?php 
            $subj_id        = ''; 
            $lvl_id         = '';  
            $sec_id         = '';  
            $tch_id         = '';  
            $sy_id          = ''; 
            $sub_id         = '';  
            $subj_det_id    = '';  
            $lvl_name       = ''; 
            $lvl_color      = '';      
            $sec_name       = '';   
            $dept_name      = '';          
            $sub_name       = ''; 

            foreach ($subj_assignment->result() as $r) {
                $subj_id        = $r->subj_id ; 
                $lvl_id         = $r->lvl_id ;  
                $sec_id         = $r->sec_id ;  
                $tch_id         = $r->tch_id ;  
                $sy_id          = $r->sy_id ; 
                $sub_id         = $r->sub_id ;  
                $subj_det_id    = $r->subj_det_id ;  
                $lvl_name       = $r->lvl_name ; 
                $lvl_color      = $r->lvl_color ;      
                $sec_name       = $r->sec_name ;   
                $dept_name      = $r->dept_name ;          
                $sub_name       = $r->sub_name ;
                $subj_det       = $this->module->get_query("SELECT subj_det_name FROM subject_detail WHERE subj_det_id =".$subj_det_id." ");  
            } 

              $subj_det_name  = $subj_det->row('subj_det_name');
              
              if( $subj_det->num_rows() > 0){
                  $subj_det_name =  '<small> | '.$subj_det_name.'</small>';
              }else{
                  $subj_det_name = '';
              }

              $student_male          = $this->module->get_query("SELECT * FROM v_student_section_class_list WHERE  sy_id = ".$sy_id." AND sec_id = ".$sec_id." AND stud_gender = 'Male' ORDER BY stud_lastname, stud_firstname");
              $student_female        = $this->module->get_query("SELECT * FROM v_student_section_class_list WHERE  sy_id = ".$sy_id." AND sec_id = ".$sec_id." AND stud_gender = 'Female' ORDER BY stud_lastname, stud_firstname");

              //echo $this->db->last_query();
              
              $counts = intval($student_male->num_rows()) + intval($student_female->num_rows());
              $count  = intval($counts);

              $qtr_code = empty($this->uri->segment(4)) ? '1Q' : $this->uri->segment(4);
              $quarter  = $this->module->table_where('quarter', array('qtr_code' => $qtr_code));


              $score_hdr_ww     = $this->module->get_query("SELECT * FROM student_score_hdr WHERE sy_id = ".$sy_id." AND subj_id = ".$subj_id." AND scr_type = 'WW' AND scr_quarter ='".$qtr_code."' ORDER BY scr_id");
              $score_hdr_pt     = $this->module->get_query("SELECT * FROM student_score_hdr WHERE sy_id = ".$sy_id." AND subj_id = ".$subj_id." AND scr_type = 'PT' AND scr_quarter ='".$qtr_code."' ORDER BY scr_id");
              $score_hdr_qa     = $this->module->get_query("SELECT * FROM student_score_hdr WHERE sy_id = ".$sy_id." AND subj_id = ".$subj_id." AND scr_type = 'QA' AND scr_quarter ='".$qtr_code."' ORDER BY scr_id");

              //echo $this->db->last_query(); 

                $total_ww = 0;
                $total_pt = 0;
                $total_qa = 0;

            
                $initial_grade = 0;
                $final_grade = 0;

                $total_ww_st_cnt = 0;
                $total_pt_st_cnt = 0;
                $total_qa_st_cnt = 0;

                $total_all_cnt = 0;

                $weighted_score_ww = 0;
                $weighted_score_pt = 0;
                $weighted_score_qa = 0;

                $comp_assessment = $this->module->get_query("SELECT * FROM component_assessment WHERE sub_id = ".$sub_id." ");
                $ca_ww_percentage = 0;
                $ca_pt_percentage = 0;
                $ca_qa_percentage = 0;

                foreach($comp_assessment->result() as $l){
                    $ca_ww_percentage = $l->ca_ww_percentage;
                    $ca_pt_percentage = $l->ca_pt_percentage;
                    $ca_qa_percentage = $l->ca_qa_percentage;
                }

                $hw = 1;
                $sw = 1;
                $qz = 1;

                $ww = 0;
                $pt = 0;
                $qa = 0;


        ?>

        <div class="row">
            <div class="col-md-12 ">
                <div class="panel panel-primary " >
                    <div class="panel-heading" style="padding:30px 20px">
                        <div class="row">
                            <div class="col-md-8">
                                <h1 class="m-0" ><strong style="color:#<?=$lvl_color?>"> <?=$sub_name?></strong>  <?=$subj_det_name?></h1>
                                <h4 class=" m-0 bold"> CLASS RECORD </h4>
                            </div>

                            <div class="col-md-4 text-right">
                                <div class="row">
                                    <div class="col-md-6 col-md-offset-6">
                                        <h4 class=" m-0 bold"> QUARTER </h4>
                                        <select class="form-control selectboxit"  id="quarter"  onchange= "location = this.value" > 
                                        <?php  
                                          $quarter      = $this->module->get_table('quarter');
                                      
                                          foreach($quarter->result() as $q): ?>
                                          <option value="<?=base_url().'grading/class_record/'.$subj_id.'/'.$q->qtr_code?>" <?=($qtr_code==$q->qtr_code ?  'selected="" ' : '' )?> ><?=$q->qtr_name?></option>
                                        <?php endforeach; ?>
                                      </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-body">
                        <form id="frmSubmit" method="post" action="<?=base_url()?>grading/submit_grade">

                            <div class="row">
                                <div class="col-md-6">
                                    <h3 class="m-0 bold"> <?= $lvl_name .' - '.$sec_name.' ('.$count.') '?> </h3>
                                    <p class="m-0"><?=$dept_name?> Department</p>
                                </div>

                                <div class="col-md-6 text-right">
                                    <a href="<?=base_url()?>grading/add_score/<?=$subj_id?>" class="btn btn-blue"><i class="fa fa-plus"></i> Record Score </a>
                                    <div class="btn-group">
                                        <a href="<?=base_url()?>grading/print_class_record/<?=$subj_id.'/'.$qtr_code?>" type="button" class="btn btn-default"><i class="fa fa-print"></i> Print</a>
                                        <a href="<?=base_url()?>grading/excel_class_record/<?=$subj_id.'/'.$qtr_code?>" type="button" class="btn btn-default"><i class="fa fa-download"></i> Excel</a>
                                    </div>
                                </div>
                            </div>

                        
                            
                            <div class="table-wrapper">
                                <div class="table-scroll">
                                    <input type="hidden" name="sy_id" value="<?= $sy_id ?>">
                                    <input type="hidden" name="subj_id" value="<?= $subj_id ?>">
                                    <input type="hidden" name="sub_id" value="<?= $sub_id ?>">
                                    <input type="hidden" name="subj_det_id" value="<?= $subj_det_id ?>">
                                    <input type="hidden" name="sec_id" value="<?= $sec_id ?>">
                                    <input type="hidden" name="qtr_code" value="<?= $qtr_code ?>">

                                    <table class=" table-bordered" id="data" style="background-color: #fff;">
                                        <tbody>
                                            <tr>
                                                <td colspan="2"></td>
                                                <?php  

                                                

                                                $hdr = $this->module->get_query("SELECT scr_type, COUNT(*) AS cnt FROM v_subject_score WHERE subj_id = ".$subj_id." AND sy_id = ".$sy_id." AND scr_quarter = '".$qtr_code."' GROUP BY scr_type");

                                                foreach($hdr->result() as $r){

                                                    $scr_type   = $r->scr_type;
                                                    $cnt        = $r->cnt;

                                                    if($scr_type == 'WW'){
                                                        $ww = $cnt;
                                                    }else if($scr_type == 'PT'){
                                                        $pt = $cnt;
                                                    }else if($scr_type == 'QA'){
                                                        $qa = $cnt;
                                                    }else{
                                                        $ww = 0;
                                                        $pt = 0;
                                                        $qa = 0;
                                                    }
                                                    
                                                }

                                            ?>

                                            <th class="bold text-center vmiddle p-5" colspan="<?=intval($ww) + 3?>" ><h5 class="m-0 bold">WRITTEN WORKS </h5></th>
                                            <th class="bold text-center vmiddle p-5"  colspan="<?=intval($pt) + 3?>" ><h5 class="m-0 bold">PERFORMANCE TASK</h5></th>
                                            <th class="bold text-center vmiddle p-5"  colspan="<?=intval($qa) + 3?>"><h5 class="m-0 bold">QUARTERLY ASSESSMENT</h5></th>
                                            <td colspan="2"></td>
                                                
                                            </tr>

                                            <tr>
                                                <td class="text-center bold widtd-3 vbottom" >No.</td>
                                                <td class="bold vbottom" style="width:20%">LEARNERS NAME</td>
                                                <?php 
                                                $cnt = 1;
                                                foreach ($score_hdr_ww->result() as $k):
                                                    $total_ww += $k->scr_total_score;
                                                ?>
                                                    <td class="text-center vbottom total width-record" style="width:5px">

                                                        <!-- FOR EDITING -->
                                                        <a href="<?=base_url()?>grading/edit_score/<?=$subj_id.'/'.$k->scr_id?>" type="button" ><i class="fa fa-pencil"></i> </a>
                                                        <hr class="m-5" />
                                                        <a href="#" data-id="<?=$k->scr_id?>" type="button" class="delete text-danger"><i class="fa fa-times"></i></a> 

                                                        <hr class="m-5" />
                                                        
                                                        <small><?=$cnt++?><br/>
                                                        <?php 
                                                            $sub_type   = $k->scr_sub_type;
                                                            $sub_name   = '';        
                                                            if($sub_type == 'HW'){
                                                                $sub_name = $sub_type.$hw++;
                                                            } else if($sub_type == 'SW'){
                                                                $sub_name = $sub_type.$sw++;
                                                            }else if($sub_type == 'QZ'){
                                                                $sub_name = $sub_type.$qz++;
                                                            }
                                                            echo $sub_name;
                                                        ?>
                                                        <br/>
                                                        <strong>(<?=$k->scr_total_score?>)</strong></small>
                                                        
                                                    </td>
                                                <?php endforeach; ?>

                                                    <td class="text-center vbottom total"><br/><small>TOTAL</small> <br/> (<strong><?=$total_ww?></strong>)</td>
                                                    <td class="text-center vbottom ps"><br/><br/>PS  </td>
                                                    <td class="text-center vbottom ws" ><br/>WS <br/><strong>(<?=$ca_ww_percentage?>%)</strong><br/> </td>

                                                <?php 
                                                $cnt = 1;
                                                foreach ($score_hdr_pt->result() as $k):
                                                    $total_pt += $k->scr_total_score;
                                                ?>
                                                    <td class="text-center vbottom total">
                                                        
                                                        <!-- FOR EDITING -->
                                                        <a href="<?=base_url()?>grading/edit_score/<?=$subj_id.'/'.$k->scr_id?>" type="button" ><i class="fa fa-pencil"></i></a>
                                                        <hr class="m-5" />
                                                        <a href="#" data-id="<?=$k->scr_id?>" type="button" class="delete text-danger"><i class="fa fa-times"></i></a>
                                                         
                                                        <hr class="m-5" />

                                                        <br/> 
                                                        <small><?=$cnt++?><br/>
                                                        <strong>(<?=$k->scr_total_score?>)</strong></small>
                                                    </td>
                                                <?php endforeach; ?>

                                                    <td class="text-center vbottom total"><br/><small>TOTAL</small> <br/> (<strong><?=$total_pt?></strong>)</td>
                                                    <td class="text-center vbottom ps"><br/><br/>PS <br/> </td>
                                                    <td class="text-center vbottom ws" ><br/>WS <br/><strong>(<?=$ca_pt_percentage?>%)</strong><br/> </td>

                                                <?php 
                                                $cnt = 1;
                                                foreach ($score_hdr_qa->result() as $k):
                                                    $total_qa += $k->scr_total_score;
                                                ?>
                                                    <td class="text-center vbottom total">

                                                        <!-- FOR EDITING -->
                                                        <a href="<?=base_url()?>grading/edit_score/<?=$subj_id.'/'.$k->scr_id?>" type="button" ><i class="fa fa-pencil"></i> </a>
                                                        <hr class="m-5" />
                                                        <a href="#" data-id="<?=$k->scr_id?>" type="button" class="delete text-danger"><i class="fa fa-times"></i></a> 

                                                        <hr class="m-5" />
                                                        <br/>
                                                        <small><?=$cnt++?><br/>
                                                        <strong>(<?=$k->scr_total_score?>)</strong></small>
                                                    </td>
                                                <?php endforeach; ?>
                                                <td class="text-center vbottom total"><br/><small>TOTAL</small> <br/> (<strong><?=$total_qa?></strong>)</td>
                                                <td class="text-center vbottom ps"><br/><br/>PS <br/> </td>
                                                <td class="text-center vbottom ws" ><br/>WS <br/><strong>(<?=$ca_qa_percentage?>%)</strong><br/> </td>

                                                <td class="bold text-center vbottom initial-grade"><small>INITIAL <br/> GRADE</small></td>
                                                <td class="bold text-center vbottom td-danger" ><small>QUARTERLY <br/>GRADE</small></td>

                                            </tr>

                                                <!-- MALE -->

                                                <?php 
                                                $cnt = 1;
                                                foreach($student_male->result() as $r): 
                                                    $total_ww_st = 0;
                                                    $total_pt_st = 0;
                                                    $total_qa_st = 0;                                                
                                                    $stud_id     =  $r->stud_id;

                                                    $score = $this->module->get_query(" SELECT * FROM v_student_score WHERE sy_id = ".$sy_id." AND `stud_gender` = 'Male'  AND `stud_id` = ".$stud_id." AND scr_quarter ='".$qtr_code."' AND subj_id = ".$subj_id." ");

                                                    //echo $this->db->last_query();
                                                ?>
                                                <tr class="me">
                                                   <td class="text-center vmiddle td boys" ><?=$cnt?></td>
                                                   <td class="vmiddle td">
                                                        <h5 class="m-0"> 
                                                           <strong > <?= $r->stud_lastname.'</strong>, '.$r->stud_firstname.' '.substr($r->stud_middlename,0, 1) ?><?= !empty($r->stud_middlename)?'.':''?>
                                                        </h5>
                                                    </td>

                                                        <?php 
                                                        foreach ($score_hdr_ww->result() as $k):  
                                                            $scr_id = $k->scr_id;
                                                            
                                                        ?>
                                                        <td class="text-center vmiddle td">
                                                            <?php if($score->num_rows() > 0 ): ?>
                                                                    <?php foreach($score->result() as $scr): 
                                                                        $scr_scr_id     = $scr->scr_id;
                                                                        $scr_stud_id    = $scr->stud_id;
                                                                        $scr_scr_score  = $scr->sscr_score;
                                                                        $scr_scr_absent = $scr->sscr_absent;

                                                                        if(($scr_id == $scr_scr_id) && ($stud_id == $scr_stud_id)):
                                                                            $total_ww_st += $scr_scr_score; 
                                                                    ?>
                                                                            <span class="<?= ( ($scr_scr_absent == 'Y') ? 'text-danger' : '' )?> "> <?=  $scr_scr_score ?> </span>
                                                                        <?php endif; ?>
                                                                    <?php endforeach;?>
                                                                
                                                            <?php else: ?>
                                                                <span class="text-danger"> NS </span>
                                                            <?php endif;?>
                                                        </td>
                                                        <?php endforeach;  ?>

                                                        <td class="text-center  text-info td total" ><?=$total_ww_st ?></td>
                                                        <td class="text-center  ps td">
                                                            <?php 
                                                                if($total_ww_st > 0){
                                                                    $percentage_score = intval($total_ww_st) / intval($total_ww) * 100; 
                                                                }else{
                                                                    echo $percentage_score = 0;
                                                                }
                                                                echo number_format(round($percentage_score,3),2);
                                                            ?> 
                                                        </td>

                                                        <td class="text-center  td ws" >
                                                            <?php 
                                                                if($total_ww_st > 0){
                                                                    $weighted_score_ww = $percentage_score * (intval($ca_ww_percentage) / 100 );
                                                                }else{
                                                                    echo $weighted_score_ww = 0;
                                                                }
                                                                echo number_format(round($weighted_score_ww,3),2);
                                                            ?> 
                                                        </td>
                                                        <!-- END WRITTEN WORKS -->

                                                        <?php 
                                                        foreach ($score_hdr_pt->result() as $k):  
                                                            $scr_id = $k->scr_id;
                                                        ?>
                                                        <td class="text-center vmiddle td">
                                                            <?php if($score->num_rows() > 0 ): ?>
                                                                    <?php foreach($score->result() as $scr): 
                                                                        $scr_scr_id     = $scr->scr_id;
                                                                        $scr_stud_id    = $scr->stud_id;
                                                                        $scr_scr_score  = $scr->sscr_score;
                                                                        $scr_scr_absent = $scr->sscr_absent;

                                                                        if(($scr_id == $scr_scr_id) && ($stud_id == $scr_stud_id)):

                                                                            $total_pt_st += $scr_scr_score; 
                                                                    ?>
                                                                            <span class="<?= ($scr_scr_absent == 'Y' ? 'text-danger' : '' )?> "> <?= $scr_scr_score?> </span>

                                                                        <?php endif; ?>
                
                                                                    <?php endforeach;?>
                                                                
                                                            <?php else: ?>
                                                                <span class="text-danger"> NS </span>
                                                            <?php endif;?>
                                                        </td>
                                                        <?php endforeach;  ?>

                                                        <td class="text-center  text-info td total" ><?=$total_pt_st ?></td>
                                                        <td class="text-center  ps td">
                                                            <?php 
                                                                if($total_pt_st > 0){
                                                                    $percentage_score = intval($total_pt_st) / intval($total_pt) * 100; 
                                                                }else{
                                                                    echo $percentage_score = 0;
                                                                }
                                                                echo number_format(round($percentage_score,3),2);
                                                            ?> 
                                                        </td>

                                                        <td class="text-center bold td ws" >
                                                            <?php 
                                                                if($total_pt_st > 0){
                                                                    $weighted_score_pt = $percentage_score * (intval($ca_pt_percentage) / 100 );
                                                                }else{
                                                                    echo $weighted_score_pt = 0;
                                                                }
                                                                echo number_format(round($weighted_score_pt,3),2);
                                                            ?> 
                                                        </td>
                                                        <!-- END PERFORMANCE TASK -->

                                                        <?php 
                                                        foreach ($score_hdr_qa->result() as $k):  
                                                            $scr_id = $k->scr_id;
                                                        ?>
                                                        <td class="text-center vmiddle td">
                                                            <?php if($score->num_rows() > 0 ): ?>
                                                                    <?php foreach($score->result() as $scr): 
                                                                        $scr_scr_id     = $scr->scr_id;
                                                                        $scr_stud_id    = $scr->stud_id;
                                                                        $scr_scr_score  = $scr->sscr_score;
                                                                        $scr_scr_absent = $scr->sscr_absent;

                                                                        if(($scr_id == $scr_scr_id) && ($stud_id == $scr_stud_id)):

                                                                            $total_qa_st += $scr_scr_score; 
                                                                    ?>
                                                                            <span class="<?= ($scr_scr_absent == 'Y' ? 'text-danger' : '' )?> "> <?= $scr_scr_score?> </span>

                                                                        <?php endif; ?>
                
                                                                    <?php endforeach;?>
                                                                
                                                            <?php else: ?>
                                                                <span class="text-danger"> NS </span>
                                                            <?php endif;?>
                                                        </td>
                                                        <?php endforeach;  ?>

                                                        <td class="text-center  text-info vmiddle td total" ><?=$total_qa_st ?></td>
                                                        <td class="text-center  ps vmiddle td">
                                                            <?php 
                                                                if($total_qa_st > 0){
                                                                    $percentage_score = intval($total_qa_st) / intval($total_qa) * 100; 
                                                                }else{
                                                                    echo $percentage_score = 0;
                                                                }
                                                                echo number_format(round($percentage_score,3),2);
                                                            ?> 
                                                        </td>

                                                        <td class="text-center  vmiddle td ws" >
                                                            <?php 
                                                                if($total_qa_st > 0){
                                                                    $weighted_score_qa = $percentage_score * (intval($ca_qa_percentage) / 100 );
                                                                }else{
                                                                    echo $weighted_score_qa = 0;
                                                                }
                                                                echo number_format(round($weighted_score_qa,3),2);
                                                            ?> 
                                                        </td>
                                                        <!-- END QUARTERLY ASSESSMENT -->

                                                        <td class="text-center vmiddle td">
                                                            <h5 class=" m-0  initial-grade">
                                                                <?php 
                                                                    $sum            = round($weighted_score_ww,3)  + round($weighted_score_pt,3) + round($weighted_score_qa,3);
                                                                    echo $initial_grade  =  number_format($sum,3);
                                                                ?>  
                                                            </h5> 
                                                        </td>

                                                        <td class="text-center  td-danger vmiddle td quarterly">
                                                            <h5 class="bold m-0 text-white">
                                                                <?php 
                                                                    $quarter_grade = $this->module->gen_quarterly_grade($initial_grade);
                                                                    echo  $quarter_grade;
                                                                ?> 
                                                            </h5> 
                                                                
                                                                <input type="hidden" name="qtr_grade<?=$cnt?>[stud_id]" value="<?= $stud_id ?>">
                                                                <input type="hidden" name="qtr_grade<?=$cnt?>[initial_grade]" value="<?= $initial_grade ?>">
                                                                <input type="hidden" name="qtr_grade<?=$cnt?>[quarterly_grade]" value="<?= $quarter_grade ?>">
                                                        </td>
                                                </tr>
                                                <?php 
                                                $cnt++;
                                                endforeach;  ?> <!-- end of student male -->


                                                 <!-- FEMALE -->

                                                <?php 
                                                $cnt = $cnt;
                                                foreach($student_female->result() as $r): 
                                                    $total_ww_st = 0;
                                                    $total_pt_st = 0;
                                                    $total_qa_st = 0;
                                                    $stud_id     =  $r->stud_id;

                                                    $score = $this->module->get_query(" SELECT * FROM v_student_score WHERE sy_id = ".$sy_id." AND `stud_gender` = 'Female'  AND `stud_id` = ".$stud_id." AND scr_quarter ='".$qtr_code."' AND subj_id = ".$subj_id." ");
                                                ?>
                                                <tr class="me">
                                                   <td class="text-center vmiddle td girls" ><?=$cnt++?></td>
                                                   <td class="vmiddle td">
                                                        <h5 class="m-0">
                                                           <strong ><?=$r->stud_lastname.'</strong>, '.$r->stud_firstname.' '.substr($r->stud_middlename,0, 1) ?><?= !empty($r->stud_middlename)?'.':''?>
                                                        </h5>
                                                    </td>

                                                        <?php 
                                                        foreach ($score_hdr_ww->result() as $k):  
                                                            $scr_id = $k->scr_id;
                                                        ?>
                                                        <td class="text-center vmiddle td">
                                                            <?php if($score->num_rows() > 0 ): ?>
                                                                    <?php foreach($score->result() as $scr): 
                                                                        $scr_scr_id     = $scr->scr_id;
                                                                        $scr_stud_id    = $scr->stud_id;
                                                                        $scr_scr_score  = $scr->sscr_score;
                                                                        $scr_scr_absent = $scr->sscr_absent;

                                                                        if(($scr_id == $scr_scr_id) && ($stud_id == $scr_stud_id)):

                                                                            $total_ww_st += $scr_scr_score; 
                                                                    ?>
                                                                            <span class="<?= ($scr_scr_absent == 'Y' ? 'text-danger' : '' )?> "> <?= $scr_scr_score?> </span>

                                                                        <?php endif; ?>
                
                                                                    <?php endforeach;?>
                                                                
                                                            <?php else: ?>
                                                                <span class="text-danger"> NS </span>
                                                            <?php endif;?>
                                                        </td>
                                                        <?php endforeach;  ?>

                                                        <td class="text-center  text-info td total" ><?=$total_ww_st ?></td>
                                                        <td class="text-center  ps td">
                                                            <?php 
                                                                if($total_ww_st > 0){
                                                                    $percentage_score = intval($total_ww_st) / intval($total_ww) * 100; 
                                                                }else{
                                                                    echo $percentage_score = 0;
                                                                }
                                                                echo number_format(round($percentage_score,3),2);
                                                            ?> 
                                                        </td>

                                                        <td class="text-center  td ws" >
                                                            <?php 
                                                                if($total_ww_st > 0){
                                                                    $weighted_score_ww = $percentage_score * (intval($ca_ww_percentage) / 100 );
                                                                }else{
                                                                    echo $weighted_score_ww = 0;
                                                                }
                                                                echo number_format(round($weighted_score_ww,3),2);
                                                            ?> 
                                                        </td>
                                                        <!-- END WRITTEN WORKS -->

                                                        <?php 
                                                        foreach ($score_hdr_pt->result() as $k):  
                                                            $scr_id = $k->scr_id;
                                                        ?>
                                                        <td class="text-center vmiddle td">
                                                            <?php if($score->num_rows() > 0 ): ?>
                                                                    <?php foreach($score->result() as $scr): 
                                                                        $scr_scr_id     = $scr->scr_id;
                                                                        $scr_stud_id    = $scr->stud_id;
                                                                        $scr_scr_score  = $scr->sscr_score;
                                                                        $scr_scr_absent = $scr->sscr_absent;

                                                                        if(($scr_id == $scr_scr_id) && ($stud_id == $scr_stud_id)):

                                                                            $total_pt_st += $scr_scr_score; 
                                                                    ?>
                                                                            <span class="<?= ($scr_scr_absent == 'Y' ? 'text-danger' : '' )?> "> <?= $scr_scr_score?> </span>

                                                                        <?php endif; ?>
                
                                                                    <?php endforeach;?>
                                                                
                                                            <?php else: ?>
                                                                <span class="text-danger"> NS </span>
                                                            <?php endif;?>
                                                        </td>
                                                        <?php endforeach;  ?>

                                                        <td class="text-center  text-info td total" ><?=$total_pt_st ?></td>
                                                        <td class="text-center  ps td">
                                                            <?php 
                                                                if($total_pt_st > 0){
                                                                    $percentage_score = intval($total_pt_st) / intval($total_pt) * 100; 
                                                                }else{
                                                                    echo $percentage_score = 0;
                                                                }
                                                                echo number_format(round($percentage_score,3),2);
                                                            ?> 
                                                        </td>

                                                        <td class="text-center  td ws" >
                                                            <?php 
                                                                if($total_pt_st > 0){
                                                                    $weighted_score_pt = $percentage_score * (intval($ca_pt_percentage) / 100 );
                                                                }else{
                                                                    echo $weighted_score_pt = 0;
                                                                }
                                                                echo number_format(round($weighted_score_pt,3),2);
                                                            ?> 
                                                        </td>
                                                        <!-- END PERFORMANCE TASK -->

                                                        <?php 
                                                        foreach ($score_hdr_qa->result() as $k):  
                                                            $scr_id = $k->scr_id;
                                                        ?>
                                                        <td class="text-center vmiddle td">
                                                            <?php if($score->num_rows() > 0 ): ?>
                                                                    <?php foreach($score->result() as $scr): 
                                                                        $scr_scr_id     = $scr->scr_id;
                                                                        $scr_stud_id    = $scr->stud_id;
                                                                        $scr_scr_score  = $scr->sscr_score;
                                                                        $scr_scr_absent = $scr->sscr_absent;

                                                                        if(($scr_id == $scr_scr_id) && ($stud_id == $scr_stud_id)):

                                                                            $total_qa_st += $scr_scr_score; 
                                                                    ?>
                                                                            <span class="<?= ($scr_scr_absent == 'Y' ? 'text-danger' : '' )?> "> <?= $scr_scr_score?> </span>

                                                                        <?php endif; ?>
                
                                                                    <?php endforeach;?>
                                                                
                                                            <?php else: ?>
                                                                <span class="text-danger"> NS </span>
                                                            <?php endif;?>
                                                        </td>
                                                        <?php endforeach;  ?>

                                                        <td class="text-center  text-info vmiddle td total" ><?=$total_qa_st ?></td>
                                                        <td class="text-center  ps vmiddle td">
                                                            <?php 
                                                                if($total_qa_st > 0){
                                                                    $percentage_score = intval($total_qa_st) / intval($total_qa) * 100; 
                                                                }else{
                                                                    echo $percentage_score = 0;
                                                                }
                                                                echo number_format(round($percentage_score,3),2);
                                                            ?> 
                                                        </td>

                                                        <td class="text-center  vmiddle td ws" >
                                                            <?php 
                                                                if($total_qa_st > 0){
                                                                    $weighted_score_qa = $percentage_score * (intval($ca_qa_percentage) / 100 );
                                                                }else{
                                                                    echo $weighted_score_qa = 0;
                                                                }
                                                                echo number_format(round($weighted_score_qa,3),2);
                                                            ?> 
                                                        </td>
                                                        <!-- END QUARTERLY ASSESSMENT -->

                                                        <td class="text-center vmiddle td initial-grade ">
                                                            <h5 class=" m-0  initial-grade">
                                                                <?php 
                                                                    $sum            = round($weighted_score_ww,3)  + round($weighted_score_pt,3) + round($weighted_score_qa,3);
                                                                    echo $initial_grade  =  number_format($sum,3);
                                                                    //echo number_format($initial_grade,3); 
                                                                ?>   
                                                            </h5> 
                                                        </td>

                                                        <td class="text-center  td-danger vmiddle td quarterly">
                                                            <h5 class=" m-0 text-white">
                                                                <?php 
                                                                    $quarter_grade = $this->module->gen_quarterly_grade($initial_grade);
                                                                    echo  $quarter_grade;
                                                                ?> 
                                                                    
                                                            </h5> 
                                                               
                                                                <input type="hidden" name="qtr_grade<?=$cnt?>[stud_id]" value="<?= $stud_id ?>">
                                                                <input type="hidden" name="qtr_grade<?=$cnt?>[initial_grade]" value="<?= $initial_grade ?>">
                                                                <input type="hidden" name="qtr_grade<?=$cnt?>[quarterly_grade]" value="<?= $quarter_grade ?>"> 
                                                        </td>
                                                </tr>
                                                <?php endforeach;  ?> <!-- end of student female -->

                                        </tbody>
                                    </table>

                                </div>
                                
                                
                            </div>

                            <br/>
                                  <div class="text-right">
                                     <button class="btn btn-success" id="submit" type="submit">Submit Final Grade</button>
                                 </div>

                                <br/>
                             <div class="row">
                                <div class="col-md-12 msg"></div>
                            </div>

                        </form>

                    </div>
                </div>
            </div>
         
        </div>
    </div>

    
</div> <!-- end of body container -->


<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    $('#frmSubmit').crud();

   /* function submitGrade(){
        $('#frmSubmit').crud();
    }

    $('.submit_grade').click(function(e){
        e.preventDefault();

        if (confirm('Are you sure you want to submit your grades?')) {
           submitGrade();
        }
    });*/
    
        
        /* $('.me').click(function(){
            var me = $(this);
            $('tr').css('background-color','#fff');
            me.css('background-color','#ddd');
            //me.('td').css('background-color','#00a651')
        }); 
        */
       
        

        /*$("#data").delegate('.td','mouseover mouseleave', function(e) {
            if (e.type == 'mouseover') {
              $(this).parent().addClass("highlights");
              //$("colgroup").eq($(this).index()).addClass("highlights");
            }
            else {
              $(this).parent().removeClass("highlights");
             // $("colgroup").eq($(this).index()).removeClass("highlights");
            }
        });*/

        // whatever kind of mobile test you wanna do.
        // CSS Newbie article here:
        // http://www.cssnewbie.com/simple-table-column-highlighting/
        // 
        $("#data tr.me").click(function() {
            var selected = $(this).hasClass("highlights");
            $("#data tr").removeClass("highlights");
            $("#data td.quarterly").removeClass('td-red').addClass('td-danger');
            var tr = $(this).closest('tr');
            if(!selected)
                    $(this).addClass("highlights");
                    
                    tr.find('.quarterly').removeClass('td-danger').addClass('td-red');
                    tr.find('.ws, .ps').removeClass('td-danger').removeClass('td-red');
            /*else
            		tr.find('.ws, .ps').removeClass('td-danger').removeClass('td-red');*/
        });

        $('td').hover(function() {
         $(this).parents('table').find('col:eq('+$(this).index()+')').toggleClass('hover');
        });
       
        $(document.body).on("click",".delete",function(e){
            e.preventDefault();
            var scr_id = $(this).data('id');

            if (confirm('Are you sure you want to delete this record?')) {
                $.ajax({url: base_url+'grading/delete_score/'+scr_id, success: function(result){
                    window.setTimeout(function(){location.reload()},1000);
                }});
            }
        });

        $('#quarter').click(function(){
            $('#submit').prop('disabled', true);
        });

  });
</script>
</body>
</html>