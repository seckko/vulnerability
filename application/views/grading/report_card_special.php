<!DOCTYPE html>
<html lang="en">
<?= $this->load->view('inc/css')?>
<link rel="stylesheet" href="<?php echo base_url()?>asset/css/print.css">
<link rel="stylesheet" href="<?php echo base_url()?>asset/css/css_card.css">
<body class="page-body" > <!-- onload="window.print()"   onload="window.print()" onafterprint="goback()" --> 

<div class="page-container horizontal-menu" >

	<div class="main-content"  style="padding-top:0">


		<?php foreach($students->result() as $r):
			$stud_id = $r->stud_id;
		?>

			
			<div class="row">
	        	 <div class="col-md-12 center" style="margin-top:0; width:300px">
					<img src="<?php echo base_url()?>asset/images/logo + complete name + formerly + address.jpg" alt="Logo" width="100%" class="m-0" /> 
				</div>
	        </div>


			<div class="row" >
				<div class="col-md-12">
			
			        <table >
						<thead>
							<tr>
								<th colspan="8" class="text-center vmiddle">
									<p class="m-0 text-white bold" style="font-size:10px"> GRADE SCHOOL REPORT CARD</p>
								</th>
							</tr>
							<tr>
								<th colspan="8" class="text-center vmiddle" style="background-color: #fff;">
									<p class="m-0" style="font-size:8px; color:#fff !important;" >School Year <?= $this->module->get_active_sy_name(); ?> </p>
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td style="width:15%" class="vmiddle">Name:</td>
								<td style="width:60%" class="vmiddle"> 
									<h4 class="bold m-0"> <?='<strong>'.$r->stud_lastname.'</strong>, '.$r->stud_firstname.' '.(empty($r->stud_middlename) ? '' : substr($r->stud_middlename,0, 1).'.')?> </h4>
								</td>
								<td style="width:5%" class="vmiddle">LRN:</td>
								<td style="width:30%" class="vmiddle">
									<p class="bold m-0" style="font-size: 10px"> <?=$r->stud_lrn?></p>
								</td>
							</tr>
			
							<tr>
								<td class="vmiddle">Grade & Section:</small></td>
								<td> 
									<p class="bold m-0" style="font-size: 10px"> <?=substr($r->lvl_name,-1).'-'.$r->sec_name?></p>
								</td >
								<td class="vmiddle">Age:</td>
								<td class="vmiddle">
									<p class="bold m-0" style="font-size: 10px"> <?=$this->module->get_age($r->stud_birthdate)?> years old</p>
								</td>
							</tr>
			
							<tr>
								<td class="vmiddle">Class Adviser:</small></td>
								<td class="vmiddle"> 
									<p class="bold m-0" style="font-size: 10px"> <?=$r->sec_teacher?></p>
								</td>
								<td class="vmiddle">Gender:</td>
								<td class="vmiddle">
									<p class="bold m-0" style="font-size: 10px"> <?=$r->stud_gender?></p>
								</td>
							</tr>
						</tbody>
			        </table>
			
			        <div class="row">
						<div class="col-md-12">
							<table>
								<thead>
									<th colspan="7" class=" vmiddle text-center">
										<p class="m-0 text-white bold" style="font-size:10px"> LEARNING PROGRESS AND ACHIEVEMENT</p>
									</th>
								</thead>
								<tbody>
									<tr>
										<td rowspan="2" class="vmiddle "><h5 class="bold">&nbsp;&nbsp; LEARNING AREAS</h5></td>
										<td colspan="4" class="vmiddle bold text-center"> <h5 class="m-0 bold">Quarter</h5></td>
										<td rowspan="2" class="text-center vmiddle bold width-10">Final Grade</td>
										<td rowspan="2" class="text-center vmiddle bold width-20">Remarks</td>
									</tr>
			
									<tr>
										<?php 
											foreach($quarters->result() as $q):
												$code = $q->qtr_code;

												switch ($code) {
													case '1Q':
														echo '<td class="text-center vmiddle bold width-5">1st</td>';
														break;
													case '2Q':
														echo '<td class="text-center vmiddle bold width-5">2nd</td>';
														break;
													case '3Q':
														echo '<td class="text-center vmiddle bold width-5">3rd</td>';
														break;
													case '4Q':
														echo '<td class="text-center vmiddle bold width-5">4th</td>';
														break;
													
													default:
														break;
												}

										?>
										<?php endforeach; ?>
									</tr>

									<?php 
                                        $subject  = $this->module->getTableSort('subject', 'sub_sort');

                                        	$gen_ave 		= 0;
                                        	$gen_ave_div 	= 0;

                                        	$ave_gen_ave = [];

                                            foreach ($subject->result() as $r):
                                                $sub_name   = $r->sub_name;
                                                $sub_id     = $r->sub_id;
                                            ?>
												<tr>
	                                               <td  style="font-size: 10px">
	                                                <?=$sub_name?> 
	                                               </td>

	                                                <?php 
	                                                	$fg 	= 0;
	                                                	$fg_div = 0;

	                                                	$fgquarter = 0;
	                                                	$ave_sub_grade = [];

	                                                	$final_ave = 0;

	                                                	foreach ($quarters->result() as $q) :
                                                        $qtr_code = $q->qtr_code;
                                                    	
                                                    	$sub_grade = 0;
                                                    	$cnt_qtr =	0;

                                                    	foreach($student_data as $g):
                                                            $gstud_id   = $g['stud_id'];
                                                            $gsubjects  = $g['subjects'];

                                                            if($gstud_id == $stud_id):
                                                                foreach($gsubjects as $h):
                                                                    $hsub_id    = $h['sub_id'];
                                                                    $hquarter   = $h['quarter'];

                                                                    if($hsub_id == $sub_id):

                                                                        foreach($hquarter as $qr):
                                                                            $qrqtr_code = $qr['qtr_code'];
                                                                            $qrfinal_grade = $qr['final_grade'];

                                                                            if(!empty($qrfinal_grade)){
                                                                            	$cnt_qtr ++;
                                                                            }
                                                                            
                                                                            
                                                                            if( $qrqtr_code == $qtr_code):
                                                                            	$sub_grade = $qrfinal_grade;

                                                                            	//if($cnt_qtr > 1){
                                                                            		if($hsub_id <> 25){
                                                                            			array_push($ave_sub_grade, $qrfinal_grade);
                                                                            		}
                                                                            		
                                                                            	//}
                                                                            	

                                                                            	//$ave_sub_grade = $sub_grade;

                                                                            	/*if($qtr_code <> '1Q'){
                                                                            		$sub_grade_s = $qrfinal_grade;
                                                                            	}*/
                                                                            ?>
                                                                            <?php endif; ?>

                                                                       <?php endforeach; ?>
                                                                    <?php endif; ?>

                                                               <?php endforeach; ?>

                                                            <?php endif; ?>

                                                        <?php endforeach; ?>
                                                    <td class="text-center  vmiddle" >
                                                        <p class="m-0 bold" style="font-size:10px">
                                                        	<?php 
                                                        		
                                                        			if($sub_grade == 0){
                                                        				echo '--';
                                                        			}else{
                                                        				if($sub_id <> 25){
                                                        					echo $sub_grade;
                                                        				}else{
                                                        					echo '--';
                                                        				}
                                                        			}
                                                        		
                                                        	?>
                                                        	<!-- <?=$sub_grade == 0 ? '--' : $sub_grade ?> -->
                                                   		</p>
                                                    </td>

                                                    <?php endforeach; ?> <!-- end quarter -->

                                                    <td class="text-center  vmiddle" >
                                                    	<p class="m-0 bold" style="font-size:10px">
															<?php 
															//print_r($ave_sub_grade);

															if(!empty($ave_sub_grade)){
																$a 		 = array_filter($ave_sub_grade);
																$average = array_sum($a) / count($a);
																$final_ave = round($average);

																echo $final_ave;

																array_push($ave_gen_ave, $final_ave);
															}else{
																echo '---';
															}

															
																/*echo $sub_grade .' - '.$fg_div. '=';

																$fgrade = round($fg / $fg_div);

																if($fgquarter == 3){
																//
																	if($fgrade <= 0){
																		echo '--';
																	}else{
																		echo $fgrade;

																		$gen_ave += $fgrade;
																		$gen_ave_div ++;
																	}
																}*/

															?>
                                                    	</p>
                                                    	<!-- FINAL GRADE -->

                                                    </td>
													 <td class="text-center  vmiddle" >
                                                    	<p class="m-0 " style="font-size:10px">
														<?php 

															if( ($final_ave == 0) || empty($final_ave) ){
																echo '---';
															}else{
																if($final_ave < 75){
																	echo '<span style="color: #ee4749">Failed</span>';
																}else {
																	echo 'Passed';
																}
															}

															

														?>
														</p>
														<!-- REMARKS -->
													</td>

	                                           	</tr>

	                                           	<?php 
			                                        $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));                                                        
			                                        foreach($subject_detail->result() as $s):
			                                            $subj_det_name = $s->subj_det_name;
			                                             $subj_det_id    =  $s->subj_det_id;

			                                            if( strtolower($sub_name) <> 'english'):
			                                    ?>
														<tr>
					                                        <td  style="font-size: 10px">
					                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <?=$subj_det_name?>
					                                        </td>
																
															<?php 
																$fg_det = 0;

																$fgquarter_det = 0;

																$ave_sub_grade_s = [];
																

																foreach ($quarters->result() as $q) :
                                                                    $qtr_code = $q->qtr_code;
                                                                ?>
                                                                
	                                                                <?php 
	                                                                $sub_det_grade = 0;
	                                                                

	                                                                //$cnt_qtr_s = 0;

	                                                                foreach($student_data as $g):
	                                                                    $gstud_id   = $g['stud_id'];
	                                                                    $gsubjects  = $g['subjects'];

	                                                                    if($gstud_id == $stud_id):
	                                                                        foreach($gsubjects as $h):
	                                                                            $hsub_id    = $h['sub_id'];
	                                                                            $hquarter   = $h['quarter'];

	                                                                            if($hsub_id == $sub_id):

	                                                                                foreach($hquarter as $qr):
	                                                                                    $qrqtr_code = $qr['qtr_code'];
	                                                                                    $qrfinal_grade = $qr['final_grade'];
	                                                                                    $qrquarterly_grade = $qr['quarterly_grade']; 

	                                                                                    /*if(!empty($qrquarterly_grade)){
					                                                                            	$cnt_qtr_s ++;
					                                                                            }*/

	                                                                                    if( $qrqtr_code == $qtr_code):

	                                                                                        foreach($qrquarterly_grade as $qg):
	                                                                                            $qgsub_id       = $qg['sub_id'];
	                                                                                            $qgsubj_det_id  = $qg['subj_det_id'];
	                                                                                            $qggrade        = $qg['grade'];

	                                                                                            if($qgsubj_det_id == $subj_det_id):

	                                                                                            	$sub_det_grade = $qggrade;

	                                                                                            	//if($cnt_qtr_s > 1){
					                                                                            		array_push($ave_sub_grade_s, $qggrade);
					                                                                            	//}
	                                                                                    ?>

	                                                                                         <?php endif; ?>
	                                                                                         <?php endforeach; ?>
	                                                                                    <?php endif; ?>

	                                                                               <?php endforeach; ?>

	                                                                            <?php endif; ?>

	                                                                       <?php endforeach; ?>

	                                                                    <?php endif; ?>
	                                                                    
	                                                                <?php endforeach; ?>
																	
																	<td class="text-center  vmiddle" >
	                                                                	<p class="m-0 bold" style="font-size:10px">
																			<?=$sub_det_grade == 0 ? '--' : $sub_det_grade ?>
	                                                                	</p>
                                                                	</td>
	                                                                               
	                                                                <?php endforeach; ?>
		                                                            

                                                                <td class="text-center  vmiddle" >
			                                                    	<p class="m-0 bold" style="font-size:10px">
																		<?php 
																			//print_r($ave_sub_grade_s);
																			//echo '<br/>';
																			if(!empty($ave_sub_grade_s)){
																				$a 		 = array_filter($ave_sub_grade_s);
																				$average = array_sum($a) / count($a);
																				$final_ave = round($average);

																				echo $final_ave;
																			}else{
																				echo '---';
																			}

																		?>
			                                                    	</p>
			                                                    	<!-- FINAL GRADE -->

			                                                    </td>
																 <td class="text-center  vmiddle" >
			                                                    	<p class="m-0 " style="font-size:10px">
																	<?php 

																		if($fgquarter == 4){

																			if( ($fgrade_det != 0)  )
																			{
																				if($fgrade_det < 75){
																					echo '<span style="color: #ee4749">Failed</span>';
																				}else{
																					echo 'Passed';
																				}
																			}else{
																				echo  '--';

																			}
																		}
																	?>
																	</p>
																	<!-- REMARKS -->
																</td>

					                                    </tr>
					                                    <?php endif; ?>

			                                    <?php endforeach; ?>

                                    <?php endforeach; ?>



			
									<tr>
										<td colspan="5"><h5 class="bold m-0" >GENERAL AVERAGE</h5></td>

										<?php 
											//print_r($ave_gen_ave);

											$a 		 = array_filter($ave_gen_ave);
											$average = array_sum($a) / count($a);
											$gen_ave = round($average);

										?>


										<td class="text-center bold">
											<h4 class="m-0 bold">
											<?php 
												echo $gen_ave;
											?>
											</h4>
										</td>
										<td class="text-center  vmiddle" >
	                                    	<p class="m-0 " style="font-size:10px">
											<?php 

											//if($fgquarter == 4){
												if($gen_ave < 75){
													echo '<span style="color: #ee4749">Failed</span>';
												}else{
													echo 'Passed';
												}
											//}

											/*if($fgquarter == 3){
												if( ($fgrade != 0) || (!empty($fgrade)) )
												{
													if($fgrade < 75){
														echo '<span style="color: #ee4749">Failed</span>';
													}else{
														echo 'Passed';
													}
												}else{
													echo '--';	
												}
											}*/
											?>
											</p>
											<!-- REMARKS -->
										</td>
									</tr>


								</tbody>
							</table>

							

							<table>
								<thead>
									<th colspan="6" class="text-center vmiddle ">
										<p class="m-0 text-white bold" style="font-size:10px">LEARNER'S OBSERVED VALUES</p>
									</th>
								</thead>
								<tbody>
									<tr>
										<td rowspan="2" class="vmiddle text-center m-0 p-0" style="width:20%"><span class="bold m-0 "  style="font-size: 9px; ">Core Values</span></td>
										<td rowspan="2" class="vmiddle text-center m-0 p-0"><span class="bold m-0 "  style="font-size: 9px;  ">Behavior Statements</span></td>
										<td colspan="4" class="text-center m-0 p-0"><span class="bold m-0"  style="font-size: 9px; color: #373e4a;">Quarter</span></td>
									</tr>
									<tr>
										<td class="text-center vmiddle bold width-5 m-0">1st</td>
										<td class="text-center vmiddle bold width-5 m-0">2nd</td>
										<td class="text-center vmiddle bold width-5 m-0">3rd</td>
										<td class="text-center vmiddle bold width-5 m-0">4th</td>
									</tr>

									<?php  
									    $cnts = 1;
									    foreach($core->result() as $r): 
									    $cv_id = $r->cv_id;
									  ?>
									  <tr>
									    <td rowspan="<?=$r->cnt?>" class="vmiddle bold"><?=$r->cv_core_value?></td> 

									    <?php 

									      foreach($values->result() as $s): 

									      $bs_id  = $s->bs_id;
									      $scv_id = $s->cv_id;
									      
									      if($cv_id == $scv_id):

									    ?>
									        <td class="vmiddle"><?=$s->bs_description?></td>

									        <?php 
									          
									          foreach($quarters->result() as $q):
									            $qtr_code = $q->qtr_code;
									        ?>
									        <td class="width-5 text-center bold">

									          <?php 

									            $new_bs_id    = '';
									            $new_qtr_code = '';
									            $grade        = '';

									            if($behavior->num_rows() > 0){
									            	foreach($behavior->result() as $b){
									            		$bbs_id     = $b->bs_id;
									                    $bqtr_code  = $b->qtr_code;
									                    $bstud_id 	= $b->stud_id;


									                    if( ($bqtr_code == $qtr_code) && ($bbs_id == $bs_id) ){
									                    	echo $b->sv_value;
									                    }
									            	}
									            }


									            /*if(!empty($behavior)){
									                if($behavior->num_rows() < 1){
									                  $new_bs_id    = $bs_id;
									                  $new_qtr_code = $qtr_code;
									                  $grade        = $grade;
									                }else{

									                  foreach($behavior->result() as $b){
									                    $bbs_id     = $b->bs_id;
									                    $bqtr_code  = $b->qtr_code;
									                    $bstud_id 	= $b->stud_id;

									                    if( ($bbs_id == $bs_id) && ($bqtr_code == $qtr_code) && ($stud_id == $bstud_id) ){
									                      $new_bs_id    = $b->bs_id;
									                      $new_qtr_code = $b->qtr_code;
									                      $grade        = $b->sv_value;
									                    }

									                  }
									                }
									            }*/

									          ?>
												
												<!-- <?=empty($grade) ? '--' : $grade ?> -->

									        </td>
									        <?php endforeach; ?>
									    </tr>
									    <?php endif; 
									      endforeach; 

									    ?>

									<?php endforeach;?>
								</tbody>
							</table>
							<div class="col-md-12 text-center">
								<span style="color:#373e4a; font-size:5.2pt;">AO- Always Observed (95-100) &nbsp;&nbsp; SO- Sometimes Observed (85-94) &nbsp;&nbsp; RO- Rarely Observed (75-84) &nbsp;&nbsp; NO- Not Observed (Below 74)</span>
							</div>

							<table>
								<thead>
									<th class="text-center vmiddle">
										<h5 class="m-0 text-white bold">ATTENDANCE</h5>
									</th>
									<th class="text-center vmiddle"> Jun</th>
									<th class="text-center vmiddle"> Jul</th>
									<th class="text-center vmiddle"> Aug</th>
									<th class="text-center vmiddle"> Sep</th>
									<th class="text-center vmiddle"> Oct</th>
									<th class="text-center vmiddle"> Nov</th>
									<th class="text-center vmiddle"> Dec</th>
									<th class="text-center vmiddle"> Jan</th>
									<th class="text-center vmiddle"> Feb</th>
									<th class="text-center vmiddle"> Mar</th>
									<th class="text-center vmiddle"> Total</th>
								</thead>
								<tbody>
									<tr>
										<td><h5 class="m-0">No. of School Days</h5></td>
										<?php 
											$total = 0;
											foreach($attendance->result() as $a):
												$month 	= $a->athdr_month;
												$days 	= $a->athdr_total_days;
												$total += $days;

										?>	

										<td class="text-center vmiddle width-5"> 
											<h5 class="bold m-0">
												<?php 
													switch ($month) {
														case 'June':
															echo $days;
															break;
														case 'July':
															echo $days;
															break;
														case 'August':
															echo $days;
															break;
														case 'September':
															echo $days;
															break;
														case 'October':
															echo $days;
															break;
														case 'November':
															echo $days;
															break;
														case 'December':
															echo $days;
															break;
														case 'January':
															echo $days;
															break;
														case 'February':
															echo $days;
															break;
														case 'March':
															echo $days.'<br/> (16 days suspension of classes)';
															break;
														
														default:
															echo '--';
															break;
													}
												?>
											</h5>
										</td>

										<?php endforeach; ?>

										<td class="text-center vmiddle width-5"> <h5 class="bold m-0"><?=$total?> </h5></td>

									
									</tr>
			
									<tr>
										<td><h5 class="m-0">No. of Days Present</h5></td>
										
										<?php 
											$total_present = 0; 
											foreach($attendance->result() as $a):
												$month 	= $a->athdr_month;
												$days 	= $a->athdr_total_days;

										?>	

										<td class="text-center vmiddle"> 
											<h5 class="bold m-0">
												
												<?php 
													
													foreach($attendance_detail->result() as $p){
														$att_month 		= $p->att_month;
														$att_present 	= $p->att_present;
														$pstud_id 		= $p->stud_id;
														$psec_id 		= $p->sec_id;

														if( ($stud_id  == $pstud_id) && ($att_month == $month)  ){
															echo $att_present;
															$total_present += $att_present;
														}
													}
														
												?>

											</h5>
										</td>

										<?php endforeach;  ?>

										<td class="text-center vmiddle"> <h5 class="bold m-0"><?=$total_present?> </h5></td>

									</tr>
			
									<tr>
										<td><h5 class="m-0">No. of Days Absent</h5></td>
										<?php 
											$total_absent = 0; 
											foreach($attendance->result() as $a):
												$month 	= $a->athdr_month;
												$days 	= $a->athdr_total_days;

										?>	

										<td class="text-center vmiddle"> 
											<h5 class="bold m-0">
												
												<?php 
													
													foreach($attendance_detail->result() as $p){
														$att_month 		= $p->att_month;
														$att_absent 	= $p->att_absent;
														$pstud_id 		= $p->stud_id;
														$psec_id 		= $p->sec_id;

														if( ($stud_id  == $pstud_id) && ($att_month == $month)  ){
															echo $att_absent;
															$total_absent += $att_absent;
														}
													}
														
												?>

											</h5>
										</td>

										<?php endforeach;  ?>

										<td class="text-center vmiddle"> <h5 class="bold m-0"><?=$total_absent?> </h5></td>
									</tr>
								</tbody>
							</table>

							<table>
								<thead>
									<th class="text-center vmiddle" colspan="2">
										<p class="m-0 text-white bold" style="font-size:10px">CERTIFICATE OF TRANSFER</p>
									</th>
								</thead>
								<tbody>
									<tr>
										<td > 
											Eligible for transfer and admission to
											<br/>
											Retained in <br/>
											Date<br/>

											<h5 class="text-center m-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
											Arcelita J. Gaspar, Ph.D.<br/>
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
												<small><em> School Principal</em></small>
											</h5>
										</td>

										<td > 
											<strong>Cancellation of Eligibility to Transfer</strong>
											<br/>
											Admitted to <br/>
											Date<br/>

											<h5 class="text-center m-0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
											<br/>
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
											 <small><em>  School Principal</em></small></h5>
										</td>
									</tr>
								</tbody>
							</table>

						</div>
					</div>
				</div>
			</div> 
		
		<?php endforeach; ?>



			<p style="page-break-before: always;"></p>

			

	</div>

</div>
<script type="text/javascript">
	var base_url = "<?php echo base_url(); ?>"; 

 function goback(){
	 window.location.href = base_url+'admin';
 	//window.location.replace(base_url);
 }
</script>
</body>
</html>