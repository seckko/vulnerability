<?php 

    
  $usr_name       = $this->session->userdata('usr_name');
  $usr_type       = $this->session->userdata('usr_type');
  $usr_firstname  = $this->session->userdata('usr_firstname');
  $usr_lastname   = $this->session->userdata('usr_lastname');
  $usr_is_login   = $this->session->userdata('usr_is_login');
  $tch_id         = $this->session->userdata('tch_id');
  $sy_id          = $this->module->get_active_sy();

  $where           = 'tch_id = "'.$tch_id.'"  AND sy_id = "'.$sy_id.'" ';

  if( ($usr_type <> 'Faculty') || empty($tch_id) ){
    header('Location: '.base_url());
  }

?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title><?= $title;?></title>

    <?= $this->load->view('inc/css')?>

</head>
<body class="page-body gray">

<div class="page-container  horizontal-menu sidebar-collapsed"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    <header class="navbar navbar-fixed-top"><!-- set fixed position by adding class "navbar-fixed-top" -->
        
        <div class="navbar-inner">
            <?=$this->load->view('inc/topbar');?>
        </div>
    </header>


     <?php 
            $subj_id        = ''; 
            $lvl_id         = '';  
            $sec_id         = '';  
            $tch_id         = '';  
            $sy_id          = ''; 
            $sub_id         = '';  
            $subj_det_id    = '';  
            $lvl_name       = ''; 
            $lvl_color      = '';      
            $sec_name       = '';   
            $dept_name      = '';          
            $sub_name       = '';

            $sec_id            = $this->uri->segment(3);
            $sy_id             = $this->module->get_active_sy();

            $subj_assignment = $this->module->table_where('v_subject_teacher_assignment', array('sec_id' => $sec_id, 'sy_id' => $sy_id)); 

            foreach ($subj_assignment->result() as $r) {
                $subj_id        = $r->subj_id ; 
                $lvl_id         = $r->lvl_id ;   
                $tch_id         = $r->tch_id ;  
                $sy_id          = $r->sy_id ; 
                $sub_id         = $r->sub_id ;  
                $subj_det_id    = $r->subj_det_id ;  
                $lvl_name       = $r->lvl_name ; 
                $lvl_color      = $r->lvl_color ;      
                $sec_name       = $r->sec_name ;   
                $dept_name      = $r->dept_name ;  
            }  

              $student = $this->module->get_query("SELECT * FROM v_student_section_class_list WHERE  sy_id = ".$sy_id." AND sec_id = ".$sec_id." ORDER BY stud_lastname, stud_firstname");
              $count  = intval($student->num_rows());


        ?>

    <div class="main-content">
        <div class="row">
         <div class="col-md-12">
            <div class="panel panel-primary panel-shadow">
              <div class="panel-heading p-20" >
                  <div class="row">
                    <div class="col-md-8 col-sm-6 col-xs-6">
                        <h2 class="m-0">Learners Observed Values </h2>
                        <h4 class="m-0"> <small>School Year</small>  <?=$this->module->get_active_sy_name()?> </h4>
                        
                    </div>

                    <div class="col-md-4 col-sm-6 col-xs-6 text-right">
                      <h2 class="m-0 "> <strong><?= $lvl_name .' - '.$sec_name?></strong> </h2>
                      <h4 class="m-0"><?= $dept_name?> Department</h4>
                      
                    </div>
                </div> 
              </div>

              <div class="panel-body">

                

                  <div class="form-class">
                    <a href="<?=base_url()?>grading/add_values/<?=$sec_id?>" class="btn btn-success" type="button"> <i class="fa fa-plus"></i> Create record </a>
                  </div><br/>

                  <div class="table-wrapper">
                    <div class="table-scroll">
                      <table class="table-custom table-bordered" id="data">
                          <thead>
                              <tr>
                                <th class="text-center"> No. </th>
                                <th> &nbsp;&nbsp; Learner's name</th>
                                <th class="text-center" colspan="4"> Status</th>
                              </tr>
                              <tr>
                                <th colspan="2"></th>
                                <?php foreach($quarter->result() as $q): ?>
                                  <th class="text-center width-5"><?=$q->qtr_code;?></th>
                                <?php endforeach; ?>
                              </tr>
                          </thead>
                          <tbody id="tbl_attendance">
                            <!-- BOYS -->
                            <?php 
                              $cnt = 1;
                              if($student->num_rows() > 0):
                                foreach($student->result() as $m):
                                  $stud_gender = $m->stud_gender;

                                  if($stud_gender == 'Male' ):
                                    $stud_id = $m->stud_id;
                            ?>
                              <tr class="me">
                                <td class="text-center vmiddle td" > <?=$cnt?></td>
                                <td class="vmiddle td name">
                                  <h5 class="m-0">
                                    &nbsp;&nbsp; <strong ><?=$m->stud_lastname.'</strong>, '.$m->stud_firstname.' '.substr($m->stud_middlename,0, 1) ?><?= !empty($m->stud_middlename)?'.':''?> <?= $m->stud_suffix?>
                                  </h5>
                                </td>

                                 <?php foreach($quarter->result() as $q): 
                                    $qtr_code = $q->qtr_code;
                                  ?>

                                  <td class="text-center">
                                    <?php 

                                      $flag = '--';
                                      $ctr  = 0;
                                      

                                      if($behavior->num_rows() > 0){

                                          foreach($behavior->result() as $r){
                                            $rstud_id   = $r->stud_id;
                                            $rqtr_code  = $r->qtr_code;
                                            $sv_value   = $r->sv_value;

                                            if( ($rstud_id == $stud_id) && ($rqtr_code == $qtr_code) ){

                                              if( empty($sv_value)){
                                                $flag = $flag;
                                              }else{
                                                $ctr += 1; 
                                                $flag = '<i class="fa fa-check"></i>  '.$ctr.' ';

                                                //$flag = '<div class="icon-el "> <i class="fa fa-check"></i> '.$ctr.' </div> ';
                                              }

                                              
                                            }else{
                                              $flag = $flag;
                                            }
                                          } 
                                      }

                                      echo $flag;
                                    
                                    ?>
                                  </td>

                                 <?php endforeach;?>
                              </tr>

                            <?php 
                                $cnt++;
                                endif; 
                               endforeach; 
                              endif;

                            ?>

                            <?php 
                              $cnt = $cnt;
                              if($student->num_rows() > 0):
                                foreach($student->result() as $f):
                                  $stud_gender = $f->stud_gender;

                                  if($stud_gender == 'Female' ):
                                    $stud_id = $f->stud_id;
                            ?>

                              <tr class="me">
                                <td class="text-center vmiddle td" > <?=$cnt?></td>
                                <td class="vmiddle td name">
                                  <h5 class="m-0">
                                     &nbsp;&nbsp; <strong ><?=$f->stud_lastname.'</strong>, '.$f->stud_firstname.' '.substr($f->stud_middlename,0, 1) ?><?= !empty($f->stud_middlename)?'.':''?><?= $m->stud_suffix?>
                                  </h5>
                                </td>

                                <?php foreach($quarter->result() as $q): 
                                    $qtr_code = $q->qtr_code;
                                  ?>

                                  <td class="text-center">
                                    <?php 

                                      $flag = '--';
                                      $ctr  = 0;


                                      if($behavior->num_rows() > 0){

                                          foreach($behavior->result() as $r){
                                            $rstud_id   = $r->stud_id;
                                            $rqtr_code  = $r->qtr_code;
                                            $sv_value   = $r->sv_value;

                                            if( ($rstud_id == $stud_id) && ($rqtr_code == $qtr_code) ){
                                              if( empty($sv_value)){
                                                $flag = $flag;
                                              }else{
                                                $ctr += 1; 
                                                $flag = '<i class="fa fa-check"></i>  '.$ctr.' ';
                                              }
                                            }else{
                                              $flag = $flag;
                                            }
                                          } 
                                      }

                                      echo $flag;
                                    
                                    ?>
                                  </td>

                                 <?php endforeach;?>

                                

                              </tr>

                            <?php 
                                $cnt++;
                                  endif; 
                                endforeach;
                              endif;  ?>

                          </tbody>
                      </table>
                    </div>
                  </div>

              </div>
            </div>
          </div>

        </div>
    </div>

    
    
</div> <!-- end of body container -->


<?= $this->load->view('inc/js')?>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    $("#data tr.me").click(function() {
        var selected = $(this).hasClass("highlights");
        $("#data tr").removeClass("highlights");
        $("#data td.final").addClass('ws');

        if(!selected)
            $(this).addClass("highlights");
            var tr = $(this).closest('tr');
            tr.find('.final').removeClass('ws').addClass('td-danger');
        

        //console.log(tr.find('td.final').removeClass('.ws'));
            

    });

  });
</script>
</body>
</html>