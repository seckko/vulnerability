
        <?php 
            $sec_name       = '';
            $lvl_name       = '';
            $lvl_id         = '';
            $sec_teacher    = '';
            $dept_name      = '';
            $lvl_color      = '';

            $sy_id          = $this->module->get_active_sy();
            $sec_id         = $sec_id;
            $quarter        = $this->module->table_where('quarter', array('qtr_active' => 'Y'));

            if($section->num_rows() > 0){
                foreach($section->result() as $r){
                    $lvl_id         = $r->lvl_id;
                    $lvl_name       = $r->lvl_name;
                    $sec_name       = $r->sec_name;
                    $sec_teacher    = $r->sec_teacher;
                    $dept_name      = $r->dept_name;
                    $lvl_color      = $r->lvl_color;
                }
            }
        ?>
        
        <input type="hidden" name="sy_id" value="<?=$sy_id?>">
        <input type="hidden" name="sec_id" value="<?=$sec_id?>">
        <input type="hidden" name="lvl_id" value="<?=$lvl_id?>">
        <input type="hidden" name="qtr_code" value="<?=$quarter->row('qtr_code')?>">

        <div class="row">
            <div class="col-md-12 ">
                <div class="panel panel-primary " >
                    <div class="panel-heading" style="padding:20px 20px">
                        <div class="row">
                            <div class="col-md-8">
                                <h1 class="m-0 bold" style="color:#<?=$lvl_color?>"><?=$sec_name?></h1>
                                <h4 class="m-0"><?= '<strong>'.$lvl_name .'</strong> | '.$dept_name.' Department' ?></h4>
                                <h5 class="m-0"><strong><?=$sec_teacher?></strong> <small> | Class Adviser</small> </h5>
                            </div>

                            <div class="col-md-4 text-right">
                                <h3 class="bold m-0"><?=$quarter->row('qtr_name')?></h3>
                                <h4 class="m-0">School Year <?= $this->module->get_active_sy_name()?></h4><br/>
                                <div class="text-right">
                                    <div class="btn-group">
                                        <a href="<?=base_url()?>grading/print_report_card/<?=$sec_id?>" class="btn btn-blue btn-xs"><i class="fa fa-print"></i> Print Report Card</a>
                                        <a href="<?=base_url()?>grading/print_advisory_class/<?=$sec_id?>" class="btn btn-primary btn-xs"><i class="fa fa-print"></i> Print Advisory Class</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-body">
                        <div class="table-wrapper">
                            <div class="table-scroll">
                                

                                <table class="table-custom table-bordered " id="data">
                                    
                                    <thead>
                                        <th colspan="2"></th>
                                        <?php 
                                            $subject  = $this->module->getTableSort('subject', 'sub_sort');
                                                foreach ($subject->result() as $r):
                                                    $sub_name   = $r->sub_name;
                                                    $sub_id     = $r->sub_id;
                                                ?>
                                                   <th  class="text-center theader vmiddle width-5">
                                                    <?=$sub_name?>
                                                   </th>
                                                    
                                                    <?php 
                                                    $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));
                                                    
                                                    foreach($subject_detail->result() as $s):
                                                        $subj_det_name = $s->subj_det_name;
                                                    ?>

                                                    <th  class="text-center theader vmiddle width-5"><?=$subj_det_name?></th>

                                                <?php endforeach; ?>
                                        <?php endforeach; ?>
                                                    
                                    </thead>

                                    <tbody>
                                        <?php 
                                            $cnts   = 1;
                                            foreach($students->result() as $b):
                                                $bstud_id = $b->stud_id;
                                                
                                        ?>
                                        
                                        <tr class="me">
                                           <td class="text-center vmiddle td" ><?=$cnts++?></td>
                                           <td class="vmiddle td name">
                                                <h5 class="m-0"> 
                                                   <input type="hidden" name="student_grade<?=$cnts?>[stud_id]" value="<?=$bstud_id?>">
                                                   <strong > <?=$b->stud_lastname.'</strong>, '.$b->stud_firstname.' '.substr($b->stud_middlename,0, 1) ?><?= !empty($b->stud_middlename)?'.':''?>
                                                </h5>
                                            </td>

                                            <?php 
                                                $test ='';
                                                $testing = '';


                                                $subject  = $this->module->getTableSort('subject', 'sub_sort');

                                                    foreach ($subject->result() as $r):
                                                        $sub_name   = $r->sub_name;
                                                        $sub_id     = $r->sub_id; 
                                                    ?>
                                                       <td class="text-center vmiddle td">
                                                            <?php foreach($component->result() as $t):
                                                                $ca_ww          = $t->ca_ww_percentage;
                                                                $ca_pt          = $t->ca_pt_percentage;
                                                                $ca_qa          = $t->ca_qa_percentage;
                                                                $tsub_id        = $t->sub_id;
                                                                $tsubj_det_id   = $t->subj_det_id;
                                                                $tsubj_id       = $t->subj_id;

                                                                $initial_score      = 0;
                                                                $quarterly_grade1    = 0;
                                                                $quarterly_grade2    = 0;
                                                                $quarterly_grade3    = 0;
                                                                $quarterly_grade4    = 0;


                                                                if( ($sub_id == $tsub_id) && ($tsubj_det_id == 0) ){

                                                                    $wwscore = 0;
                                                                    $ptscore = 0;
                                                                    $qascore = 0;

                                                                    $wwscoret = 0;
                                                                    $ptscoret = 0;
                                                                    $qascoret = 0;

                                                                    $ws_ww = 0;
                                                                    $ws_pt = 0;
                                                                    $ws_qa = 0;

                                                                    $ps_ww = 0;
                                                                    $ps_pt = 0;
                                                                    $ps_qa = 0;

                                                                    
                                                                    $wwscores = 0;
                                                                    $ptscores = 0;
                                                                    $qascores = 0;
                                                                    
                                                                    foreach($student_score->result() as $s){
                                                                        $sstud_id       = $s->stud_id;
                                                                        $quarter        = $s->scr_quarter;
                                                                        $type           = $s->scr_type;
                                                                        $subj_id        = $s->subj_id;
                                                                        $average        = $s->average;
                                                                        $score          = $s->score;
                                                                        $total_score    = $s->total_score;


                                                                        if( ($sstud_id == $bstud_id) && ($subj_id == $tsubj_id) ){
                                                                            
                                                                            if($quarter == '1Q'){
                                                                                if($type == 'WW'){
                                                                                  
                                                                                    $wwscore  = $score;
                                                                                    $wwscoret = $total_score;

                                                                                    $ps_ww    = (($wwscore * 100) / $wwscoret);
                                                                                    $ws_ww    = $ps_ww * ($ca_ww / 100 ) ;

                                                                                    $wwscores = round($ws_ww,2);

                                                                                }else if($type == 'PT'){
                                                                                    $ptscore  = $score;
                                                                                    $ptscoret = $total_score;
                                                                                    $ps_pt    = (($ptscore * 100) / $ptscoret);
                                                                                    $ws_pt    = $ps_pt * ($ca_pt / 100 ) ;

                                                                                    $ptscores = round($ws_pt,2);

                                                                                }else if($type == 'QA'){
                                                                                    $qascore  = $score;
                                                                                    $qascoret = $total_score;
                                                                                    $ps_qa    = (($qascore * 100) / $qascoret);
                                                                                    $ws_qa    = $ps_qa * ($ca_qa / 100 ) ;

                                                                                    $qascores = round($ws_qa,2);
                                                                                }  
                                                                                
                                                                               

                                                                                $q1 = $wwscores + $ptscores + $qascores; 

                                                                                foreach($grade_transmutation->result() as $g){
                                                                                    $gt_min     = $g->gt_min;
                                                                                    $gt_max     =  $g->gt_max;
                                                                                    $gt_grade   = $g->gt_grade;

                                                                                    if( ($q1 >= $gt_min) && ($q1 <= $gt_max) ){
                                                                                        $quarterly_grade1 = $gt_grade;
                                                                                    }
                                                                                }

                                                                            }

                                                                            if($quarter == '2Q'){
                                                                                if($type == 'WW'){
                                                                                  
                                                                                    $wwscore  = $score;
                                                                                    $wwscoret = $total_score;

                                                                                    $ps_ww    = (($wwscore * 100) / $wwscoret);
                                                                                    $ws_ww    = $ps_ww * ($ca_ww / 100 ) ;

                                                                                    $wwscores = round($ws_ww,2);

                                                                                }else if($type == 'PT'){
                                                                                    $ptscore  = $score;
                                                                                    $ptscoret = $total_score;
                                                                                    $ps_pt    = (($ptscore * 100) / $ptscoret);
                                                                                    $ws_pt    = $ps_pt * ($ca_pt / 100 ) ;

                                                                                    $ptscores = round($ws_pt,2);

                                                                                }else if($type == 'QA'){
                                                                                    $qascore  = $score;
                                                                                    $qascoret = $total_score;
                                                                                    $ps_qa    = (($qascore * 100) / $qascoret);
                                                                                    $ws_qa    = $ps_qa * ($ca_qa / 100 ) ;

                                                                                    $qascores = round($ws_qa,2);
                                                                                }  
                                                                                
                                                                               

                                                                                $q2 = $wwscores + $ptscores + $qascores; 

                                                                                foreach($grade_transmutation->result() as $g){
                                                                                    $gt_min     = $g->gt_min;
                                                                                    $gt_max     =  $g->gt_max;
                                                                                    $gt_grade   = $g->gt_grade;

                                                                                    if( ($q2 >= $gt_min) && ($q2 <= $gt_max) ){
                                                                                        $quarterly_grade2 = $gt_grade;
                                                                                    }
                                                                                }

                                                                            }

                                                                            if($quarter == '3Q'){
                                                                                if($type == 'WW'){
                                                                                   $ws_ww =  ($average * ($ca_ww / 100 ) ); 
                                                                                }else if($type == 'PT'){
                                                                                    $ws_pt =  ($average * ($ca_pt / 100 ) ); 
                                                                                }else if($type == 'QA'){
                                                                                    $ws_qa =  ($average * ($ca_qa / 100 ) ); 
                                                                                }  

                                                                                $q3 = $ws_ww + $ws_pt + $ws_qa; 

                                                                                foreach($grade_transmutation->result() as $g){
                                                                                    $gt_min     = $g->gt_min;
                                                                                    $gt_max     = $g->gt_max;
                                                                                    $gt_grade   = $g->gt_grade;

                                                                                    if( ($q3 >= $gt_min) && ($q3 <= $gt_max) ){
                                                                                        $quarterly_grade3 = $gt_grade;
                                                                                    }
                                                                                }

                                                                            }


                                                                        }
                                                                    }

                                                                    

                                                                    echo $quarterly_grade1.' | '.$quarterly_grade2.' | '.$quarterly_grade3.' | '.$quarterly_grade4;
                                                                    
                                                                    //echo '<span class="badge badge-danger badge-roundless">'.$quarterly_grade2.'</span>';
                                                                    //echo '<span class="badge badge-success badge-roundless">'.$quarterly_grade3.'</span>';
                                                                    
                                                                }

                                                            ?>
                                                            <?php endforeach; ?>
                                                       </td>
                                                        
                                                        <?php 
                                                        $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));
                                                        
                                                        foreach($subject_detail->result() as $s):
                                                            $subj_det_name = $s->subj_det_name;
                                                        ?>

                                                        <td class="text-center vmiddle td"></td>

                                                <?php endforeach; ?>
                                            <?php endforeach; ?>


                                        </tr>   
                                        <?php endforeach;?>                                      
                                    </tbody>
                                </table>
                                
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>