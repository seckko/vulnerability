
        <?php 
            $sec_name       = '';
            $lvl_name       = '';
            $lvl_id         = '';
            $sec_teacher    = '';
            $dept_name      = '';
            $lvl_color      = '';

            $sy_id          = $this->module->get_active_sy();
            $sec_id         = $sec_id;
            $quarter        = $this->module->table_where('quarter', array('qtr_active' => 'Y'));

            if($section->num_rows() > 0){
                foreach($section->result() as $r){
                    $lvl_id         = $r->lvl_id;
                    $lvl_name       = $r->lvl_name;
                    $sec_name       = $r->sec_name;
                    $sec_teacher    = $r->sec_teacher;
                    $dept_name      = $r->dept_name;
                    $lvl_color      = $r->lvl_color;
                }
            }
        ?>
        

        <div class="row">
            <div class="col-md-12 ">
                <div class="panel panel-primary " >
                    <div class="panel-heading" style="padding:20px 20px">
                        <div class="row">
                            <div class="col-md-8">
                                <h1 class="m-0 bold" style="color:#<?=$lvl_color?>"><?=$sec_name?></h1>
                                <h4 class="m-0"><?= '<strong>'.$lvl_name .'</strong> | '.$dept_name.' Department' ?></h4>
                                <h5 class="m-0"><strong><?=$sec_teacher?></strong> <small> | Class Adviser</small> </h5>
                            </div>

                            <div class="col-md-4 text-right">
                                <h3 class="bold m-0"><?=$quarter->row('qtr_name')?></h3>
                                <h4 class="m-0">School Year <?= $this->module->get_active_sy_name()?></h4><br/>
                                <div class="text-right">
                                    <div class="btn-group">
                                        <a href="<?=base_url()?>grading/print_report_card/<?=$sec_id?>" class="btn btn-blue btn-xs"><i class="fa fa-print"></i> Print Report Card</a>
                                        <a href="<?=base_url()?>grading/print_advisory_class/<?=$sec_id?>" class="btn btn-primary btn-xs"><i class="fa fa-print"></i> Print Advisory Class</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-body">
                        <div class="table-wrapper">
                            <div class="table-scroll">
                                <table class="table-custom table-bordered" id="data">
                                    <thead>
                                        <th class="text-center theader">No.</th>
                                        <th class="theader" style="width:25%"> Learners Name</th>

                                        <?php 
                                            $subject  = $this->module->getTableSort('subject', 'sub_sort');
                                                foreach ($subject->result() as $r):
                                                    $sub_name   = $r->sub_name;
                                                    $sub_id     = $r->sub_id;
                                                ?>
                                                   <th  class="text-center theader vmiddle width-5">
                                                     <?=$sub_name?> 
                                                   </th>
                                                    
                                                    <?php 
                                                    $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));
                                                    
                                                    foreach($subject_detail->result() as $s):
                                                        $subj_det_name = $s->subj_det_name;
                                                    ?>

                                                    <th  class="text-center theader vmiddle width-5">
                                                        <?=$subj_det_name?>
                                                    </th>

                                                <?php endforeach; ?>
                                        <?php endforeach; ?>

                                        <th class="ws text-center width-5 vmiddle bold">Average</th>
                                        <th class="text-center vmiddle width-5 bold">Lowest</th>
                                        <th class="text-center vmiddle width-15 bold">Award</th>
                                    </thead>

                                    <tbody>

                                        <?php 
                                            $cnts   = 1;
                                            foreach($students->result() as $b):
                                                $bstud_id = $b->stud_id;
                                                
                                        ?>
                                        
                                        <tr class="me">
                                           <td class="text-center vmiddle td" ><?=$cnts++?></td>
                                           <td class="vmiddle td name">
                                                <h5 class="m-0"> 
                                                   <input type="hidden" name="student_grade<?=$cnts?>[stud_id]" value="<?=$bstud_id?>">
                                                   <strong > <?=$b->stud_lastname.'</strong>, '.$b->stud_firstname.' '.substr($b->stud_middlename,0, 1) ?><?= !empty($b->stud_middlename)?'.':''?>
                                                </h5>
                                            </td>

                                            <?php foreach($subject->result() as $r):
                                                $sub_name   = $r->sub_name;
                                                $sub_id     = $r->sub_id; 

                                                $subject_det    = $this->module->get_query('SELECT COUNT(*) as cnt FROM subject_detail WHERE sub_id = '.$sub_id.' ')->row('cnt');
                                                $subject_detail = $this->module->table_where('subject_detail', array('sub_id' => $sub_id));
                                            ?>


                                            <?php foreach($component->result() as $t){
                                                $ca_ww          = $t->ca_ww_percentage;
                                                $ca_pt          = $t->ca_pt_percentage;
                                                $ca_qa          = $t->ca_qa_percentage;
                                                $tsub_id        = $t->sub_id;
                                                $tsubj_det_id   = $t->subj_det_id;
                                                $tsubj_id       = $t->subj_id;


                                                if(($sub_id == $tsub_id)){

                                                    $quarterly_grade   = 0;
                                                    $wwscore           = 0;
                                                    $ptscore           = 0;
                                                    $qascore           = 0;
                                                    

                                                    foreach($student_score->result() as $s){
                                                        $sstud_id       = $s->stud_id;
                                                        $stype          = $s->scr_type;
                                                        $ssubj_id       = $s->subj_id;
                                                        $ssub_id        = $s->sub_id;
                                                        $ssubj_det_id   = $s->subj_det_id;
                                                        $saverage       = $s->average;

                                                        $divider        = 1;                                                        

                                                        if( ($sstud_id == $bstud_id) && ($ssubj_id == $tsubj_id) ){
                                                           if($stype == 'WW'){ 
                                                                $ww     = $saverage * ($ca_ww / 100);
                                                                $wwscore = round($ww,2);
                                                            }else if($stype == 'PT'){
                                                                $pt     = $saverage * ($ca_pt / 100);
                                                                $ptscore = round($pt,2);
                                                            }else if($stype == 'QA'){
                                                                $qa     = $saverage * ($ca_qa / 100);
                                                                $qascore = round($qa,2);
                                                            }

                                                            $initial_grade = $wwscore + $ptscore + $qascore; 

                                                            foreach($grade_transmutation->result() as $g){
                                                                $gt_min     = $g->gt_min;
                                                                $gt_max     = $g->gt_max;
                                                                $gt_grade   = $g->gt_grade;

                                                                if( ($initial_grade >= $gt_min) && ($initial_grade <= $gt_max) ){
                                                                    $quarterly_grade = $gt_grade;
                                                                }
                                                            }

                                                        }

                                                        if((empty($tsubj_det_id) || $tsubj_det_id == 0) && ($sub_id == $tsub_id)){
                                                            $divider  = 1;
                                                        }else{
                                                            $divider = $subject_det; 
                                                        }

                                                        
                                                    } 

                                                }
                                            }?>

                                            <td class="text-center vmiddle td bold">
                                                <?= $divider?>  /
                                               
                                               <?=($quarterly_grade <= 0 ? '---' : $quarterly_grade )?>
                                            </td>

                                                <?php 

                                                $quarterly_grade = 0;
                                                
                                                foreach($subject_detail->result() as $s):
                                                    $subj_det_id    = $s->subj_det_id;
                                                    $subj_det_name  = $s->subj_det_name;
                                                
                                                    foreach($component->result() as $t){
                                                        $ca_ww          = $t->ca_ww_percentage;
                                                        $ca_pt          = $t->ca_pt_percentage;
                                                        $ca_qa          = $t->ca_qa_percentage;
                                                        $tsub_id        = $t->sub_id;
                                                        $tsubj_det_id   = $t->subj_det_id;
                                                        $tsubj_id       = $t->subj_id;

                                                        if (($sub_id == $tsub_id) && ($subj_det_id == $tsubj_det_id)) {

                                                            $quarterly_grade   = 0;
                                                            $wwscore           = 0;
                                                            $ptscore           = 0;
                                                            $qascore           = 0;

                                                            foreach($student_score->result() as $s){
                                                                $sstud_id       = $s->stud_id;
                                                                $type           = $s->scr_type;
                                                                $subj_id        = $s->subj_id;
                                                                $average        = $s->average;

                                                                if( ($sstud_id == $bstud_id) && ($subj_id == $tsubj_id)  ){

                                                                    if($type == 'WW'){ 
                                                                        $ww     = $average * ($ca_ww / 100);
                                                                        $wwscore = round($ww,2);
                                                                    }else if($type == 'PT'){
                                                                        $pt     = $average * ($ca_pt / 100);
                                                                        $ptscore = round($pt,2);
                                                                    }else if($type == 'QA'){
                                                                        $qa     = $average * ($ca_qa / 100);
                                                                        $qascore = round($qa,2);
                                                                    }

                                                                    $initial_grade = $wwscore + $ptscore + $qascore; 

                                                                    foreach($grade_transmutation->result() as $g){
                                                                        $gt_min     = $g->gt_min;
                                                                        $gt_max     =  $g->gt_max;
                                                                        $gt_grade   = $g->gt_grade;

                                                                        if( ($initial_grade >= $gt_min) && ($initial_grade <= $gt_max) ){
                                                                            $quarterly_grade = $gt_grade;
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    } ?>

                                                

                                                <td class="text-center vmiddle td">
                                                    <?=($quarterly_grade <= 0 ? '---' : $quarterly_grade )?>

                                                </td>

                                                <?php endforeach; ?>
                    
                                            <?php endforeach;?>
                                        </tr>

                                        <?php endforeach;?>
                                        
                                        
                                    </tbody>
                                </table>
                                
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>