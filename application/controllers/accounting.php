<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Accounting extends CI_Controller {

	public function __construct(){
		parent::__construct();	

	}


	public function index()
	{

	}

	public function chart_accounts(){
		$data['title'] 				= 'Chart of Accounts';
		$data['coa_type'] 			= $this->module->get_table('coa_type');
		$data['coa_group'] 			= $this->module->get_query("SELECT ct.*, cg.coagrp_id, cg.coagrp_desc  FROM coa_type AS ct, coa_group AS cg WHERE ct.coatype_id = cg.coatype_id");
		$data['coa_title']			= $this->module->get_table("v_coa_title");
		$this->load->view('accounting/chart_of_accounts', $data);
	}

	public function coa_type(){
		$this->form_validation->set_rules('coatype_code', 'Code', 'trim|required|is_unique[coa_type.coatype_code]');
		$this->form_validation->set_rules('coatype_desc', 'Description', 'trim|required');

		if ($this->form_validation->run() == FALSE)
            {
            	$this->module->my_return(false, validation_errors());
            }
        else
            {
            	$coatype_code 	= $this->input->post('coatype_code', true);
            	$coatype_desc 	= $this->input->post('coatype_desc', true);

            	$data_coa_type = array(
            		'coatype_code' 	=> $coatype_code,
            		'coatype_desc' 	=> $coatype_desc
            	);

            	$this->module->public_insert('coa_type', $data_coa_type);
            }
	}

	public function delete_coa_type()
	{
		$id = $this->uri->segment(3);
		if($this->module->delete('coa_type', array('coatype_id' => $id)))
		{
			return true;
		}
		
	}

	public function coa_group(){
		$this->form_validation->set_rules('coatype_id', 'Code', 'trim|required');
		$this->form_validation->set_rules('coagrp_desc', 'Description', 'trim|required');

		if ($this->form_validation->run() == FALSE)
            {
            	$this->module->my_return(false, validation_errors());
            }
        else
            {
            	$coatype_id 	= $this->input->post('coatype_id', true);
            	$coagrp_desc 	= $this->input->post('coagrp_desc', true);

            	$data_coa_group = array(
            		'coatype_id' 	=> $coatype_id,
            		'coagrp_desc' 	=> $coagrp_desc
            	);

            	$this->module->public_insert('coa_group', $data_coa_group);
            }
	}

	public function delete_coa_group()
	{
		$id = $this->uri->segment(3);
		if($this->module->delete('coa_group', array('coagrp_id' => $id)))
		{
			return true;
		}
		
	}


	public function coa_title(){
		$this->form_validation->set_rules('coatype_id', 'Code', 'trim|required');
		$this->form_validation->set_rules('coagrp_id', 'Group', 'trim|required');
		$this->form_validation->set_rules('coatitle_code', 'Code Title', 'trim|required|is_unique[coa_title.coatitle_code]');
		$this->form_validation->set_rules('coatitle_desc', 'Description', 'trim|required');

		if ($this->form_validation->run() == FALSE)
            {
            	$this->module->my_return(false, validation_errors());
            }
        else
            {
            	$coatype_id 	= $this->input->post('coatype_id', true);
            	$coagrp_id 		= $this->input->post('coagrp_id', true);
            	$coatitle_code 	= $this->input->post('coatitle_code', true);
            	$coatitle_desc 	= $this->input->post('coatitle_desc', true);

            	$data_coa_title = array(
            		'coatype_id' 	=> $coatype_id,
            		'coagrp_id' 	=> $coagrp_id,
            		'coatitle_code' => $coatitle_code,
            		'coatitle_desc' => $coatitle_desc
            	);

            	$this->module->public_insert('coa_title', $data_coa_title);
            }
	}

	public function delete_coa_title()
	{
		$id = $this->uri->segment(3);
		if($this->module->delete('coa_title', array('coatitle_id' => $id)))
		{
			return true;
		}
		
	}

	public function get_coa_group(){
		$coatype_id = $this->uri->segment(3);
		$coa_group = $this->module->get_query("SELECT * FROM coa_group WHERE coatype_id = ".$coatype_id." ");
		foreach($coa_group->result() as $r){
			echo '<option value="'.$r->coagrp_id.'">'.$r->coagrp_desc.'</option>';
		}
	}
}