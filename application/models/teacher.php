<?php

if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Teacher extends CI_Model {
    public function __construct(){
        parent::__construct();

    }

    public function get_master_record(){
        $sql = 'SELECT
        ts.`id` AS student_id,
        ts.`firstname`,
        ts.`lastname`,
        tcr.`id` AS master_id,
        tcr.`quiz`,
        tcr.`recitation`,
        tcr.`homework`,
        tcr.`project`,
        tcr.`behavior`,
        tcr.`performance`,
        tcr.`periodical`,
        tcr.`summary`
        FROM tbl_student ts LEFT JOIN tbl_class_record tcr ON ts.`id` = tcr.`student_id` AND tcr.`teacher_id` = '.$this->session->userdata("id").'
        ORDER BY ts.`lastname`
        ';
        return  $this->db->query($sql);
    }

    public function check_class_record($data){
        $result = $this->db->query('SELECT id FROM tbl_class_record WHERE student_id = '.$data["student_id"].' AND teacher_id = '.$data["teacher_id"].'  AND subject_id = '.$data["subject_id"].' LIMIT 1');
        return $result;
    }

    public function insert_class_record($data){
        if($this->db->insert('tbl_class_record',$data) === false){
            $this->module->my_return(false,$this->db->_error_message());
        }
        else{
            $this->module->my_return(true,'Save');
        }

    }
    public function update_class_record($data){
        unset($data["student_id"]);
        unset($data["teacher_id"]);
        unset($data["subject_id"]);
        $id['student_id'] = $this->input->post('student_id');
        $id['teacher_id'] = $this->session->userdata('id');
        $id['subject_id'] = $this->input->post('subject_id');
        $this->db->where($id);

        /*print_r($this->db->last_query());*/
        if($this->db->update('tbl_class_record',$data) === false){
            $this->module->my_return(false,$this->db->_error_message());
        }
        else{
            $this->module->my_return(true,'Updated');
        }

    }
}

/* End of file media_model.php */
/* Location: ./application/models/media_model.php */
